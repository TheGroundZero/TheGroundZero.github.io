<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="DezeStijn"><meta name=description content="Join my adventure in the world of home automation, starting with the Shelly devices."><meta name=keywords content="Sequr,blog,writeup,CTF,challenge,machine,infosec,IT security,hacking,pentesting,cybersecurity,Home,Automation,Shelly,Introduction"><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://sequr.be/blog/2020/07/intro-into-shelly/><title>Intro into Shelly :: Sequr
</title><link rel=stylesheet href=https://sequr.be/main.min.244183cde1a38e0b08f82c11791181288f9aac1cc9618cd6f4e9e7710c5768ba.css integrity="sha256-JEGDzeGjjgsI+CwReRGBKI+arBzJYYzW9OnncQxXaLo=" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://sequr.be/css/table.css><link rel=stylesheet type=text/css href=https://sequr.be/css/menu.css><link rel=stylesheet type=text/css href=https://sequr.be/css/background.css><link rel=apple-touch-icon sizes=180x180 href=https://sequr.be/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://sequr.be/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://sequr.be/favicon-16x16.png><link rel=manifest href=https://sequr.be/site.webmanifest><link rel=mask-icon href=https://sequr.be/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://sequr.be/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Intro into Shelly"><meta itemprop=description content="Join my adventure in the world of home automation, starting with the Shelly devices."><meta itemprop=datePublished content="2020-07-24T00:00:00+00:00"><meta itemprop=dateModified content="2021-11-06T00:00:00+00:00"><meta itemprop=wordCount content="3330"><meta itemprop=image content="https://sequr.be/blog/2020/07/intro-into-shelly/cover.svg"><meta itemprop=keywords content="Home,Automation,Shelly,Introduction"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2020/07/intro-into-shelly/cover.svg"><meta name=twitter:title content="Intro into Shelly"><meta name=twitter:description content="Join my adventure in the world of home automation, starting with the Shelly devices."><meta property="article:section" content="Home Automation"><meta property="article:published_time" content="2020-07-24 00:00:00 +0000 UTC"><link rel=webmention href=https://webmention.io/sequr.be/webmention></head><body><div class=container><header class=header><span class=header__inner><a href=https://sequr.be/ style=text-decoration:none><div class=logo><span class=logo__mark>$</span>
<span class=logo__text>lynx sequr.be</span>
<span class=logo__cursor style=background-color:#e68101></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://sequr.be/about/>About</a></li><li><a href=https://sequr.be/blog/>Blog</a></li><li><a href=https://sequr.be/privacy/>Privacy</a></li><li><a href=https://sequr.be/shoppinglist/>Shopping</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class="post h-entry"><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
16 minutes</p></div><article><h1 class="post-title p-name"><a href=https://sequr.be/blog/2020/07/intro-into-shelly/ class=u-url>Intro into Shelly</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#introducing-shelly>Introducing: Shelly</a></li><li><a href=#installation>Installation</a><ul><li><a href=#powering-the-shelly>Powering the Shelly</a></li><li><a href=#shelly-configuration>Shelly configuration</a></li></ul></li><li><a href=#examples>Examples</a><ul><li><a href=#two-way-toggle-switch-with-shelly1pm>Two-way toggle switch with Shelly1(PM)</a></li><li><a href=#two-way-momentary-switch-with-shelly1pm>Two-way momentary switch with Shelly1(PM)</a></li><li><a href=#two-way-switch-renovation>Two-way switch, renovation</a></li><li><a href=#two-way-switch-existing-installation>Two-way switch, existing installation</a><ul><li><a href=#a-using-buttons>a) Using buttons</a></li><li><a href=#b-using-shelly-25-and-shelly-i3>b) Using Shelly 2.5 and Shelly i3</a></li><li><a href=#c-using-two-shelly-25s>c) Using two Shelly 2.5&rsquo;s</a></li></ul></li><li><a href=#three-way-switch-with-shelly1pm>Three-way switch with Shelly1(PM)</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#changelog>Changelog</a><ul><li><a href=#update-2021-11-06>Update 2021-11-06</a></li><li><a href=#update-2021-10-18>Update 2021-10-18</a></li><li><a href=#update-2020-11-06>Update 2020-11-06</a></li><li><a href=#update-2020-11-05>Update 2020-11-05</a></li><li><a href=#update-2020-09-12>Update 2020-09-12</a></li><li><a href=#update-2020-08-26>Update 2020-08-26</a></li></ul></li></ul></nav></aside><hr><div class="post-content e-content"><h2 id=intro>Intro <a href=#intro>¶</a></h2><p>The house I live in was build in the &rsquo;80s.
This means the configuration of the electrical installation is pretty basic and could sometimes be called old-fashioned.<br>This also means that the house has no provisions for the fancy home automation systems new houses often have included from the start.</p><p>Since adding these fancy systems in a house like mine would require me to basically strip and rewire the whole house &ndash;which I don&rsquo;t feel like doing&ndash;
I have to resort to home automation add-ons.<br>Luckily, there&rsquo;s already a whole market of devices that can assist in setting up home automation in situations like mine.
They&rsquo;re easily recognisable, since they&rsquo;re usually called <em>&ldquo;smart&rdquo;</em> + <em>&ldquo;non-smart device name&rdquo;</em>, like <em>&ldquo;smart toaster&rdquo;</em>.</p><p>I didn&rsquo;t feel much excitement for the first wave of smart device and I also have my doubts about the need to <em>smartify</em> just about anything,
especially the apparent need to connect just about anything to the internet.<br>If you want to have a laugh(?) at the things manufacturers add internet connectivity to, have a look at the Twitter profile <a href=https://twitter.com/internetofshit title="@internetofshit on Twitter" target=_blank rel=noopener>Internet of Shit</a>.</p><h2 id=requirements>Requirements <a href=#requirements>¶</a></h2><p>The first rule of automation is that it should add functionality without adding extra burden.<br>For example: with most smart light bulbs, you cannot use your classical light switches anymore, since the bulbs require constant power.
As such, you&rsquo;ll either need to always use an app to turn on/off your lights, or buy <em>smart</em> light switches for manual control.</p><p>I definitely don&rsquo;t want to get vendor-locked.
Devices should be able to work with devices from other brands.
Preferably, 1 central hub should be able to control different devices and I should be able to set up automations across them.</p><p>Related to the previous requirement, I prefer to use open standards.<br>E.g., my security cameras work with ONVIF, so I can capture a copy of the video stream to my local NAS or control them using open software.</p><p>Devices shouldn&rsquo;t require internet connectivity to work.<br>If network access is require, e.g. for remote access from my smartphone, this should go through the central hub.
All other devices should be behind a firewall rule blocking outgoing connections.
Definitely no <a href=https://en.wikipedia.org/wiki/Universal_Plug_and_Play title="Universal Plug and Play, Wikipedia" target=_blank rel=noopener>UPnP</a> opening random ports on my FW.</p><p>Of course I want to be able to install everything myself.
Unless there&rsquo;s a high amount of risk involved or there&rsquo;s specific code to be followed, I want to do all installations on my own.
I feel comfortable opening switches and wall sockets, know the basics of electricity and safety, and have friends who I&rsquo;m able to call for advice if I have specific doubts.<br>An active support forum is definitely useful.</p><p>Since I don&rsquo;t have much experience (yet) with building devices myself, flashing firmware on ESP chips, etc. I want to be able to build prebuild devices.
But as I said before: I don&rsquo;t want blackbox devices with zero room for tinkering.</p><p>Updates are important.<br>In just about any device, tool, software package&mldr; bugs are discovered, some more dangerous or more impactful than others.<br>It&rsquo;s gives comfort knowing that the manufacturer still supports the devices and provides updates, be it Over the Air (OTA) or by manually flashing new packages.</p><p>Finally, I also want to be sure that my devices stay working in the future.<br>I&rsquo;m one of the many owners of a Pebble watch and am grateful for the developers and community continuing the <a href=https://rebble.io/ title="Rebble - Bring life back to your Pebble" target=_blank rel=noopener>project</a> after Fitbit <a href=https://web.archive.org/web/20180705003113/https://blog.getpebble.com/2016/12/07/fitbit/ title="Pebble’s Next Step" target=_blank rel=noopener>bought and killed</a> the Kickstarter backed smartwatch.</p><h2 id=introducing-shelly>Introducing: Shelly <a href=#introducing-shelly>¶</a></h2><p>Saying that the devices of <a href=https://shelly.cloud title=Shelly target=_blank rel=noopener>Shelly</a> are the first introduction of <em>smartness</em> to my house, would be incorrect.<br>I already own a smart doorbell and perhaps you could almost call security cams managed by my NAS smart as well.<br>However, since I wasn&rsquo;t doing anything particularly smart with them yet, other than answering the door while at work, I won&rsquo;t count these in just yet.</p><p>Shelly devices are manufactured by Allterco, which has its headquarters in Sofia, Bulgaria.<br>By the looks of it, Shelly emerged around 2018 and has quickly risen in popularity.<br>It&rsquo;s usually compared to Sonoff, with the Shelly1 being matched with the Sonoff Basic.
If you want a comparison between these two devices, I would advise you to watch <a href="https://www.youtube.com/watch?v=J20hxfUTP9I" title="Is the Shelly 1 better than the Sonoff Basic?" target=_blank rel=noopener>this Youtube video</a> by The Hook Up.
In short, the Shelly relays (they have other devices as well) are small devices (the size of 2 Oreo cookies stacked on top of each other)
that are usually installed in a switch box and can be controlled via a physical switch or button, via the app,
or home automatation software like <a href=https://www.home-assistant.io/ title="Home Assistant" target=_blank rel=noopener>Home Assistant</a> (which I&rsquo;ll cover in another blog post).</p><figure class=center><img src=shelly1_cookie.jpg alt="Shelly compared to Oreo cookies"><figcaption class=center>© Shelly Cloud - Shelly 1 compared to Oreo cookies</figcaption></figure><p>I installed 3 Shelly devices in my house so far, one Shelly 1PM and two Shelly 2.5&rsquo;s, and plan on installing more in the future.
These currently control the light in one bedroom and two lights in my living room.</p><h2 id=installation>Installation <a href=#installation>¶</a></h2><blockquote><p><strong>WARNING</strong><br>Mains voltage can kill you!<br>Always turn off the breaker.<br>Ask an electrician for help if you don&rsquo;t know what to do.</p></blockquote><p>There are multiple types of Shelly relays. Which one you&rsquo;ll use depends on the type of load your switching and the specifics of your configuration.</p><p>Installation usually boils down to the following:</p><ul><li>The Shelly relay should be installed as close as possible (electrically speaking) to the load you&rsquo;re switching.<br>I.e. You&rsquo;ll probably install it behind the last switch in a multi-switch configuration, or in the lamp base.</li><li>You&rsquo;ll need to power the Shelly itself using mains voltage (110-230V AC) or using a power supply (12V/24-60V DC*).<br>For this you&rsquo;ll need connectors <strong>L</strong> (phase/-) and <strong>N</strong> (neutral/+).<br>Don&rsquo;t forget to set the jumper on the correct pins. By default, the jumper is set to power the Shelly with mains voltage.</li><li>The Live wire doesn&rsquo;t necessarily need to come off the same wire feeding the switches (SW), but it must be on the same phase.<br>Note that the Shelly and lamp will be protected by the breaker feeding the Shelly, so this may change if you <em>borrow</em> a wire elsewhere.</li><li>The Shelly 1 has a dry relay, which means that you can switch a load with a different voltage than what you&rsquo;re using to power the Shelly.<br>That&rsquo;s why, for the Shelly1, you&rsquo;ll also need to provide input voltage on connector <strong>I</strong> (input).<br>The other relays have the Input internally connected to the Live connector.</li><li>Connect your physical switch/button to the <strong>SW</strong> connector.
This could be the light switch of your existing light fixture.<br>This needs to be the same voltage as what you&rsquo;re providing to the Input connector (Shelly 1) or the Live connector (other Shelly relays).
Make sure you&rsquo;re not mixing phases if you&rsquo;re pulling wires from different circuits.</li><li>Whatever you&rsquo;re switching (e.g. your lights) will be connected to the <strong>O</strong> connector (Output).<br>You could have a Shelly relay at your switch just to detect input changes (I) and perhaps have a Shelly elsewhere to do the actual switching (O).</li></ul><p>* DC voltage may differ depending on the Shelly model. Make sure you check the manual first!</p><p>Make sure you follow your local code/regulations regarding type of cable used, colour coding, water/fire proofing, safety, etc.<br>For example: where I live, the most commonly used wires are the 1.5mm² and 2.5mm² used for lighting and wall sockets respectively.
Wires are coloured brown/red* for Phase/Live/Hot (I&rsquo;ll call this Live from now on), blue for Neutral, green-yellow for Ground, and black/grey for switch wires.
Since local building code has changed since my house was built, other colours might still be present, which is something to be wary of when working in older houses.</p><p>* Actually, any colour other than green-yellow may be used for Live. Even blue is allowed in a multi-phase layout where there&rsquo;s no Neutral.
Old houses over here often have white wires for Live.</p><p>However, I&rsquo;m not an electrician, building codes differ amongst countries/states/&mldr;, and they change over time (e.g., to accomodate for home automation systems), so:<br><strong>Always check your local building code and regulations! Consult a licensed electrician if you have any questions!</strong></p><figure class=center><img src=shelly1_wiring_ac.jpg alt="Shelly 1 wiring instructions"><figcaption class=center>© Shelly Cloud - Shelly 1 wiring instructions on mains</figcaption></figure><p>When you&rsquo;ve double-checked your wiring, turn on the breaker to power the Shelly and continue in the Shelly app for the initial configuration.</p><p>Info on the &ldquo;basic&rdquo; installations can be found in the Shelly manual or on the website.<br>These assume you have all the wires you need present at the location you want to install the Shelly relay.</p><h3 id=powering-the-shelly>Powering the Shelly <a href=#powering-the-shelly>¶</a></h3><p>As I discussed a few lines up, the Shelly needs to be powered as well.<br>But what if you don&rsquo;t have power available at the location you&rsquo;ll be installing the Shelly?</p><p>Depending on what you have available, you might still be able to get your automation going.</p><ul><li>Do you have the possibility to get power to that location?<ul><li>By pulling extra wires from the power source of your load (most commonly near the first switch in a multi-switch layout).</li><li>By <em>borrowing</em> power elsewhere. E.g. a wall socket or switch from a different room.<br>Do pay attention to the phases and keep in mind that this may cause your load to be connected to a different breaker than before.</li></ul></li><li>Can you reuse some of the wires already present?<ul><li>In a multi-switch layout, you&rsquo;ll have 2 switch wires between each switch. You could use these to carry power.<ul><li>If you have Neutral available at your load, you&rsquo;ll only need to transfer Live/Phase and have 1 cable available for SW.</li><li>If you don&rsquo;t, you&rsquo;ll have to use them for both Live and Neutral. I&rsquo;ll cover how to get SW to work later.</li></ul></li></ul></li></ul><p><strong>Tip!</strong>
You may want to do the initial configuration of the Shelly device on your workbench first.
Just in case anything goes wrong or you happen to have a broken device, you don&rsquo;t want to have to undo the whole installation of the Shelly again.</p><h3 id=shelly-configuration>Shelly configuration <a href=#shelly-configuration>¶</a></h3><p>There&rsquo;s 2 methods of setting the Shelly up:</p><ul><li>using the Shelly app</li><li>using the <a href=https://sequr.be/blog/2021/01/shelly-web-ui-method/ title="Shelly Web UI method">Web UI</a></li></ul><p>Both methods have their pros and cons, I leave it up to you to pick which method you prefer.</p><h2 id=examples>Examples <a href=#examples>¶</a></h2><h3 id=two-way-toggle-switch-with-shelly1pm>Two-way toggle switch with Shelly1(PM) <a href=#two-way-toggle-switch-with-shelly1pm>¶</a></h3><p>Below is the most common installation of a 2-way switch, also known as a hotel switch.
Two switches control the same light and physical state of the switch (up/down) is not linked to the state of the lamp.</p><a href=schematic-2way.svg title="Wiring schematic of 2-way toggle switch" target=_blank><figure class=center><img src=schematic-2way.svg alt="Wiring schematic of 2-way toggle switch"><figcaption class=center>Wiring schematic of 2-way toggle switch</figcaption></figure></a><p>By installing a Shelly1(PM) you can make these switches &ldquo;smart&rdquo;.<br>Install the Shelly as below and set Button Mode to <em>Edge</em>.</p><a href=schematic-2way-shelly.svg title="Wiring schematic of 2-way toggle switch with Shelly1" target=_blank><figure class=center><img src=schematic-2way-shelly.svg alt="Wiring schematic of 2-way toggle switch with Shelly1"><figcaption class=center>Wiring schematic of 2-way toggle switch with Shelly1</figcaption></figure></a><p>Note that you need to pull an extra wire to be able to provide permanent Live to the Shelly.</p><h3 id=two-way-momentary-switch-with-shelly1pm>Two-way momentary switch with Shelly1(PM) <a href=#two-way-momentary-switch-with-shelly1pm>¶</a></h3><p>A two-way setup can also be achieved using momentary switches.
A momentary switch setup is also ideal for when you want to make a toggle switch setup <em>smart</em> using a Shelly
since you can install the switches in parallel so that you don&rsquo;t need to pull an extra Live wire.</p><p>Extra switches would be installed in parallel, requiring only 2 wires: Live and signal.</p><a href=schematic-2way-momentary.svg title="Wiring schematic of 2-way momentary switch without relay module" target=_blank><figure class=center><img src=schematic-2way-momentary.svg alt="Wiring schematic of 2-way momentary switch without relay module"><figcaption class=center>Wiring schematic of 2-way momentary switch without relay module</figcaption></figure></a><p>Momentary switches send a pulse when they are pressed.
That&rsquo;s why they are always connected to some sort of relay unit which will toggle a relay each time a pulse is received.
Without the Shelly (or a different relay unit) the light would only be on while one of the buttons is being pressed.</p><p>Installing the Shelly will usually involve replacing the existing relay module with the Shelly.</p><a href=schematic-2way-momentary-shelly.svg title="Wiring schematic of 2-way momentary switch with Shelly1" target=_blank><figure class=center><img src=schematic-2way-momentary-shelly.svg alt="Wiring schematic of 2-way momentary switch with Shelly1"><figcaption class=center>Wiring schematic of 2-way momentary switch with Shelly1</figcaption></figure></a><h3 id=two-way-switch-renovation>Two-way switch, renovation <a href=#two-way-switch-renovation>¶</a></h3><p>My first install of a Shelly relay was in a bedroom I was renovating at that time.<br>The bedroom initially had one light switch at the door, but none near the bed.
So you either had to get in bed in the dark, or throw a shoe at the switch :P</p><p>While renovating, I got rid of the single switch and installed two two-way switches.<br>The Engineering Mindset has a good <a href="https://www.youtube.com/watch?v=opoEswRp_jg" title="The Engineer Mindset - Two Way Switching Explained - How to wire 2 way light switch" target=_blank rel=noopener>video</a> on how a two-way switch works.</p><p>In the old configuration, 3 wires would run from the switch to the lamp: Ground, Neutral and Live interrupted by the switch.</p><a href=schematic-lamp-1switch.svg title="Wiring schematic of lamp with single switch" target=_blank><figure class=center><img src=schematic-lamp-1switch.svg alt="Wiring schematic of lamp with single switch"><figcaption class=center>Schematic of old situation with single switch</figcaption></figure></a><p>To convert this into a two-way switch, I need to pull 2 (switch) wires between the switches and a Live wire from the second switch to the lamp.<br>Note that the old Live wire is no longer used. If you plan on installing a wall socket near the switch, you could still use that wire.
But make sure that you need to follow your local code re. mixing circuits.</p><a href=schematic-lamp-2switch.svg title="Wiring schematic of lamp with two-way switch" target=_blank><figure class=center><img src=schematic-lamp-2switch.svg alt="Wiring schematic of lamp with two-way switch"><figcaption class=center>Schematic of new situation with two-way switch</figcaption></figure></a><p>To install the Shelly, we&rsquo;ll reuse the old Live wire. By connecting this in front of the switch, it becomes a &ldquo;permanent Live&rdquo;.<br>We use this wire and the Neutral to power the Shelly. The Live is also used as the Input.<br>The output Live wire of the final switch is connected to the SW input.<br>Finally, the lamp is connected to the Output.<br>Note: use Wago clamps to connect multiple wires together.</p><a href=schematic-lamp-2switch-shelly.svg title="Wiring schematic of lamp with two-way switch and Shelly 1" target=_blank><figure class=center><img src=schematic-lamp-2switch-shelly.svg alt="Wiring schematic of lamp with two-way switch and Shelly 1"><figcaption class=center>Schematic two-way switch installation with Shelly 1</figcaption></figure></a><h3 id=two-way-switch-existing-installation>Two-way switch, existing installation <a href=#two-way-switch-existing-installation>¶</a></h3><p>I did my second Shelly installation in my living room.<br>In this room I have 2 switches at either side of the room to control 2 lights, so two sets of 2-way switches (a.k.a. 3-way or hotel-switch).</p><p>Since I cannot pull any extra wires to either switches or to the lights, I have to do with what&rsquo;s already there.<br>Luckily, at both locations I had access to permanent Live and Neutral, so I only need to take care of the switches and the output.</p><p>There&rsquo;s multiple ways you can get this to work:</p><h4 id=a-using-buttons>a) Using buttons <a href=#a-using-buttons>¶</a></h4><p>The easiest setup would be to replace the switches with buttons (momentary switches).<br>Install a Shelly 2.5 at the final switch and use the switch wires to send the signal for each button.<br>Use a Wago to combine these wires with the wires connected to the matching buttons on the other side and run a wire to SW1 and SW2 respectively.</p><a href=schematic-2way-button-sh25.svg title="Wiring double 2-way momentary switch (buttons) with a Shelly 2.5" target=_blank><figure class=center><img src=schematic-2way-button-sh25.svg alt="Wiring double 2-way momentary switch (buttons) with a Shelly 2.5"><figcaption class=center>Wiring double 2-way momentary switch (buttons) with a Shelly 2.5</figcaption></figure></a><h4 id=b-using-shelly-25-and-shelly-i3>b) Using Shelly 2.5 and Shelly i3 <a href=#b-using-shelly-25-and-shelly-i3>¶</a></h4><p>You could also install a Shelly i3 behind the first switch, using 2 of its 3 inputs.<br>Install a Shelly2.5 behind the final switch and connect the switches/buttons to SW1 and SW2.<br>Use the Actions menu on the Shelly i3 to toggle the outputs on the Shelly 2.5 using the HTTP REST API.<br>I.e., to toggle O1 use the following URL <code>http://&lt;IP_of_Shelly_2.5>/relay/0?turn=toggle</code></p><p>The diagram can be found a bit lower in the blog post.</p><h4 id=c-using-two-shelly-25s>c) Using two Shelly 2.5&rsquo;s <a href=#c-using-two-shelly-25s>¶</a></h4><p>There are also two methods that use two Shelly 2.5&rsquo;s.
Depending on how much room you have to install the Shelly&rsquo;s, you may pick one or the other.<br>The first method is also useful if you don&rsquo;t have Neutral available at the final switch.</p><p>I started with the first method but eventually redid the installation because I had the space and prefered to keep the 2 Shelly&rsquo;s apart to give them some breathing room and keep the temperatures lower.</p><h5 id=both-at-the-end>Both at the end <a href=#both-at-the-end>¶</a></h5><p>First, you could install both Shelly 2.5&rsquo;s at the final switch.</p><p>Since I have two 2-way switches, I have 4 wires running between both locations (two times two switch wires).<br>Using one set of two wires to carry Live and Neutral, I can power one or both Shelly&rsquo;s.
The other two wires are connected to the two switches and SW1/SW2 of the first Shelly.</p><p>I then powered the 2nd Shelly from the wires present at the final switch (but could&rsquo;ve used the previously repurposed switch wires).<br>The two switches at this side are then connected to SW1/SW2 on the 2nd Shelly, matching the order on the other Shelly.</p><p>I then use the HTTP REST API again to have the first Shelly control the outputs of the 2nd one.</p><p>Note: Instead of matching O1 and O2 of one Shelly with a light each, you could also match each Shelly with a certain light.<br>So you&rsquo;d connect the switches controlling the same light to the same Shelly instead of the same SW#.<br>In this scenario, use O1 for the output and setup an action for SW2 to toggle O1 using <code>localhost</code> as target.</p><p>Note2: You can set a relay to Detached mode if it&rsquo;s not linked to an output, so that it doesn&rsquo;t &ldquo;click&rdquo; when you toggle the connected switch. The call to the API will still be executed.</p><h5 id=each-at-a-switch>Each at a switch <a href=#each-at-a-switch>¶</a></h5><p>I finally chose this setup instead, because it&rsquo;s less cramped and leaves more breathing room for the Shelly&rsquo;s.</p><a href=schematic-2way-sh25.svg title="Wiring double 2-way switch with two Shelly 2.5's" target=_blank><figure class=center><img src=schematic-2way-sh25.svg alt="Wiring double 2-way switch with two Shelly 2.5's"><figcaption class=center>Wiring double 2-way switch with two Shelly 2.5&rsquo;s</figcaption></figure></a><p>This installation is basically the same as when using an i3.</p><a href=schematic-2way-sh25-shi3.svg title="Wiring double 2-way switch with Shelly 2.5 and Shelly i3" target=_blank><figure class=center><img src=schematic-2way-sh25-shi3.svg alt="Wiring double 2-way switch with Shelly 2.5 and Shelly i3"><figcaption class=center>Wiring double 2-way switch with Shelly 2.5 and Shelly i3</figcaption></figure></a><p>If you have Live and Neutral available at both switch locations, you don&rsquo;t even need to repurpose any wires.</p><a href=schematic-2way-sh25-shi3-2.svg title="Wiring double 2-way switch with Shelly 2.5 and Shelly i3 using seperate power feeds" target=_blank><figure class=center><img src=schematic-2way-sh25-shi3-2.svg alt="Wiring double 2-way switch with Shelly 2.5 and Shelly i3 using seperate power feeds"><figcaption class=center>Double 2-way switch with seperate power feeds</figcaption></figure></a><h3 id=three-way-switch-with-shelly1pm>Three-way switch with Shelly1(PM) <a href=#three-way-switch-with-shelly1pm>¶</a></h3><p>Below is the most common installation of a 3-way switch, sometimes called 4-way switch or hotel switch.
Three (or more) switches control the same light and physical state of the switch (up/down) is not linked to the state of the lamp.<br>More switches can be added by including more cross-switches in the middle.</p><a href=schematic-3way.svg title="Wiring schematic of 3-way switch" target=_blank><figure class=center><img src=schematic-3way.svg alt="Wiring schematic of 3-way switch"><figcaption class=center>Wiring schematic of 3-way switch</figcaption></figure></a><p>By installing a Shelly1(PM) you can make these switches &ldquo;smart&rdquo;.<br>Install the Shelly as below and set Button Mode to <em>Edge</em>.</p><a href=schematic-3way-shelly.svg title="Wiring schematic of 3-way switch with Shelly1" target=_blank><figure class=center><img src=schematic-3way-shelly.svg alt="Wiring schematic of 3-way switch with Shelly1"><figcaption class=center>Wiring schematic of 3-way switch with Shelly1</figcaption></figure></a><p>Note that you need to either pull an extra wire or <em>borrow</em> one elsewhere to be able to provide permanent Live to the Shelly.</p><h2 id=conclusion>Conclusion <a href=#conclusion>¶</a></h2><p>The devices by Shelly/Allterco are affordable and flexible.<br>They already have quite a big collection of useful and I&rsquo;m certain many more awesome devices will follow.</p><p>I wrote this article when I installed one Shelly 1PM and two Shelly 2.5&rsquo;s (double 2-way setup).<br>Writing this, I actually realised it might be a good idea to replace one of the 2.5&rsquo;s by a Shelly i3 :P</p><p>By the time I published this article, I already upgraded my installation with 2 more Shelly 1PM (front door and back door lighting), 3 Shelly H&amp;T and 2 Shelly Door/Window 2.<br>I&rsquo;m definitely adding more devices in the future :)</p><p>I also integrated my Shelly&rsquo;s in Home Assistant, together with some other devices in my network, and am using Node-RED to build automations.<br>Since the Shelly firmware 1.8 update had some breaking changes to the CoAP implementation, the <a href=https://github.com/StyraHem/ShellyForHASS title="Shelly for HASS" target=_blank rel=noopener>ShellyForHASS</a> plugin is currently broken.
So if you want to use this plugin as well (instead of using e.g. MQTT), you&rsquo;ll currently have to stick with or downgrade to the v1.7 until a new update of the plugin is rolled out.<br>The people behind ShellyForHASS are working hard to push a working update out as soon as possible.</p><p>The <a href=https://www.facebook.com/groups/ShellyIoTCommunitySupport/ title="Shelly support group (English Version)" target=_blank rel=noopener>support group on Facebook</a> is awesome.<br>You have Shelly enthusiasts but also Shelly employees answering just about any question you may have.<br>Also keep an eye on this FB group if you want to stay up-to-date on the latest updates on Shelly, the owner is very active and updates are often posted on FB first.</p><h2 id=changelog>Changelog <a href=#changelog>¶</a></h2><h3 id=update-2021-11-06>Update 2021-11-06 <a href=#update-2021-11-06>¶</a></h3><ul><li>Add section on Shelly configuration</li></ul><h3 id=update-2021-10-18>Update 2021-10-18 <a href=#update-2021-10-18>¶</a></h3><ul><li>Added schematic for 2-way momentary switches</li><li>Small changes in titles</li></ul><h3 id=update-2020-11-06>Update 2020-11-06 <a href=#update-2020-11-06>¶</a></h3><ul><li>Added schematic for 3-way switch</li><li>Added schematic for double 2-way switch using 2 different power feeds</li><li>Small modification to installation instructions to clarify usage of different Live wires between switches and Shelly.</li></ul><h3 id=update-2020-11-05>Update 2020-11-05 <a href=#update-2020-11-05>¶</a></h3><ul><li>Added schematic for 2-way switch</li></ul><h3 id=update-2020-09-12>Update 2020-09-12 <a href=#update-2020-09-12>¶</a></h3><ul><li>ShellyForHASS update is now out of beta and supports Shelly firmware v1.8.x</li></ul><h3 id=update-2020-08-26>Update 2020-08-26 <a href=#update-2020-08-26>¶</a></h3><ul><li>Added schematic for wiring two-way switch using buttons and one Shelly 2.5</li><li>Added schematic for wiring two-way switch using Shelly i3 and Shelly 2.5</li></ul></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/home/>Home</a></span>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/automation/>Automation</a></span>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/shelly/>Shelly</a></span>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/introduction/>Introduction</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a class=p-category href=https://sequr.be/categories/home-automation/>Home Automation</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
3330 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
<time class=dt-published datetime=2020-07-24T02:00:00+02:00>2020-07-24
</time>(Last updated: <time class=dt-updated datetime=2021-11-06T01:00:00+01:00>2021-11-06</time>)</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
<span rel=author class="p-author h-card">DezeStijn</span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
<span rel=bookmark class=u-url><a href=https://sequr.be/2517088605>https://sequr.be/2517088605</a></span></p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href=https://ko-fi.com/s4squatch target=_blank rel=noopener aria-label title="Buy me a coffee"><div class="resp-sharing-button resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsequr.be%2fblog%2f2020%2f07%2fintro-into-shelly%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fsequr.be%2fblog%2f2020%2f07%2fintro-into-shelly%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fsequr.be%2fblog%2f2020%2f07%2fintro-into-shelly%2f&amp;resubmit=true&amp;title=Intro%20into%20Shelly" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Intro%20into%20Shelly&amp;body=https%3a%2f%2fsequr.be%2fblog%2f2020%2f07%2fintro-into-shelly%2f" target=_self rel=noopener aria-label title="Share via email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div></div></a></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://sequr.be/blog/2020/09/upgrade-your-ssh-keys-to-ed25519/><span class=button__icon>←</span>
<span class=button__text>Upgrade your SSH keys (to Ed25519)</span>
</a></span><span class="button next"><a href=https://sequr.be/blog/2020/06/gitlab-unauthenticated-group-and-project-enumeration/><span class=button__text>Gitlab unauthenticated group and project enumeration</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class="footer h-card"><div class=footer__inner><div class=footer__content><span>&copy; 2019</span>
<span><a class="p-name u-url" rel=me href=https://sequr.be/>DezeStijn</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></span>
<span><a href=https://sequr.be/blog/index.xml target=_blank title=rss><svg width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div></footer></div><script type=text/javascript src=https://sequr.be/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>