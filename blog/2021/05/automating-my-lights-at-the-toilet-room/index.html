<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="DezeStijn"><meta name=description content="Automating my (toilet room) lights using an Aqara motion sensor and a Shelly relays, with a twist :)"><meta name=keywords content="Sequr,blog,writeup,CTF,challenge,machine,infosec,IT security,hacking,pentesting,cybersecurity,Home Automation,Shelly,Aqara,Home Assistant,Zigbee,ZHA,Zigbee Home Automation,motion sensor,toilet,Node-RED"><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://sequr.be/blog/2021/05/automating-my-lights-at-the-toilet-room/><title>Automating my lights at the toilet room :: Sequr</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://sequr.be/main.2a064c455b0ecbd6b1481b3bf9df2441e95838691022f40a5338c2cb1244f075.css integrity="sha256-KgZMRVsOy9axSBs7+d8kQelYOGkQIvQKUzjCyxJE8HU="><link rel=stylesheet type=text/css href=https://sequr.be/css/table.css><link rel=stylesheet type=text/css href=https://sequr.be/css/menu.css><link rel=apple-touch-icon sizes=180x180 href=https://sequr.be/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://sequr.be/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://sequr.be/favicon-16x16.png><link rel=manifest href=https://sequr.be/site.webmanifest><link rel=mask-icon href=https://sequr.be/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://sequr.be/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Automating my lights at the toilet room"><meta itemprop=description content="Automating my (toilet room) lights using an Aqara motion sensor and a Shelly relays, with a twist :)"><meta itemprop=datePublished content="2021-05-13T00:00:00+01:00"><meta itemprop=dateModified content="2021-05-13T00:00:00+01:00"><meta itemprop=wordCount content="1640"><meta itemprop=image content="https://sequr.be/blog/2021/05/automating-my-lights-at-the-toilet-room/cover.jpg"><meta itemprop=keywords content="Home Automation,Shelly,Aqara,Home Assistant,Zigbee,ZHA,Zigbee Home Automation,motion sensor,toilet,Node-RED,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2021/05/automating-my-lights-at-the-toilet-room/cover.jpg"><meta name=twitter:title content="Automating my lights at the toilet room"><meta name=twitter:description content="Automating my (toilet room) lights using an Aqara motion sensor and a Shelly relays, with a twist :)"><meta property="article:section" content="Home Automation"><meta property="article:published_time" content="2021-05-13 00:00:00 +0100 +0100"></head><body><div class=container><header class=header><span class=header__inner><a href=https://sequr.be/ style=text-decoration:none><div class=logo><span class=logo__mark>$</span>
<span class=logo__text>nc sequr.be 1337</span>
<span class=logo__cursor style=background-color:#e68101></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://sequr.be/blog/>Blog</a></li><li><a href=https://sequr.be/about/>About</a></li><li><a href=https://sequr.be/shoppinglist/>Shopping</a></li><li><a href=https://sequr.be/privacy/>Privacy</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>8 minutes</p></div><article><h1 class=post-title><a href=https://sequr.be/blog/2021/05/automating-my-lights-at-the-toilet-room/>Automating my lights at the toilet room</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#requirements-shopping-list>Requirements (shopping list)</a></li><li><a href=#install-the-shelly>Install the Shelly</a><ul><li><a href=#wiring>Wiring</a></li><li><a href=#setup-and-adding-to-home-assistant>Setup and adding to Home Assistant</a></li></ul></li><li><a href=#installing-the-aqara-motion-sensor>Installing the Aqara Motion Sensor</a><ul><li><a href=#physical-installation>Physical installation</a></li><li><a href=#setup-and-adding-to-home-assistant-1>Setup and adding to Home Assistant</a><ul><li><a href=#installing-zigbee-home-automation>Installing Zigbee Home Automation</a></li><li><a href=#adding-aqara-motion-sensor-to-zha>Adding Aqara motion sensor to ZHA</a></li></ul></li></ul></li><li><a href=#setting-up-the-node-red-flow>Setting up the Node-RED flow</a></li><li><a href=#the-twist>The twist</a></li></ul></nav></aside><hr><div class=post-content><h2 id=introduction>Introduction <a href=#introduction>¶</a></h2><p>As part of automation all my lights in the house, I also automated the lights in my toilet room.</p><p>To detect if someone&rsquo;s using the toilet I installed a motion sensor.<br>I initially was planning to do this with a door sensor, by quickly realised there would be too many situations in which I&rsquo;d get false triggers or incorrect states.
For example: someone not fully closing the door when using the toilet or someone opening the door when someone&rsquo;s already on the toilet.</p><p>I also added an <em>override</em> using the physical light switch that keeps the lamp on even when the motion sensor didn&rsquo;t detect any motion anymore.
This is mainly to make sure the light wouldn&rsquo;t go out when you&rsquo;re sitting very still.
It also helps with visitors who might not know about the automated lights as the switch&rsquo;s physical position will also reflect the lamp&rsquo;s status,
giving it a &rsquo;natural&rsquo; feeling.</p><p>And I also added a little <em>twist</em>, which I&rsquo;ll explain later in this blog post.</p><p>All of this was done in Node-RED, but it should be possible to do this with Home Assistant automations as well.</p><figure class=center><img src=pexels-roman-odintsov-woman-sitting-on-toilet-bowl-with-smartphone.jpg alt="Image of woman on toilet bowl with smartphone"><figcaption class=center>This isn&rsquo;t me :) kudos to Roman Odintsov on Pexels</figcaption></figure><h2 id=requirements-shopping-list>Requirements (shopping list) <a href=#requirements-shopping-list>¶</a></h2><p>Below is a list of the items I used:</p><ul><li><a href=https://shelly.cloud/products/shelly-1l-single-wire-smart-home-automation-relay/ title="Shelly 1L - Product page" target=_blank rel=noopener>Shelly 1L</a> (<a href=https://shop.shelly.cloud/shelly-1l-wifi-smart-home-automation#407 title="Shelly 1L - European store" target=_blank rel=noopener>EU</a>/<a href=https://shopusa.shelly.cloud/shelly-1-ul-wifi-smart-home-automation-1#164 title="Shelly 1L UL - US Store" target=_blank rel=noopener>US</a>)<br>Get the bypass as well.</li><li><a href=https://s.click.aliexpress.com/e/_A6mMhH title="Aqara Motion Sensor" target=_blank rel=noopener>Aqara Motion Sensor</a></li><li><a href="https://www.phoscon.de/en/conbee2?buy=1#buy" title="ConBee II universal Zigbee USB gateway" target=_blank rel=noopener>Dresden Elektronik ConBee II</a> (<a href=https://smile.amazon.de/dp/B07PZ7ZHG5 title="ConBee II on Amazon DE" target=_blank rel=noopener>DE</a>/<a href=https://smile.amazon.com/dp/B07PZ7ZHG5 title="ConBee II on Amazon US" target=_blank rel=noopener>US</a>)</li></ul><p>If you have Live and Neutral available at the switch or at the light fixture, you could use a Shelly 1 or Shelly 1PM instead.
Then you also won&rsquo;t need the bypass.</p><h2 id=install-the-shelly>Install the Shelly <a href=#install-the-shelly>¶</a></h2><h3 id=wiring>Wiring <a href=#wiring>¶</a></h3><p>I&rsquo;m going to assume you only have a single switch and a single (set of) light(s) in your toilet room.
Check out this <a href=https://sequr.be/blog/2020/07/home-automation-intro-into-shelly/#two-way-switch-with-shelly1pm title="Intro into Shelly - Two-way switch with Shelly1(PM) | Sequr.be">wiring diagram</a> if you have a 2-way/3-way/n-way switch.</p><p>First check which wires you have available and whether you have sufficient space to install a Shelly, usually behind the switch plate or in the light fixture.<br>At the switch, you should at least have a Permanent Live wire feeding the switch and a Switched Live wire going from the switch to the lamp.<br>At the ceiling fixture, you should at least have the Switched Live wire and a Neutral wire.
Depending on how your wiring is done, you may have the Permanent Wire going to the switch in here as well.</p><p>If you only have access to Permanent Live and Switched Live where you&rsquo;d like to install the Shelly, you&rsquo;ll need a Shelly 1L.
Most likely you&rsquo;ll also need the Bypass as the power draw of the (LED) lights will be too low, causing a slight glow when the light&rsquo;s supposed to be turned off.<br>If you also have Neutral available, I&rsquo;d advise going for the Shelly 1 or 1PM instead, as you then don&rsquo;t need the Bypass.</p><p>Have a look at the <a href=https://shelly.cloud/knowledge-base/devices/shelly-1l/#wiring title="Shelly 1L - Wiring diagram" target=_blank rel=noopener>wiring diagram</a> on the Shelly Knowledge Base to see how you should hook up the Shelly.</p><figure class=center><img src=shelly1l_wiring_noneutral.png alt="Wiring diagram for a Shelly 1L with a single switch, no Neutral line, and with bypass"><figcaption class=center>Wiring diagram for the Shelly 1L</figcaption></figure><p><strong>Note:</strong><br>It&rsquo;s important that you connect the switch between the Sx and SW1 terminals when using the Shelly 1L.
Do not connect the switch to the Live wire.</p><p><strong>Note2:</strong><br>The bypass is installed parallel to the lamp, between Switched Live and Neutral.
Don&rsquo;t wire it to Permanent Live or in series to the lamp.</p><h3 id=setup-and-adding-to-home-assistant>Setup and adding to Home Assistant <a href=#setup-and-adding-to-home-assistant>¶</a></h3><p>First hook the Shelly up to your WiFi using the <a href=https://sequr.be/blog/2021/01/home-automation-shelly-web-ui-method/ title="Shelly Web UI method | Sequr.be">Shelly Web UI Method</a> and add it to the Shelly Cloud and/or Shelly mobile app if you want to.</p><p>Then there&rsquo;s some configurations you can do (from the web ui):</p><ul><li>Give the Shelly a <strong>Device Name</strong> and <strong>Channel Name</strong>.
This will later be reflected in Home Assistant once you integrate the Shelly.</li><li>Set <strong>Button 1 Type</strong> to <strong>Toggle Switch</strong>.
This will allow you to still control the light via the switch should the automation not work and will allow you to turn the light of before the automation does.
You could also set it to <strong>Detached</strong> and only rely on the automation.</li><li><strong>Power on default mode</strong> can be set to <em>Off</em> or <strong>Switch 1</strong> depending on whether you want the light to be off after a power failure or to match the switch state.</li><li>Under <strong>LED Light Control</strong> you can enter <strong>Disable Wi-Fi status light</strong> to save a bit of power as you won&rsquo;t see the Shelly anymore once its behind the switch plate.</li></ul><p>Next, add the Shelly to Home Assistant.</p><ul><li>If you&rsquo;re using the built-in <a href=https://www.home-assistant.io/integrations/shelly/ title="Shelly integration for Home Assistant" target=_blank rel=noopener>Shelly integration</a> in Home Assistant, I&rsquo;d advise setting up <a href=https://sequr.be/blog/2021/03/home-automation-shelly-colot-unicast/ title="Shelly ColoT unicast | Sequr.be">Unicast CoIoT</a> to improve the reliability.</li><li>You can also add the Shelly to Home Assistant using <a href=https://sequr.be/blog/2020/10/home-automation-getting-started-with-mqtt-and-home-assistant-and-shelly/ title="Getting started with MQTT and Home Assistant (and Shelly) | Sequr.be">MQTT</a>.</li></ul><h2 id=installing-the-aqara-motion-sensor>Installing the Aqara Motion Sensor <a href=#installing-the-aqara-motion-sensor>¶</a></h2><h3 id=physical-installation>Physical installation <a href=#physical-installation>¶</a></h3><p>A motion sensor usually works best if the movement is perpendicular to the motion sensor instead of towards the sensor.
So it&rsquo;s best to install the sensor at a side wall instead of across the door at a height of 1.2 to 2.1 metres.</p><p>The Aqara motion sensor comes with a small foot and some sticky tape, so it very easy to install.</p><figure class=center><img src=toilet-room_motionsensor.png alt="Drawing of a toilet room with a lamp, switch and motion sensor"><figcaption class=center>Sketch of motion sensor installation</figcaption></figure><h3 id=setup-and-adding-to-home-assistant-1>Setup and adding to Home Assistant <a href=#setup-and-adding-to-home-assistant-1>¶</a></h3><p>The Aqara sensors communicate over Zigbee.
That&rsquo;s why you&rsquo;ll need a Zigebee gateway like the Conbee II which will manage the Zigbee devices.</p><p>There are multiple Zigbee integrations available for Home Assistant.
The most popular ones are Zigbee Home Automation (ZHA), deCONZ and Zigbee2MQTT.<br>Each has their own pros and cons.
ZHA is the &ldquo;default&rdquo; zigbee integration and is well supported by HA.
deCONZ require the use of an add-on which uses Phoscon in the back-end and includes firmware-upgrade functionality for the Conbee.
Zigbee2MQTT allows you to use a &lsquo;satellite&rsquo; system to plug your controller into and supports a wide variety of devices.</p><p>I&rsquo;m going with ZHA, but you can pick whatever Zigbee integration you like.</p><h4 id=installing-zigbee-home-automation>Installing Zigbee Home Automation <a href=#installing-zigbee-home-automation>¶</a></h4><p>If you haven&rsquo;t installed any Zigbee devices yet, the short description of the installation is:</p><ol><li>Plug the Conbee in your Home Assistant device (Raspberry Pi, Odroid, NUC, server, &mldr;) and reboot it.</li><li>Under <em>Supervisor</em> > <em>System</em> > <em>Host</em> > <em>3-dot menu</em> > <em>Hardware</em> you should be able to identify your ConBee II by dresden elektronik ingenieurtechnik gmbh.</li><li>Go to <em>Configuration</em> > <em>Integrations</em> and click the <em>plus icon</em> to add the <a href=https://www.home-assistant.io/integrations/zha/ title="Zigbee Home Automation integration for Home Assistant" target=_blank rel=noopener>ZHA</a> integration.</li><li>In the popup, select the serial device path of the Conbee and pick &lsquo;deconz&rsquo; as radio type.<br>When asked for the device path, it&rsquo;s best to pick the path from the <code>/dev/serial/by-id</code> as that always points to the correct device while a path like <code>/dev/ttyUSB0</code> might change upon reboot.</li></ol><h4 id=adding-aqara-motion-sensor-to-zha>Adding Aqara motion sensor to ZHA <a href=#adding-aqara-motion-sensor-to-zha>¶</a></h4><p>You may want to temporarily take the motion sensor off its stand/foot and place it closer to the Conbee for this step.</p><ol><li>Go to <em>Configuration</em> > <em>Integrations</em> and press the <em>Configure</em> button under Zigbee Home Automation.</li><li>Click the <em>Add device</em> button at the bottom-right. This will start the search procedure.</li><li>With the Aqara motion sensor near the Conbee (and the battery installed), press and hold the small button for 3 seconds to reset it.</li><li>ZHA should discover the motion sensor and a new device should appear.</li></ol><p>You can now rename the device and its related entities, if you want to.</p><p>The Aqara motion sensor device will have 4 entities:</p><ul><li>Motion detected</li><li>Occupancy detection</li><li>Light sensor</li><li>Battery percentage</li></ul><p>For the next section, we&rsquo;ll be using the &ldquo;Motion detected&rdquo; entity.</p><h2 id=setting-up-the-node-red-flow>Setting up the Node-RED flow <a href=#setting-up-the-node-red-flow>¶</a></h2><p>There&rsquo;s a few basic things we want to achieve using this Node-RED flow:</p><ul><li>Have lights turn on when motion is detected.</li><li>Turn lights off when there&rsquo;s no motion detected.</li><li>Have the physical switch still work as usual.</li></ul><p>But there are also one few edge cases we want to take into account:</p><ul><li>Don&rsquo;t have the lights turn off after someone enters the toilet soon after someone left (because of the timer).</li></ul><p>The flow I created for this looks like this:</p><figure class=center><img src=nodered-toilet_lamp_motion.png alt="Node-RED flow for toilet room lights"><figcaption class=center>Automatically turn lights on/off with switch override</figcaption></figure><p>It&rsquo;s best to explain this flow from the moment someone leaves the toilet room:</p><ul><li>Once no more motion is detected a 1 minute timer is started.<br>This is more useful with motion sensors that react immediately.<br>The Aqara motions sensors by default have a 1 minute &lsquo;active&rsquo; time.
I.e., when motion is detected, its sensor will keep reading &lsquo;motion detected&rsquo; for one minute, even if the motion only lasted 5 seconds.<ul><li>When the timer runs out, the state of the switch is checked.<ul><li>If the switch is in the &lsquo;off&rsquo; position, the light is turned off.</li><li>If the switch is in the &lsquo;on&rsquo; position, the light stays on as the flow ends.</li></ul></li></ul></li><li>If motion is detected, the light is turned on.<ul><li>Additionally, the timer mentioned above is reset.<br>This will make sure the lights don&rsquo;t turn off if someone enters the toilet room within 1 minute of the previous person leaving.</li></ul></li></ul><p>Below is the JSON code for this flow:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;ed2e1cbc.08f93&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;server-state-changed&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Movement detected&#34;</span><span class=p>,</span><span class=nt>&#34;server&#34;</span><span class=p>:</span><span class=s2>&#34;2ce15169.23b9de&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;exposeToHomeAssistant&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;haConfig&#34;</span><span class=p>:[{</span><span class=nt>&#34;property&#34;</span><span class=p>:</span><span class=s2>&#34;name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>},{</span><span class=nt>&#34;property&#34;</span><span class=p>:</span><span class=s2>&#34;icon&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}],</span><span class=nt>&#34;entityidfilter&#34;</span><span class=p>:</span><span class=s2>&#34;binary_sensor.toilet_motion_sensor&#34;</span><span class=p>,</span><span class=nt>&#34;entityidfiltertype&#34;</span><span class=p>:</span><span class=s2>&#34;exact&#34;</span><span class=p>,</span><span class=nt>&#34;outputinitially&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;state_type&#34;</span><span class=p>:</span><span class=s2>&#34;habool&#34;</span><span class=p>,</span><span class=nt>&#34;haltifstate&#34;</span><span class=p>:</span><span class=s2>&#34;true&#34;</span><span class=p>,</span><span class=nt>&#34;halt_if_type&#34;</span><span class=p>:</span><span class=s2>&#34;bool&#34;</span><span class=p>,</span><span class=nt>&#34;halt_if_compare&#34;</span><span class=p>:</span><span class=s2>&#34;is&#34;</span><span class=p>,</span><span class=nt>&#34;outputs&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;output_only_on_state_change&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>130</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>240</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[</span><span class=s2>&#34;695553c8.4a6f0c&#34;</span><span class=p>,</span><span class=s2>&#34;59bb07c3.40c378&#34;</span><span class=p>],[</span><span class=s2>&#34;d59925e4.632f2&#34;</span><span class=p>]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;59bb07c3.40c378&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;api-call-service&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Turn light on&#34;</span><span class=p>,</span><span class=nt>&#34;server&#34;</span><span class=p>:</span><span class=s2>&#34;2ce15169.23b9de&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;debugenabled&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;service_domain&#34;</span><span class=p>:</span><span class=s2>&#34;light&#34;</span><span class=p>,</span><span class=nt>&#34;service&#34;</span><span class=p>:</span><span class=s2>&#34;turn_on&#34;</span><span class=p>,</span><span class=nt>&#34;entityId&#34;</span><span class=p>:</span><span class=s2>&#34;light.toilet_lamp&#34;</span><span class=p>,</span><span class=nt>&#34;data&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;dataType&#34;</span><span class=p>:</span><span class=s2>&#34;json&#34;</span><span class=p>,</span><span class=nt>&#34;mergecontext&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;output_location&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;output_location_type&#34;</span><span class=p>:</span><span class=s2>&#34;none&#34;</span><span class=p>,</span><span class=nt>&#34;mustacheAltTags&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>370</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>240</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;c9acffbd.23f0c8&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;api-call-service&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Turn light off&#34;</span><span class=p>,</span><span class=nt>&#34;server&#34;</span><span class=p>:</span><span class=s2>&#34;2ce15169.23b9de&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;debugenabled&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;service_domain&#34;</span><span class=p>:</span><span class=s2>&#34;light&#34;</span><span class=p>,</span><span class=nt>&#34;service&#34;</span><span class=p>:</span><span class=s2>&#34;turn_off&#34;</span><span class=p>,</span><span class=nt>&#34;entityId&#34;</span><span class=p>:</span><span class=s2>&#34;light.toilet_lamp&#34;</span><span class=p>,</span><span class=nt>&#34;data&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;dataType&#34;</span><span class=p>:</span><span class=s2>&#34;json&#34;</span><span class=p>,</span><span class=nt>&#34;mergecontext&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;output_location&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;output_location_type&#34;</span><span class=p>:</span><span class=s2>&#34;none&#34;</span><span class=p>,</span><span class=nt>&#34;mustacheAltTags&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>710</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>340</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;8058a839.544e&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;api-current-state&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Switch on?&#34;</span><span class=p>,</span><span class=nt>&#34;server&#34;</span><span class=p>:</span><span class=s2>&#34;2ce15169.23b9de&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;outputs&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;halt_if&#34;</span><span class=p>:</span><span class=s2>&#34;true&#34;</span><span class=p>,</span><span class=nt>&#34;halt_if_type&#34;</span><span class=p>:</span><span class=s2>&#34;bool&#34;</span><span class=p>,</span><span class=nt>&#34;halt_if_compare&#34;</span><span class=p>:</span><span class=s2>&#34;is&#34;</span><span class=p>,</span><span class=nt>&#34;override_topic&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;entity_id&#34;</span><span class=p>:</span><span class=s2>&#34;binary_sensor.toilet_switch&#34;</span><span class=p>,</span><span class=nt>&#34;state_type&#34;</span><span class=p>:</span><span class=s2>&#34;habool&#34;</span><span class=p>,</span><span class=nt>&#34;state_location&#34;</span><span class=p>:</span><span class=s2>&#34;payload&#34;</span><span class=p>,</span><span class=nt>&#34;override_payload&#34;</span><span class=p>:</span><span class=s2>&#34;msg&#34;</span><span class=p>,</span><span class=nt>&#34;entity_location&#34;</span><span class=p>:</span><span class=s2>&#34;data&#34;</span><span class=p>,</span><span class=nt>&#34;override_data&#34;</span><span class=p>:</span><span class=s2>&#34;msg&#34;</span><span class=p>,</span><span class=nt>&#34;blockInputOverrides&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>530</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>340</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[],[</span><span class=s2>&#34;c9acffbd.23f0c8&#34;</span><span class=p>]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;d59925e4.632f2&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;delay&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;pauseType&#34;</span><span class=p>:</span><span class=s2>&#34;delay&#34;</span><span class=p>,</span><span class=nt>&#34;timeout&#34;</span><span class=p>:</span><span class=s2>&#34;1&#34;</span><span class=p>,</span><span class=nt>&#34;timeoutUnits&#34;</span><span class=p>:</span><span class=s2>&#34;minutes&#34;</span><span class=p>,</span><span class=nt>&#34;rate&#34;</span><span class=p>:</span><span class=s2>&#34;1&#34;</span><span class=p>,</span><span class=nt>&#34;nbRateUnits&#34;</span><span class=p>:</span><span class=s2>&#34;1&#34;</span><span class=p>,</span><span class=nt>&#34;rateUnits&#34;</span><span class=p>:</span><span class=s2>&#34;second&#34;</span><span class=p>,</span><span class=nt>&#34;randomFirst&#34;</span><span class=p>:</span><span class=s2>&#34;1&#34;</span><span class=p>,</span><span class=nt>&#34;randomLast&#34;</span><span class=p>:</span><span class=s2>&#34;5&#34;</span><span class=p>,</span><span class=nt>&#34;randomUnits&#34;</span><span class=p>:</span><span class=s2>&#34;seconds&#34;</span><span class=p>,</span><span class=nt>&#34;drop&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>360</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>340</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[</span><span class=s2>&#34;8058a839.544e&#34;</span><span class=p>]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;695553c8.4a6f0c&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;change&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;rules&#34;</span><span class=p>:[{</span><span class=nt>&#34;t&#34;</span><span class=p>:</span><span class=s2>&#34;set&#34;</span><span class=p>,</span><span class=nt>&#34;p&#34;</span><span class=p>:</span><span class=s2>&#34;reset&#34;</span><span class=p>,</span><span class=nt>&#34;pt&#34;</span><span class=p>:</span><span class=s2>&#34;msg&#34;</span><span class=p>,</span><span class=nt>&#34;to&#34;</span><span class=p>:</span><span class=s2>&#34;true&#34;</span><span class=p>,</span><span class=nt>&#34;tot&#34;</span><span class=p>:</span><span class=s2>&#34;bool&#34;</span><span class=p>}],</span><span class=nt>&#34;action&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;property&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;from&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;to&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;reg&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>380</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>280</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[</span><span class=s2>&#34;d59925e4.632f2&#34;</span><span class=p>]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;1aa0cdfe.eb810a&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;comment&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;sequr.be&#34;</span><span class=p>,</span><span class=nt>&#34;info&#34;</span><span class=p>:</span><span class=s2>&#34;More information on this flow can be found at https://sequr.be/blog/2021/05/home-automation-automating-my-lights-at-the-toilet-room/&#34;</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>160</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>320</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;2ce15169.23b9de&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;server&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Home Assistant&#34;</span><span class=p>,</span><span class=nt>&#34;legacy&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;addon&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;rejectUnauthorizedCerts&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;ha_boolean&#34;</span><span class=p>:</span><span class=s2>&#34;y|yes|true|on|home|open&#34;</span><span class=p>,</span><span class=nt>&#34;connectionDelay&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;cacheJson&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>}]</span>
</span></span></code></pre></div><h2 id=the-twist>The twist <a href=#the-twist>¶</a></h2><p>As I alluded to a few times, I also added a little <em>twist</em> to my flow.</p><p>Can you figure out from the screenshot below what I did? ;)</p><figure class=center><img src=nodered-toilet_lamp_timer.png alt="Node-RED flow for toilet room timer"><figcaption class=center>Let people know they&rsquo;ve been pooping too long :D</figcaption></figure><p><strong>Spoiler</strong><br>When the light in the toilet room has been on for 15 minutes the light is toggled shortly as some sort of hint to the person sitting on the toilet.<br>Time to put away the smartphone/book/&mldr; and get back to business ;)</p><p>Here&rsquo;s the JSON code for this flow:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;770017d9.000b48&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;server-state-changed&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Light on&#34;</span><span class=p>,</span><span class=nt>&#34;server&#34;</span><span class=p>:</span><span class=s2>&#34;2ce15169.23b9de&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;exposeToHomeAssistant&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;haConfig&#34;</span><span class=p>:[{</span><span class=nt>&#34;property&#34;</span><span class=p>:</span><span class=s2>&#34;name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>},{</span><span class=nt>&#34;property&#34;</span><span class=p>:</span><span class=s2>&#34;icon&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}],</span><span class=nt>&#34;entityidfilter&#34;</span><span class=p>:</span><span class=s2>&#34;light.toilet_lamp&#34;</span><span class=p>,</span><span class=nt>&#34;entityidfiltertype&#34;</span><span class=p>:</span><span class=s2>&#34;exact&#34;</span><span class=p>,</span><span class=nt>&#34;outputinitially&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;state_type&#34;</span><span class=p>:</span><span class=s2>&#34;habool&#34;</span><span class=p>,</span><span class=nt>&#34;haltifstate&#34;</span><span class=p>:</span><span class=s2>&#34;true&#34;</span><span class=p>,</span><span class=nt>&#34;halt_if_type&#34;</span><span class=p>:</span><span class=s2>&#34;bool&#34;</span><span class=p>,</span><span class=nt>&#34;halt_if_compare&#34;</span><span class=p>:</span><span class=s2>&#34;is&#34;</span><span class=p>,</span><span class=nt>&#34;outputs&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;output_only_on_state_change&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>100</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>60</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[</span><span class=s2>&#34;f9c49225.ef2f98&#34;</span><span class=p>],[]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;f9c49225.ef2f98&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;stoptimer&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;duration&#34;</span><span class=p>:</span><span class=s2>&#34;15&#34;</span><span class=p>,</span><span class=nt>&#34;units&#34;</span><span class=p>:</span><span class=s2>&#34;Minute&#34;</span><span class=p>,</span><span class=nt>&#34;payloadtype&#34;</span><span class=p>:</span><span class=s2>&#34;num&#34;</span><span class=p>,</span><span class=nt>&#34;payloadval&#34;</span><span class=p>:</span><span class=s2>&#34;0&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>300</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>60</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[],[</span><span class=s2>&#34;8d25fbe6.f8fdc8&#34;</span><span class=p>]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;8d25fbe6.f8fdc8&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;api-current-state&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Light still on?&#34;</span><span class=p>,</span><span class=nt>&#34;server&#34;</span><span class=p>:</span><span class=s2>&#34;2ce15169.23b9de&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;outputs&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;halt_if&#34;</span><span class=p>:</span><span class=s2>&#34;true&#34;</span><span class=p>,</span><span class=nt>&#34;halt_if_type&#34;</span><span class=p>:</span><span class=s2>&#34;bool&#34;</span><span class=p>,</span><span class=nt>&#34;halt_if_compare&#34;</span><span class=p>:</span><span class=s2>&#34;is&#34;</span><span class=p>,</span><span class=nt>&#34;override_topic&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;entity_id&#34;</span><span class=p>:</span><span class=s2>&#34;light.toilet_lamp&#34;</span><span class=p>,</span><span class=nt>&#34;state_type&#34;</span><span class=p>:</span><span class=s2>&#34;habool&#34;</span><span class=p>,</span><span class=nt>&#34;state_location&#34;</span><span class=p>:</span><span class=s2>&#34;payload&#34;</span><span class=p>,</span><span class=nt>&#34;override_payload&#34;</span><span class=p>:</span><span class=s2>&#34;msg&#34;</span><span class=p>,</span><span class=nt>&#34;entity_location&#34;</span><span class=p>:</span><span class=s2>&#34;data&#34;</span><span class=p>,</span><span class=nt>&#34;override_data&#34;</span><span class=p>:</span><span class=s2>&#34;msg&#34;</span><span class=p>,</span><span class=nt>&#34;blockInputOverrides&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>510</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>60</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[</span><span class=s2>&#34;de1a4ca9.6fe9f&#34;</span><span class=p>],[]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;5fb82301.096bd4&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;api-call-service&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Light toggle&#34;</span><span class=p>,</span><span class=nt>&#34;server&#34;</span><span class=p>:</span><span class=s2>&#34;2ce15169.23b9de&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;debugenabled&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;service_domain&#34;</span><span class=p>:</span><span class=s2>&#34;light&#34;</span><span class=p>,</span><span class=nt>&#34;service&#34;</span><span class=p>:</span><span class=s2>&#34;toggle&#34;</span><span class=p>,</span><span class=nt>&#34;entityId&#34;</span><span class=p>:</span><span class=s2>&#34;light.toilet_lamp&#34;</span><span class=p>,</span><span class=nt>&#34;data&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;dataType&#34;</span><span class=p>:</span><span class=s2>&#34;json&#34;</span><span class=p>,</span><span class=nt>&#34;mergecontext&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;output_location&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;output_location_type&#34;</span><span class=p>:</span><span class=s2>&#34;none&#34;</span><span class=p>,</span><span class=nt>&#34;mustacheAltTags&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>910</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>60</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;de1a4ca9.6fe9f&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;trigger&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;0.5s toggle&#34;</span><span class=p>,</span><span class=nt>&#34;op1&#34;</span><span class=p>:</span><span class=s2>&#34;off&#34;</span><span class=p>,</span><span class=nt>&#34;op2&#34;</span><span class=p>:</span><span class=s2>&#34;on&#34;</span><span class=p>,</span><span class=nt>&#34;op1type&#34;</span><span class=p>:</span><span class=s2>&#34;str&#34;</span><span class=p>,</span><span class=nt>&#34;op2type&#34;</span><span class=p>:</span><span class=s2>&#34;str&#34;</span><span class=p>,</span><span class=nt>&#34;duration&#34;</span><span class=p>:</span><span class=s2>&#34;500&#34;</span><span class=p>,</span><span class=nt>&#34;extend&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;units&#34;</span><span class=p>:</span><span class=s2>&#34;ms&#34;</span><span class=p>,</span><span class=nt>&#34;reset&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;bytopic&#34;</span><span class=p>:</span><span class=s2>&#34;all&#34;</span><span class=p>,</span><span class=nt>&#34;topic&#34;</span><span class=p>:</span><span class=s2>&#34;topic&#34;</span><span class=p>,</span><span class=nt>&#34;outputs&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>710</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>60</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[</span><span class=s2>&#34;5fb82301.096bd4&#34;</span><span class=p>],[</span><span class=s2>&#34;5fb82301.096bd4&#34;</span><span class=p>,</span><span class=s2>&#34;d4adc37e.d3099&#34;</span><span class=p>]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;fe70c04d.b3e158&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;link in&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Reset&#34;</span><span class=p>,</span><span class=nt>&#34;links&#34;</span><span class=p>:[</span><span class=s2>&#34;d4adc37e.d3099&#34;</span><span class=p>],</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>155</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>100</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[[</span><span class=s2>&#34;f9c49225.ef2f98&#34;</span><span class=p>]]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;d4adc37e.d3099&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;link out&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Reset&#34;</span><span class=p>,</span><span class=nt>&#34;links&#34;</span><span class=p>:[</span><span class=s2>&#34;fe70c04d.b3e158&#34;</span><span class=p>],</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>835</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>100</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;1aa0cdfe.eb810a&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;comment&#34;</span><span class=p>,</span><span class=nt>&#34;z&#34;</span><span class=p>:</span><span class=s2>&#34;ef850b1b.00efb&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;sequr.be&#34;</span><span class=p>,</span><span class=nt>&#34;info&#34;</span><span class=p>:</span><span class=s2>&#34;More information on this flow can be found at https://sequr.be/blog/2021/05/home-automation-automating-my-lights-at-the-toilet-room/&#34;</span><span class=p>,</span><span class=nt>&#34;x&#34;</span><span class=p>:</span><span class=mi>460</span><span class=p>,</span><span class=nt>&#34;y&#34;</span><span class=p>:</span><span class=mi>100</span><span class=p>,</span><span class=nt>&#34;wires&#34;</span><span class=p>:[]},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;2ce15169.23b9de&#34;</span><span class=p>,</span><span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;server&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Home Assistant&#34;</span><span class=p>,</span><span class=nt>&#34;legacy&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>,</span><span class=nt>&#34;addon&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;rejectUnauthorizedCerts&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;ha_boolean&#34;</span><span class=p>:</span><span class=s2>&#34;y|yes|true|on|home|open&#34;</span><span class=p>,</span><span class=nt>&#34;connectionDelay&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;cacheJson&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>}]</span>
</span></span></code></pre></div><p>Note: the In/Out nodes might not be required, as the flow should restart automatically after the light turns on again.</p><hr><p>There you go: we have automated our (toilet room) lights using a motion sensor!</p><p>Liked my automation?
Got ideas for improvements?
Reach out to me on <a href=https://twitter.com/DezeStijn title="@DezeStijn on Twitter" target=_blank rel=noopener>Twitter</a>!</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://sequr.be/tags/home-automation/>Home Automation</a></span>
<span class=tag><a href=https://sequr.be/tags/shelly/>Shelly</a></span>
<span class=tag><a href=https://sequr.be/tags/aqara/>Aqara</a></span>
<span class=tag><a href=https://sequr.be/tags/home-assistant/>Home Assistant</a></span>
<span class=tag><a href=https://sequr.be/tags/zigbee/>Zigbee</a></span>
<span class=tag><a href=https://sequr.be/tags/zha/>ZHA</a></span>
<span class=tag><a href=https://sequr.be/tags/zigbee-home-automation/>Zigbee Home Automation</a></span>
<span class=tag><a href=https://sequr.be/tags/motion-sensor/>motion sensor</a></span>
<span class=tag><a href=https://sequr.be/tags/toilet/>toilet</a></span>
<span class=tag><a href=https://sequr.be/tags/node-red/>Node-RED</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://sequr.be/categories/home-automation/>Home Automation</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1640 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-05-12</p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href=https://ko-fi.com/s4squatch target=_blank rel=noopener aria-label title="Buy me a coffee"><div class="resp-sharing-button resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsequr.be%2fblog%2f2021%2f05%2fautomating-my-lights-at-the-toilet-room%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fsequr.be%2fblog%2f2021%2f05%2fautomating-my-lights-at-the-toilet-room%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fsequr.be%2fblog%2f2021%2f05%2fautomating-my-lights-at-the-toilet-room%2f&amp;resubmit=true&amp;title=Automating%20my%20lights%20at%20the%20toilet%20room" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=Automating%20my%20lights%20at%20the%20toilet%20room%20https%3a%2f%2fsequr.be%2fblog%2f2021%2f05%2fautomating-my-lights-at-the-toilet-room%2f" target=_blank rel=noopener aria-label title="Share on whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893a11.821 11.821.0 00-3.48-8.413z"/></svg></div></div></a></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://sequr.be/blog/2021/07/add-an-epaper-display-to-your-esp32-waveshare/><span class=button__icon>←</span>
<span class=button__text>Add an ePaper display to your ESP32 (Waveshare)</span></a></span>
<span class="button next"><a href=https://sequr.be/blog/2021/04/diy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion/><span class=button__text>DIY Ambilight for your TV or computer using a RPi and Hyperion</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2019-2023</span>
<span><a href=https://sequr.be>DezeStijn</a></span>
<span><a href=https://sequr.be/blog/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><small><span>Powered by <a href=http://gohugo.io>Hugo</a>.</span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span><br><span>Deployed using <a href=https://github.com/TheGroundZero/TheGroundZero.github.io/ title=TheGroundZero/TheGroundZero.github.io>GitHub Pages</a></span></small></div></div></footer></div><script type=text/javascript src=https://sequr.be/bundle.min.c90b8161416b87c69a8e02683b54ddd6edb90aea699648bf655e6cbc45b419b8e465d196e715772463dba35a6faf5decb2eb247480d38680484d54645b434570.js integrity="sha512-yQuBYUFrh8aajgJoO1Td1u25Cupplki/ZV5svEW0GbjkZdGW5xV3JGPbo1pvr13ssuskdIDThoBITVRkW0NFcA=="></script></body></html>