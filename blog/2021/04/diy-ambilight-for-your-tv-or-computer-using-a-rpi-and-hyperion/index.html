<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="DezeStijn"><meta name=description content="Setting up DIY ambilighting for my TV using a Raspberry Pi and Hyperion"><meta name=keywords content="Sequr,blog,writeup,CTF,challenge,machine,infosec,IT security,hacking,pentesting,cybersecurity,Home Automation,Hyperion,Ambilight,Raspberry Pi"><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://sequr.be/blog/2021/04/diy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion/><title>DIY Ambilight for your TV or computer using a RPi and Hyperion :: Sequr
</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://sequr.be/main.2a064c455b0ecbd6b1481b3bf9df2441e95838691022f40a5338c2cb1244f075.css integrity="sha256-KgZMRVsOy9axSBs7+d8kQelYOGkQIvQKUzjCyxJE8HU="><link rel=stylesheet type=text/css href=https://sequr.be/css/table.css><link rel=stylesheet type=text/css href=https://sequr.be/css/menu.css><link rel=apple-touch-icon sizes=180x180 href=https://sequr.be/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://sequr.be/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://sequr.be/favicon-16x16.png><link rel=manifest href=https://sequr.be/site.webmanifest><link rel=mask-icon href=https://sequr.be/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://sequr.be/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="DIY Ambilight for your TV or computer using a RPi and Hyperion"><meta itemprop=description content="Setting up DIY ambilighting for my TV using a Raspberry Pi and Hyperion"><meta itemprop=datePublished content="2021-04-18T00:00:00+00:00"><meta itemprop=dateModified content="2023-03-30T00:00:00+00:00"><meta itemprop=wordCount content="2743"><meta itemprop=image content="https://sequr.be/blog/2021/04/diy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion/cover.png"><meta itemprop=keywords content="Home Automation,Hyperion,Ambilight,Raspberry Pi,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2021/04/diy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion/cover.png"><meta name=twitter:title content="DIY Ambilight for your TV or computer using a RPi and Hyperion"><meta name=twitter:description content="Setting up DIY ambilighting for my TV using a Raspberry Pi and Hyperion"><meta property="article:section" content="Home Automation"><meta property="article:published_time" content="2021-04-18 00:00:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=https://sequr.be/ style=text-decoration:none><div class=logo><span class=logo__mark>$</span>
<span class=logo__text>lynx sequr.be</span>
<span class=logo__cursor style=background-color:#e68101></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://sequr.be/blog/>Blog</a></li><li><a href=https://sequr.be/about/>About</a></li><li><a href=https://sequr.be/shoppinglist/>Shopping</a></li><li><a href=https://sequr.be/privacy/>Privacy</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>13 minutes</p></div><article><h1 class=post-title><a href=https://sequr.be/blog/2021/04/diy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion/>DIY Ambilight for your TV or computer using a RPi and Hyperion</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#requirements-shopping-list>Requirements (shopping list)</a><ul><li><a href=#optional>Optional</a></li></ul></li><li><a href=#wiring-the-led-strip>Wiring the LED strip</a></li><li><a href=#providing-power>Providing power</a></li><li><a href=#installing-hyperion>Installing Hyperion</a></li><li><a href=#hooking-the-rpi-up-to-the-led-strip>Hooking the RPi up to the LED strip</a></li><li><a href=#capturing-video>Capturing video</a></li><li><a href=#configuring-hyperion>Configuring Hyperion</a><ul><li><a href=#general>General</a></li><li><a href=#led-hardware>LED Hardware</a></li><li><a href=#capturing-hardware>Capturing hardware</a></li><li><a href=#effects>Effects</a></li><li><a href=#image-processing>Image Processing</a></li><li><a href=#network-services>Network Services</a></li></ul></li><li><a href=#testing-the-setup>Testing the setup</a></li><li><a href=#note-on-using-ws281x-leds>Note on using WS281x LEDs</a></li><li><a href=#pitfalls--lessons-learned>Pitfalls / Lessons learned</a></li></ul></nav></aside><hr><div class=post-content><h2 id=introduction>Introduction <a href=#introduction>¶</a></h2><p>After seeing some videos by DrZzs and others on setting up DIY ambient lighting for your TV,
I knew I wanted to have this :)</p><p>I took some time to find the correct hardware on AliExpress, noting that I don&rsquo;t want to downgrade my video from 4K to e.g. 1080P
and that I might need to look out for DRM protections (<a href=https://en.wikipedia.org/wiki/High-bandwidth_Digital_Content_Protection title="High-bandwidth Digital Content Protection - Wikipedia" target=_blank rel=noopener>HDCP</a>), I put together my shopping list and the waiting could start &mldr;</p><p>In this blog post I&rsquo;ll explain how I set up DIY Ambilight for my TV using Hyperion.</p><p>Since I have 2 devices providing video to my television (set-top box for digital television and a <a href=https://osmc.tv/vero/ title="OSMC Vero 4K+" target=_blank rel=noopener>OSMC Vero 4K+</a> for my own video collection),
I also needed to add a HDMI switch to the loop.<br>I specifically looked for a device that could either auto-detect the playing device, or at least came with a remote.
The remote I could then link to my Broadlink RM4Pro so that Home Assistant can automatically switch to the correct source.</p><figure class=center><img src=hyperbian.gif alt="Logo of HyperBian"><figcaption class=center>HyperBian</figcaption></figure><h2 id=requirements-shopping-list>Requirements (shopping list) <a href=#requirements-shopping-list>¶</a></h2><p>You can get everything you need from AliExpress.<br>Get it even cheaper using a <a href=https://a.aliexpress.com/_mOHBLsP title="AliExpress €21,00 coupon" target=_blank rel=noopener>welcome coupon</a>.</p><ul><li>A Raspberry Pi that&rsquo;ll run <a href=https://docs.hyperion-project.org/ title=Hyperion target=_blank rel=noopener>Hyperion</a> via <a href=https://github.com/hyperion-project/HyperBian title="HyperBian - Raspberry Pi OS Lite with Hyperion" target=_blank rel=noopener>HyperBian</a>.<br>Some processing power is required for smooth effects, <a href=https://s.click.aliexpress.com/e/_9xuW1h title="Raspberry Pi 3B/3B+" target=_blank rel=noopener>RPi 3B+</a> should suffice.</li><li><a href=https://www.aliexpress.com/item/4000627262613.html title="Kingston micro-SD card class 10" target=_blank rel=noopener>Micro-SD card</a> with at least 2GB size</li><li>Individually addressable RGB LED strips.<br>I went for <a href=https://s.click.aliexpress.com/e/_ADFqfc title="BTF-Lighting WS2812 RGB Individually Addressable Led Strip" target=_blank rel=noopener>WS2812B eco</a> with a black PCB, 60 LEDs/m.
5V suffices for the length we need and it&rsquo;s easier because the RPi also runs on 5V.</li><li><a href=https://s.click.aliexpress.com/e/_Aa86O2 title="4K 60fps capture card with 1080P 60fps capture feed" target=_blank rel=noopener>Video capture card</a>.<br>The 4K 60fps model is only a little bit more expensive than the 4K 30fps one.</li><li><a href=https://s.click.aliexpress.com/e/_9Is2aX title="HDMI 2.0 (4K) / 2.1 (8K) cables" target=_blank rel=noopener>HDMI cable</a>.<br>You&rsquo;ll need an extra HDMI cable between the HDMI switch and capture card (if applicable) and between the capture card and your television.<br>Make sure it supports the max. resolution and framerate your video sources provide.
I got HDMI 2.0 cables which support 4K 60fps. HDMI 1.4 suffices for 4K 30fps, and for 8K you should get HDMI 2.1 cables.</li><li>Power supply unit (PSU) <a href=https://s.click.aliexpress.com/e/_A8Ai0Q title="KAYPW power supply (open frame style)" target=_blank rel=noopener>frame style</a> (5V 60W/12A) or <a href=https://s.click.aliexpress.com/e/_A88KnM title="BOLE DENGYE power supply (power brick style)" target=_blank rel=noopener>power brick style</a> (5V 50W/10A).<br>The required power output will depend on how much LEDs you have (length and LED density) and how bright you have them.</li><li><a href=https://www.aliexpress.com/item/32821229368.html title="10 meters electrical wire, tinned copper, PVC insulated" target=_blank rel=noopener>Electrical wire</a> to connect the power supply, the LED strip, the RPi, &mldr;</li><li>Sacrificial <a href=https://s.click.aliexpress.com/e/_A3mxVG title="MicroUSB cable" target=_blank rel=noopener>microUSB cable</a><br>We&rsquo;ll only need to microUSB port for powering the RPi.</li><li><a href=https://s.click.aliexpress.com/e/_Ao690a title="Wago style wire connectors" target=_blank rel=noopener>Wire connectors</a> (<a href=https://s.click.aliexpress.com/e/_A2Jgft title="Wago style wire connectors (2 in 4 out)" target=_blank rel=noopener>different model</a>)<br>For wiring power cables for the LED strip and RPi into the power supply.</li><li>Female-male <a href=https://www.aliexpress.com/item/33015288855.html title="Dupont wires MM/FM/FF" target=_blank rel=noopener>Dupont wire</a><br>To get the data signal from the RPi to the LED strip.</li></ul><h3 id=optional>Optional <a href=#optional>¶</a></h3><p>These items may be useful, but aren&rsquo;t required.</p><ul><li><a href=https://www.aliexpress.com/item/32849519375.html title="HDMI 2.0 switch 4K HDR 60fps HDCP 2.2" target=_blank rel=noopener>HDMI switch</a> in case you have more than 1 HDMI input device.</li><li><a href=https://s.click.aliexpress.com/e/_AtIBp8 title="BTF-Lighting corner connectors" target=_blank rel=noopener>LED strip corner connectors</a> (3 pin 10mm)</li><li><a href=https://s.click.aliexpress.com/e/_9wv0yW title="3pin JST connectors" target=_blank rel=noopener>JST Connectors</a>, can be used for power injection or connecting strips</li><li><a href=https://s.click.aliexpress.com/e/_ALlYgA title="Heat shrink solder connectors" target=_blank rel=noopener>Heat shrink solder connectors &ldquo;solderless connection&rdquo;</a>, if you don&rsquo;t feel like soldering</li><li><a href=https://s.click.aliexpress.com/e/_AdcCIf title="Double-sided foam tape" target=_blank rel=noopener>Double sided tape</a> to stick the devices and LED strip to the back of the TV</li><li><a href=https://www.aliexpress.com/item/1005001841920230.html title="Velcro tape" target=_blank rel=noopener>Velcro tape</a> to stick the devices to the back of the TV if you don&rsquo;t want to use regular tape.</li><li><a href=https://s.click.aliexpress.com/e/_AZNLoi title="Extension word" target=_blank rel=noopener>Extension cord</a> to power the power supply</li><li><a href=https://www.aliexpress.com/item/33001628978.html title="Wire crimp connector set" target=_blank rel=noopener>Wire crimp connector set</a> (ferrules) for connecting stranded wires in the Wago connectors.</li><li><a href=https://s.click.aliexpress.com/e/_AOXLmF title="Insulated Crimp Ring/Fork Terminals" target=_blank rel=noopener>Wire ring/fork connectors</a> for securely connecting wires onto the power supply</li><li><a href=https://s.click.aliexpress.com/e/_AtwAUx title="RM102Pro Digital Multimeter" target=_blank rel=noopener>Digital Multimeter</a> to measure output of the PSU and the power drop over the LED strip.</li></ul><p>I also advise reading the &ldquo;Lessons Learned&rdquo; section at the bottom before starting with the project.</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center></th><th style=text-align:center></th><th style=text-align:center></th></tr></thead><tbody><tr><td style=text-align:center><figure class=center><img src=ambilight_ledstrips.png alt="LED strip WS2812Beco"><figcaption class=center>LED strip</figcaption></figure></td><td style=text-align:center><figure class=center><img src=ambilight_psu.png alt="Power Supply Unit (PSU)"><figcaption class=center>Power supply</figcaption></figure></td><td style=text-align:center><figure class=center><img src=ambilight_capturecard.png alt="Capture card"><figcaption class=center>Capture card</figcaption></figure></td><td style=text-align:center><figure class=center><img src=ambilight_hdmiswitch.png alt="HDMI switch"><figcaption class=center>HDMI switch</figcaption></figure></td></tr></tbody></table><h2 id=wiring-the-led-strip>Wiring the LED strip <a href=#wiring-the-led-strip>¶</a></h2><ol><li>You&rsquo;ll first want to measure the 4 sides of your television and envision where you want to place the LED strips.<br>The LED strips should be on the back of the television, near the edge.<br>Take into account any bumps, holes, connections, &mldr; that may cause issues for sticking the LED strip.<br>Note that the corner connectors take up quite some space.</li><li>Cut the LED strips to size.<br>Look at the LED strip for the copper pads you can cut in.<br>If you want more space on the pads to solder, you could cut at the end of the copper strip and sacrifice a LED at each cut.</li><li>Stick the LEDs to the TV.
Start from one corner and work your way around the TV.<br>Hyperion by default assumes you start in the top-left corner and work clockwise (as seen from the front) but we can change the config later on.<br>Take into account where you want to stick the RPi as you&rsquo;ll need to be able to connect the data wire to your Pi&rsquo;s GPIO pin.
You can solder the corners, use the corner clips I linked above or carefully bend the LED strips.</li><li>If you want to inject power, solder an additional power wire at the end of the strip on the + and GND terminals.<br>This is only really necessary if you notice a drop in brightness near the end of the strip.</li></ol><p>Note: I used some <a href=https://s.click.aliexpress.com/e/_AdcCIf title="Double-sided foam tape" target=_blank rel=noopener>double-sided foam tape</a> to secure the LED strip to the back of the TV, as well as the hardware we&rsquo;ll be adding later.<br>This holds quite a bit better than the adhesive the LED-strips come with.</p><h2 id=providing-power>Providing power <a href=#providing-power>¶</a></h2><p>As mentioned above, we&rsquo;ll be using a sacrificial micro-USB power cable to power the Raspberry Pi.<br>This is because the circuit behind the micro-USB port provides overpower protection to the RPi (some RPi models include a fuse).<br>You can power the RPi using the GPIO pins, but these won&rsquo;t protect the RPi in case of a voltage or current spike.</p><ol><li>Powering the power supply<ul><li>Connect the extension cord to the correct terminals on the input side of the power supply.<br>Use ring/spade connectors to provide a secure connection.</li><li>Plug the extension cord in the wall socket.<br>Make sure you don&rsquo;t touch any exposed terminals while the power supply is powered!</li></ul></li><li>Finetune the output<br>The RPi expects a power input of around 5.1V.
The LED strips will work with this as well.<ul><li>Hook your multimeter onto the output of the PSU and set it to DC Voltage mode.</li><li>Use the knob at the right of the terminals to tune the PSU to deliver 5.100-5.150V (a tiny margin for voltage drop).</li></ul></li><li>Unpower the power supply again.</li><li>Hook the output of the power supply (the 5V side) up to some Wago style wire connectors.<ul><li>Use a red wire for positive (+V) and a black for negative (-V/GND).<br>Ring or fork connectors are advised for a secure connection with the PSU.<br>Finish stranded wires with ferrules at the other end to provide a secure connection with the Wagos.</li><li>Note that this wire will carry the load of the LEDs and RPi, so this needs to be the thickest of the bunch.</li></ul></li><li>Provide power to the Rapsberry Pi<ul><li>Cut the sacrificial micro-USB power cable and expose the 2 power leads (usually black and red).</li><li>Put the red wire in the wire connector with the positive wires and the black with the gnd/negative.</li><li>If the wire is too short, solder some extra piece of wire to them. Perhaps using the &lsquo;solderless&rsquo; heat shrink tubes linked above.</li><li>Plug the micro-USB connector into the Raspberry Pi.</li></ul></li><li>Powering the LED strip<ul><li>At the beginning of the LED strip, there&rsquo;s an additional pair with a red (positive) and white (negative/ground) wire.
These can be used to power the strip.
Solder an extra length of red/black wire to this pair to extend the wire to get to the power supply.<br>However, I prefer to solder some thicker wire directly to the copper pads.</li><li>If power injection is needed, you can also solder an extra red/black wire onto the copper pads at the end of the strip.</li></ul></li><li>If you now provide power to the Power Supply Unit (PSU) again, the RPi should power on.
The LED strip will most likely not turn on, as no signal is received on the data line yet.</li></ol><figure class=center><img src=ambilight_installed.png alt="Picture of back of TV with everything installed"><figcaption class=center>Everything installed on back of the TV</figcaption></figure><p>Everything can be installed on a small board and attached to the VESA mounts on the back of the television.
This keeps everything nice and tidy.</p><h2 id=installing-hyperion>Installing Hyperion <a href=#installing-hyperion>¶</a></h2><p>Installating Hyperion is extremely easy.
You just need to follow the short <a href=https://docs.hyperion-project.org/en/user/Installation.html title="Hyperion - Install Hyperion" target=_blank rel=noopener>guide</a> on the Hyperion website.<br>I went with the HyperBian image as it comes with Hyperion pre-installed.</p><ol><li>Download and extract the latest HyperBian image</li><li>Write the HyperBian image to your micro-SD card using Raspberry Pi Imager, balenaEtcher, Win32DiskImager, &mldr;</li><li>Setup WiFi and/or SSH, if needed/wanted
You&rsquo;ll need to add a <code>wpa_supplicant.conf</code> and <code>ssh</code> file to the boot partition of your SD-card before the first boot.
We discus this in a <a href=https://sequr.be/blog/2021/08/reading-ginlong-solis-inverter-over-serial-and-importing-in-home-assistant-over-mqtt/#wifi-and-ssh title="Reading Ginlong Solis inverter over serial and importing in Home Assistant over MQTT" target=_blank rel=noopener>different post</a>.</li><li>Put the micro-SD card in the Raspberry Pi and provide it with power to boot it up.</li></ol><p>Once the RPi has booted and Hyperion has started, you can open the web interface at
<code>http://&lt;ip of RPi>:8090</code> to configure Hyperion.</p><figure class=center><img src=hyperion_logo_light.png alt="Logo of Hyperion"><figcaption class=center>Hyperion</figcaption></figure><p>Tape the RPi to the back of the television to hide it.</p><h2 id=hooking-the-rpi-up-to-the-led-strip>Hooking the RPi up to the LED strip <a href=#hooking-the-rpi-up-to-the-led-strip>¶</a></h2><p>Use a Dupont wire or some soldering skills to connect the green data wire of the LED strip to GPIO18 (pin 12) on the Raspberry Pi.<br>The Dupont wire&rsquo;s male end can be pushed into the middle port of the LED strip&rsquo;s JST connector.</p><p>GPIO18 is the 6th pin from the left on the top/outside row.</p><figure class=center><img src=rpi-pinout.png alt="Image of pinout on a Raspberry Pi"><figcaption class=center><a href=https://www.raspberrypi-spy.co.uk/2012/06/simple-guide-to-the-rpi-gpio-header-and-pins/ target=_blank rel=noopener>https://www.raspberrypi-spy.co.uk/2012/06/simple-guide-to-the-rpi-gpio-header-and-pins/</a></figcaption></figure><h2 id=capturing-video>Capturing video <a href=#capturing-video>¶</a></h2><p>The current setup is still quite boring as we can&rsquo;t match the colours of the LED strip to the image on our screen.<br>So lets add the capture card.</p><p>Note: If you have multiple HDMI sources for your television, first hook them all up to the HDMI switch linked above.<br>You can also tape this switch to the back of the television.</p><ol><li>Tape the capture card to the back of the television.</li><li>Connect the HDMI cable currently running to the HDMI Input of your television to the Input side of the capture card.</li><li>Get an additional HDMI cable and connect the Output side of the capture card to the HDMI Input of your television.</li><li>Connect the USB cables (one for power and one with the capture feed) of the capture card with the Paspberry Pi.</li></ol><h2 id=configuring-hyperion>Configuring Hyperion <a href=#configuring-hyperion>¶</a></h2><p>With the capture card connected to the Raspberry Pi, we can now setup Hyperion to match the LED string output with the captured video.</p><ul><li>Open the Hyperion Web UI at <code>http://&lt;IP.of.the.RPi>:8090</code></li><li>In the sidebar menu, open the <strong>Configuration</strong> section</li></ul><figure class=center><img src=ambilight_hyperionmenu.png alt="Hyperion sidebar menu"><figcaption class=center>Hyperion sidebar menu</figcaption></figure><h3 id=general>General <a href=#general>¶</a></h3><ul><li>Under <strong>LED Hardware Instance Management</strong> give your ambilight instance a name.<br>I went for the plain-and-simple <em>Ambilight</em></li></ul><h3 id=led-hardware>LED Hardware <a href=#led-hardware>¶</a></h3><ul><li><strong>LED Controller</strong><br>Select the correct <strong>Controller Type</strong>, <strong>RGB byte order</strong> and <strong>Maximum LED count</strong>.<br>The LED-strips I&rsquo;m using are of the <em>ws281x</em> type, with a <em>GRB</em> byte order and I have 180 LEDs in total.<br>If you&rsquo;re using a Raspberry Pi 3, set <strong>DMA channel</strong> to 10. <a href=https://github.com/jgarff/rpi_ws281x#important-warning-about-dma-channels title="rpi_ws281x - Important warning about DMA channels" target=_blank rel=noopener>more info</a>
The other settings shouldn&rsquo;t need to be changed.</li><li><strong>LED layout</strong><br>Enter the amount of LEDs you&rsquo;ve mounted to the top, bottom, left and right of your TV in the <strong>Classic Layout (LED Frame)</strong> section.<br>The view on this layout is ALWAYS of the FRONT of your TV.<br>At the bottom, in the <strong>LED Layout Preview</strong> you&rsquo;ll see how Hyperion will address your LED strip.<br>Change <strong>Input position</strong> and <strong>Reverse direction</strong> so the layout preview matches your actual configuration.</li></ul><p><strong>Update 2.0.0-alpha.10</strong><br>The names of these menus have changes to <em>LED Instances</em> and <em>LED Output</em>.<br>Before you can enable a <em>Source</em> for your instance, you need to enable it under <em>Capturing Hardware</em> first.</p><h3 id=capturing-hardware>Capturing hardware <a href=#capturing-hardware>¶</a></h3><p>Here you can configure whether you want to capture the video output of the RPi itself and/or what&rsquo;s being captured via USB.
A lower Priority means this video input is preferred over the other.</p><ul><li>Unless you want to capture the display of the RPi itself, I suggest unchecking <em>Enable platform capture</em>.</li><li>Check the box next to <em>Enable USB Capture</em> and set a number as <em>Priority Channel</em> that&rsquo;s lower than that of Platform Capture (i.e. higher priorty).</li><li>Under <em>USB Capture</em> you shouldn&rsquo;t need to change anything.</li><li>If you want, you can enable <em>CEC detection</em> and/or <em>Signal detection</em>.<br>More info on those settings can be found at the bottom of the settings page.</li></ul><p><strong>Update 2.0.0-alpha.10</strong><br>Capture hardware is now off by default, you need to manually enable them.</p><h3 id=effects>Effects <a href=#effects>¶</a></h3><ul><li>Enable <em>Boot Effect/Color</em> if you want to have a nice effect when the RPi is booting.</li><li>I set <em>Background Effect/Color</em> to a solid black, so that the ambilight is turned off when Hyperion is &ldquo;idle&rdquo;.
You could pick a different effect (e.g., Cinema dim lights, Cinema brighten lights, Candle, &mldr;) if you want some ambient lighting of your TV while nothing&rsquo;s playing.</li></ul><p><strong>Update 2.0.0-alpha.10</strong><br>This section move to <em>LED Instances</em></p><h3 id=image-processing>Image Processing <a href=#image-processing>¶</a></h3><p>You shouldn&rsquo;t need to change anything here</p><p><strong>Update 2.0.0-alpha.10</strong><br>This section move to <em>LED Instances</em></p><h3 id=network-services>Network Services <a href=#network-services>¶</a></h3><p>Make sure the JSON Server is active if you want to control Hyperion from Home Assistant.</p><h2 id=testing-the-setup>Testing the setup <a href=#testing-the-setup>¶</a></h2><p>With everything connected and powered up, you can use the <strong>Effects Configurator</strong> to test certain effects.</p><p>Choose a <em>Template</em>, enter a random <em>Effect Name</em> and press <em>Start test</em>.</p><p>For example, running <em>Led Test</em> should give you alternating Red, Green, Blue, White and Black (off).<br>Increase to sleep time to something like 0.5s to see the colour sequence more clearly.<br>If the sequence doesn&rsquo;t match, you may need to change your RGB byte order.<br>Note that there&rsquo;s a <em>RGB Byte Order Wizard</em> available if you press the wand symbol at the top right.</p><h2 id=note-on-using-ws281x-leds>Note on using WS281x LEDs <a href=#note-on-using-ws281x-leds>¶</a></h2><p>Hyperion uses the Raspberry Pi&rsquo;s hardware PWM (Pulse-width modulation) controller.
To interact with this controller, the software needs to run with <em>root</em> (admin) permissions.
Without it, your WS281x LED strip will not work!</p><p>You&rsquo;ll need to disable the Hyperion service running under the default &lsquo;pi&rsquo; user and relaunch it as &lsquo;root&rsquo;.</p><p>SSH into your Raspberry Pi and run the following commands:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ssh pi@&lt;ip.of.raspberry.pi&gt; # password: raspberry</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Run Hyperion service as root</span>
</span></span><span style=display:flex><span>sudo systemctl disable --now hyperion@pi.service
</span></span><span style=display:flex><span>sudo systemctl enable --now hyperion@root.service
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Update Message of the Day to check correct service</span>
</span></span><span style=display:flex><span>sudo sed -i <span style=color:#e6db74>&#39;s/pi.service/root.service/&#39;</span> /etc/update-motd.d/10-hyperbian
</span></span></code></pre></div><p><strong>Note on security</strong><br>Running 3rd party software as root is against security good practices!<br>Do NOT run untrusted software with root/admin privileges!</p><h2 id=pitfalls--lessons-learned>Pitfalls / Lessons learned <a href=#pitfalls--lessons-learned>¶</a></h2><p>During this project I discovered I ordered some stuff that I didn&rsquo;t necessarily need for this project.
And looking back, there&rsquo;s some stuff I would have done differently.</p><p>Let&rsquo;s say I made these mistakes so you don&rsquo;t have to &mldr; :)</p><ul><li><strong>Corner connectors</strong><br>These corners, including the connectors for the strip and the corner pieces, are quite big.<br>You lose valuable LED space in the corners if you use them.<br>In the end I used one of the corner pieces but without the connector. I soldered it instead. Which was fine.<br>But in the future I&rsquo;d just go with soldered connections, reinforced with some heat shrink tubing for piece of mind.</li><li><strong>JST connectors</strong><br>Unless you&rsquo;re building a huge LED strip and you&rsquo;re pinned on using the tiny wires for power injection, there&rsquo;s no need in getting JST connectors.<br>I actually cut the wires from the spare connector that came with the strip to make the corner connections.<br>I added power injection at the end of the strip, using some 18AWG wire soldered onto the pads (and reinforced with some heat shrink).</li><li><strong>Double sided tape</strong><br>I strongly advise using double sided tape, maybe even foam tape over regular tape.<br>The adhesive of the LED strip is good in general.
But since I had to reposition the strip a few times, it didn&rsquo;t stick as well anymore.<br>The double sided sticky foam I&rsquo;m using, is incredibly strong. Maybe a bit too much even, it&rsquo;ll be a pain to take off again.<br>Added advantage of using the foam is that it adds a barrier between the strip and the TV for when you&rsquo;re soldering connections with the LED strip already taped.</li><li><strong>Ferrules and Wagos</strong><br>I&rsquo;m using no-brand Wago-style connectors (lever clamps) for this project.
They&rsquo;re rated for mains voltage and I&rsquo;m only running 5V through them, so I feel comfortable using them.<br>Since I&rsquo;m also using stranded wire, I&rsquo;m using ferrules to provide a proper connection within the Wago connectors.<br>Note that while the connectors may support up to 14 AWG / 2.5mm² wires, a 14 AWG ferrule (with some heat shrink around it) will barely, or most likely not, fit.
So make sure you use up to 16 AWG ferrules.</li></ul><table><thead><tr><th style=text-align:center></th><th style=text-align:center></th></tr></thead><tbody><tr><td style=text-align:center><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/P0QzSDGwfJw style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="Testing Hyperion set-up with Knight Rider effect"></iframe></div></td><td style=text-align:center><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/Z5K5a1_KBCQ style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="Testing Hyperion set-up with Police effect"></iframe></div></td></tr></tbody></table></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://sequr.be/tags/home-automation/>Home Automation</a></span>
<span class=tag><a href=https://sequr.be/tags/hyperion/>Hyperion</a></span>
<span class=tag><a href=https://sequr.be/tags/ambilight/>Ambilight</a></span>
<span class=tag><a href=https://sequr.be/tags/raspberry-pi/>Raspberry Pi</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://sequr.be/categories/home-automation/>Home Automation</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>2743 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-04-18
(Last updated: 2023-03-30)</p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href=https://ko-fi.com/s4squatch target=_blank rel=noopener aria-label title="Buy me a coffee"><div class="resp-sharing-button resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsequr.be%2fblog%2f2021%2f04%2fdiy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fsequr.be%2fblog%2f2021%2f04%2fdiy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fsequr.be%2fblog%2f2021%2f04%2fdiy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion%2f&amp;resubmit=true&amp;title=DIY%20Ambilight%20for%20your%20TV%20or%20computer%20using%20a%20RPi%20and%20Hyperion" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=DIY%20Ambilight%20for%20your%20TV%20or%20computer%20using%20a%20RPi%20and%20Hyperion%20https%3a%2f%2fsequr.be%2fblog%2f2021%2f04%2fdiy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion%2f" target=_blank rel=noopener aria-label title="Share on whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893a11.821 11.821.0 00-3.48-8.413z"/></svg></div></div></a></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://sequr.be/blog/2021/05/automating-my-lights-at-the-toilet-room/><span class=button__icon>←</span>
<span class=button__text>Automating my lights at the toilet room</span>
</a></span><span class="button next"><a href=https://sequr.be/blog/2021/03/esp32-cam-and-esphome/><span class=button__text>ESP32-cam and ESPHome</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2019</span>
<span><a href=https://sequr.be>DezeStijn</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></span>
<span><a href=https://sequr.be/blog/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span><span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span><span>Deployed using <a href=https://github.com/TheGroundZero/TheGroundZero.github.io title=TheGroundZero/TheGroundZero.github.io>GitHub Pages</a></span></div></div></footer></div><script type=text/javascript src=https://sequr.be/bundle.min.e5851f10967f384490b9d8ab955d22269186cdf17b83426f1dfc33129b514f4d5226f07008d24a0fe9c895e4589e0c53a67a0fa211d495d0ec6af0fe1e2f1878.js integrity="sha512-5YUfEJZ/OESQudirlV0iJpGGzfF7g0JvHfwzEptRT01SJvBwCNJKD+nIleRYngxTpnoPohHUldDsavD+Hi8YeA=="></script></body></html>