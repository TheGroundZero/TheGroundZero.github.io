<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="DezeStijn"><meta name=description content="Getting a better night&rsquo;s sleep thanks to circadian lighting with IKEA TRÅDFRI bulbs and Home Assistant (and Shelly)."><meta name=keywords content="Sequr,blog,writeup,CTF,challenge,machine,infosec,IT security,hacking,pentesting,cybersecurity,Home Automation,Home Assistant,circadian lighting,IKEA TRADFRI,Shelly,Zigbee"><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://sequr.be/blog/2021/01/circadian-lighting-with-ikea-tradfri-lightbulbs-and-home-assistant/><title>Circadian lighting with IKEA TRADFRI lightbulbs and Home Assistant :: Sequr
</title><link rel=stylesheet href=https://sequr.be/main.min.244183cde1a38e0b08f82c11791181288f9aac1cc9618cd6f4e9e7710c5768ba.css integrity="sha256-JEGDzeGjjgsI+CwReRGBKI+arBzJYYzW9OnncQxXaLo=" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://sequr.be/css/table.css><link rel=stylesheet type=text/css href=https://sequr.be/css/menu.css><link rel=stylesheet type=text/css href=https://sequr.be/css/background.css><link rel=apple-touch-icon sizes=180x180 href=https://sequr.be/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://sequr.be/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://sequr.be/favicon-16x16.png><link rel=manifest href=https://sequr.be/site.webmanifest><link rel=mask-icon href=https://sequr.be/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://sequr.be/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Circadian lighting with IKEA TRADFRI lightbulbs and Home Assistant"><meta itemprop=description content="Getting a better night’s sleep thanks to circadian lighting with IKEA TRÅDFRI bulbs and Home Assistant (and Shelly)."><meta itemprop=datePublished content="2021-01-18T17:30:00+01:00"><meta itemprop=dateModified content="2021-01-18T19:45:00+01:00"><meta itemprop=wordCount content="1628"><meta itemprop=image content="https://sequr.be/blog/2021/01/circadian-lighting-with-ikea-tradfri-lightbulbs-and-home-assistant/cover1.jpg"><meta itemprop=keywords content="Home Automation,Home Assistant,Circadian Lighting,IKEA TRADFRI,Shelly,Zigbee"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2021/01/circadian-lighting-with-ikea-tradfri-lightbulbs-and-home-assistant/cover1.jpg"><meta name=twitter:title content="Circadian lighting with IKEA TRADFRI lightbulbs and Home Assistant"><meta name=twitter:description content="Getting a better night’s sleep thanks to circadian lighting with IKEA TRÅDFRI bulbs and Home Assistant (and Shelly)."><meta property="article:section" content="Home Automation"><meta property="article:published_time" content="2021-01-18 17:30:00 +0100 CET"><link rel=webmention href=https://webmention.io/sequr.be/webmention></head><body><div class=container><header class=header><span class=header__inner><a href=https://sequr.be/ style=text-decoration:none><div class=logo><span class=logo__mark>$</span>
<span class=logo__text>lynx sequr.be</span>
<span class=logo__cursor style=background-color:#e68101></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://sequr.be/about/>About</a></li><li><a href=https://sequr.be/blog/>Blog</a></li><li><a href=https://sequr.be/privacy/>Privacy</a></li><li><a href=https://sequr.be/shoppinglist/>Shopping</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class="post h-entry"><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
8 minutes</p></div><article><h1 class="post-title p-name"><a href=https://sequr.be/blog/2021/01/circadian-lighting-with-ikea-tradfri-lightbulbs-and-home-assistant/ class=u-url>Circadian lighting with IKEA TRADFRI lightbulbs and Home Assistant</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#adding-ikea-trådfri-lights-to-home-assistant>Adding IKEA TRÅDFRI lights to Home Assistant</a><ul><li><a href=#installing-zha>Installing ZHA</a></li><li><a href=#adding-the-bulbs-in-zha>Adding the bulbs in ZHA</a></li></ul></li><li><a href=#circadian-lighting-in-home-assistant>Circadian Lighting in Home Assistant</a><ul><li><a href=#installation-via-hacs>Installation via HACS</a></li><li><a href=#activating-the-component>Activating the component</a></li><li><a href=#adding-circadian-lights>Adding circadian lights</a></li></ul></li><li><a href=#extra-pairing-5-button-trådfri-remote-to-home-assistant>Extra: Pairing 5-button TRÅDFRI remote to Home Assistant</a></li><li><a href=#extra-adding-physical-light-switches-via-shelly>Extra: Adding physical light switches via Shelly</a></li></ul></nav></aside><hr><div class="post-content e-content"><blockquote><p>Circadian lighting is the concept that electric light can be used to support human health by minimizing the effect of electric light on the human circadian rhythm.<br>source: thelightingpractice.com/what-is-circadian-lighting/</p></blockquote><p>The human body follows a circadian rhythm.
A 24-hour cycle that&rsquo;s part of our body&rsquo;s internal clock, which on its turn regulates lots of processes in our body.
One of the most important circadian rhythms is the sleep-wake cycle.</p><p>Our (overly) well-lit offices and houses can cause a desynchronisation of our body with its internal clock, which is tuned to the rising and setting of the sun.
By changing the colour temperature and brightness of the lightbulbs to match the light we&rsquo;d get from the sun, we re-sync our bodies.
This results in more focus during the day and better sleep at night.</p><figure class=center><img src=circadian-lighting_small.jpg alt="Circadian Rythm"><figcaption class=center>Circadian Rythm</figcaption></figure><h2 id=adding-ikea-trådfri-lights-to-home-assistant>Adding IKEA TRÅDFRI lights to Home Assistant <a href=#adding-ikea-tr%c3%a5dfri-lights-to-home-assistant>¶</a></h2><p>The IKEA TRÅDFRI communicate over Zigbee.
So you&rsquo;ll need to have a zigbee controller connected with Home Assistant.</p><p>In <a href=https://sequr.be/blog/2020/11/home-automation-adding-xiaomi-aqara-door-and-window-sensor-to-ha-via-deconz-conbee-ii/ title="Home Automation :: Adding Xiaomi Aqara Door and Window Sensor to HA via deCONZ (ConBee II)">a previous post</a> I added some Aqara sensors using a ConBee II Zigbee controller and the DeCONZ add-on.<br>Nowadays I&rsquo;m using the Zigbee Home Automation (ZHA) integration in Home Assistant to manage Zigbee devices.<br>However, the idea stays the same: use the integration/add-on to link Zigbee devices to our attached Zigbee controller.</p><h3 id=installing-zha>Installing ZHA <a href=#installing-zha>¶</a></h3><p>This post isn&rsquo;t about installing ZHA, so I&rsquo;ll keep it short here.</p><ol><li>Attach your Zigbee controller (e.g. Dresden Elektronik ConBee II) to your Home Assistant system.</li><li>Install the ZHA integration.</li><li>Select the ConBee II device when asked</li></ol><h3 id=adding-the-bulbs-in-zha>Adding the bulbs in ZHA <a href=#adding-the-bulbs-in-zha>¶</a></h3><p>Make sure you do this setup with one bulb at a time.</p><ol><li>Install the lightbulb in its fitting and make sure it&rsquo;s powered.</li><li>Open the ZHA Integration page by clicking &ldquo;Configure&rdquo;</li><li>Click &ldquo;Add Device&rdquo; in the bottom-right</li><li>ZHA add-on is now searching for new devices. You can click &ldquo;Show logs&rdquo; at the top-right if you need to troubleshoot.</li><li>With the lightbulb turned on, toggle it off-on 6 times (ending on the &lsquo;on&rsquo; state again).</li><li>The lightbulb is now reset and in pairing mode, which you&rsquo;ll notice by the light flashing bright once and going in a <em>heartbeat</em> mode.</li><li>Wait for ZHA to discover the bulb.</li><li>Give the discovered device a name and a location.</li></ol><p>You can now toggle the lights by calling the <code>light.toggle</code> service with the <code>entity_id</code> of the bulbs you just added.</p><h2 id=circadian-lighting-in-home-assistant>Circadian Lighting in Home Assistant <a href=#circadian-lighting-in-home-assistant>¶</a></h2><p>As someone has already gone through the trouble of writing a <a href=https://github.com/claytonjn/hass-circadian_lighting title="hass-circadian_lighting on Github" target=_blank rel=noopener>circadian lighting</a> script, it&rsquo;s a piece of cake to <em>install</em> circadian lighting in Home Assistant.</p><h3 id=installation-via-hacs>Installation via HACS <a href=#installation-via-hacs>¶</a></h3><p>If you haven&rsquo;t already, you&rsquo;ll want to installs <a href=https://hacs.xyz/ title="HACS - Home Assistant Community Store" target=_blank rel=noopener>HACS</a>.<br>While you could install the script yourself, HACS will give you easier update functionality and access to much more custom extensions to Home Assistant.</p><ol><li>Open HACS via the sidebar and go to the Integrations section.</li><li>Click the big &ldquo;Explore & add repositories&rdquo; button at the bottom-right.</li><li>Search for and install the &ldquo;Circadian Lighting&rdquo; repository.</li><li>Check your configuration and reboot Home Assistant</li></ol><h3 id=activating-the-component>Activating the component <a href=#activating-the-component>¶</a></h3><ol><li>Open <code>configuration.yaml</code> in an editor (e.g. using the Visual Studio Code add-on) and add the following line:
<code>circadian_lighting:</code></li><li>Check your configuration and reboot Home Assistant</li></ol><h3 id=adding-circadian-lights>Adding circadian lights <a href=#adding-circadian-lights>¶</a></h3><p>Under the <code>switch</code> section of your configuration, add the lights you want to add circadian lighting to.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>switch</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>circadian_lighting</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>IKEA circadian lighting</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lights_ct</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>light.tradfri_bulb</span>
</span></span></code></pre></div><p>Make sure to check the <a href=https://github.com/claytonjn/hass-circadian_lighting title="hass-circadian_lighting on Github" target=_blank rel=noopener>documentation</a> and set the correct attributes here.<br>For example, you&rsquo;ll need to check whether your lights&rsquo; colour is controlled in CT, RGB or XY mode, or if you only want to/can change the brightness.</p><ul><li>lights_ct (Optional): array: List of light entities which should be set in mireds.</li><li>lights_rgb (Optional): array: List of light entities which should be set in RGB.</li><li>lights_xy (Optional): array: List of light entities which should be set in XY.</li><li>lights_brightness (Optional): array: List of light entities which should only have brightness adjusted.</li></ul><p>Check the attributes of your lights in the Developer Tools.
This will give you some useful input.<br>Below are the attributes of my IKEA TRÅDFRI LED bulbs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>min_mireds</span>: <span style=color:#ae81ff>250</span>
</span></span><span style=display:flex><span><span style=color:#f92672>max_mireds</span>: <span style=color:#ae81ff>454</span>
</span></span><span style=display:flex><span><span style=color:#f92672>off_brightness</span>: <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span><span style=color:#f92672>friendly_name</span>: <span style=color:#e6db74>&#39;TRADFRI LED bulb E27 1000 lumen&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>supported_features</span>: <span style=color:#ae81ff>43</span>
</span></span></code></pre></div><p>After a reboot of Home Assistant, the Circadian Lighting integration will monitor the lights you configured.<br>Once those lights are turned on, the integration will automatically adjust their colour temperature and brightness to match the current state in the circadian cycle.</p><p>If you want to, you can make additional changes to the module and the individual light groups.<br>See the <a href=https://github.com/claytonjn/hass-circadian_lighting/wiki/Advanced-Configuration title="Advanced Configuration - hass-circadian_lighting" target=_blank rel=noopener>Advanced Configuration</a> Wiki page for more info.</p><h2 id=extra-pairing-5-button-trådfri-remote-to-home-assistant>Extra: Pairing 5-button TRÅDFRI remote to Home Assistant <a href=#extra-pairing-5-button-tr%c3%a5dfri-remote-to-home-assistant>¶</a></h2><p>Since Zigbee devices can only be controlled by 1 controller at a time, you&rsquo;ll need to connect the 5-button remote to ZHA if you want to use it in parallel with HA to control the TRÅDFRI bulbs.</p><p>To pair the remote with ZHA, you follow the same steps as when you connected the lightbulbs.</p><ol><li>Put the battery in the back of the remote.</li><li>Open the ZHA Integration page by clicking &ldquo;Configure&rdquo;</li><li>Click &ldquo;Add Device&rdquo; in the bottom-right</li><li>ZHA add-on is now searching for new devices. You can click &ldquo;Show logs&rdquo; at the top-right if you need to troubleshoot.</li><li>Press the small button at the back of the remote 4 times within 5 seconds.</li><li>A tiny red LED will flash shortly at the front of the remote to indicate it&rsquo;s in pairing mode.</li><li>Wait for ZHA to discover the remote.</li><li>Give the discovered device a name and a location.</li></ol><p>To perform actions with the remote, you can make use of the <a href=https://community.home-assistant.io/t/zha-ikea-five-button-remote-for-lights/253804 title="ZHA - IKEA five button remote for lights" target=_blank rel=noopener>blueprint</a> provided by Frenck.</p><ol><li>In Home Assistant, go to Configuration > Blueprints.</li><li>Click the &ldquo;Import Blueprint&rdquo; button.</li><li>Copy and paste the following URL: <code>https://community.home-assistant.io/t/zha-ikea-five-button-remote-for-lights/253804</code> and click &ldquo;Preview blueprint&rdquo;</li><li>You don&rsquo;t have to change anyting in the next screen, so click &ldquo;Import Blueprint&rdquo;.</li><li>With the blueprint imported, click &ldquo;Create Automation&rdquo;.</li><li>Now configure the automation by adding your remote and light bulbs and optionally adding actions to the left/right buttons.<ol><li>Give the automation a name and description of your choosing.</li><li>Select your TRÅDFRI remote in the &ldquo;Remote&rdquo; section.</li><li>Select the lightbulbs you want to control with the remote in the &ldquo;Light(s)&rdquo; section.</li><li>Optionally turn on the &ldquo;Force turn on brightness&rdquo; to set a default brightness when turning on the lights.<br>Without this option checked, the lightbulbs will turn on at the brightness they had when they were turned off.</li><li>You can also add actions to the short/long press of the left/right button.<br>Note that these buttons won&rsquo;t control the colour temperature of the bulbs anymore.
You could write a script that mimicks this behaviour and call that from the automation.</li></ol></li><li>Save the automation</li><li>Check your config and reboot Home Assistant</li></ol><p>Pressing the power button on the remote will now toggle your lights and the up/down buttons can be used to dim them.</p><h2 id=extra-adding-physical-light-switches-via-shelly>Extra: Adding physical light switches via Shelly <a href=#extra-adding-physical-light-switches-via-shelly>¶</a></h2><p>Before installing the IKEA TRÅDFRI lightbulbs, I had regular lightbulbs which I could turn on/off using physical switches.<br>I had already installed Shelly relays (integrated into Home Assistant) behind them to also add the ability to toggle my lights via Home Assistant.</p><p>We can now repurpose these Shelly&rsquo;s to also control the TRÅDFRI bulbs.</p><p>You have 2 options to keep the lightbulbs continuously powered in order to be able to control them via the IKEA remote or Home Assistant:</p><ol><li>Bypass the switch (and Shelly) with your Live wire and connect it directly to the feed of the bulbs.</li><li>Keep the feed of the bulbs connected to the Shelly but make sure to configure it to keep the lightbulbs powered:<ol><li>Set the &ldquo;Power on Default Mode&rdquo; to &ldquo;On&rdquo;.</li><li>Set the &ldquo;Button Mode&rdquo; to Detached.</li><li>Optionally set an &ldquo;Auto On&rdquo; timer that turns the output on again if it was turned of for any reason.</li></ol></li></ol><p>In both cases, we attach the physical switch to the Shelly.</p><p>I already had a Shelly 2.5 in place, so I&rsquo;ll use that one.
If you don&rsquo;t have any smart controls on your switch yet, I&rsquo;d advise using a Shelly i3 to sense the switch state.<br>The Shelly 2.5 does give me the ability to monitor the power consumption of the lightbulbs.</p><ol><li>Connect the Live wire to a Wago.</li><li>From this Wago, run a live wire to the Shelly L-terminal and another to Live/Common terminal of the switch.</li><li>Connect the Neutral wire to the Shelly N-terminal (via a Wago if this wire also continues to e.g. the lightbulbs).</li><li>Connect the output of the switch to the Shelly SW-terminal.</li><li>Connect the feed for the lightbulbs to the Shelly O-terminal.</li></ol><p>In Home Assistant we now follow the state change of the switch and toggle the lights when the switch is toggled.</p><p>There are multiple methods to achieve this goal.
You can integrate the Shelly via the Shelly Integration or ShellyForHass, but I&rsquo;ll be using MQTT.
I&rsquo;m also not using Home Assistant Automations but Node-RED as all my home automation <em>scripts</em> are in there.</p><p>I have a quick-and-easy flow that listens to the MQTT topic for the switch input.<br>Since the Shelly by default repeats it&rsquo;s state every 30 seconds*, I need to make sure I only toggle the lights when the switch&rsquo;s state changes.
If it does, I call the <code>light.toggle</code> service to toggle the lightbulbs on or off.</p><figure class=center><img src=tradfri_nodered.png alt="Node-RED flow to toggle TRÅDFRI bulbs with Shelly"><figcaption class=center>Node-RED flow</figcaption></figure><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[{<span style=color:#f92672>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;50cf247.4a249dc&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;comment&#34;</span>,<span style=color:#f92672>&#34;z&#34;</span>:<span style=color:#e6db74>&#34;35de3eaf.51455a&#34;</span>,<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;TRADFRI&#34;</span>,<span style=color:#f92672>&#34;info&#34;</span>:<span style=color:#e6db74>&#34;See my blog post on sequr.be for more info&#34;</span>,<span style=color:#f92672>&#34;x&#34;</span>:<span style=color:#ae81ff>80</span>,<span style=color:#f92672>&#34;y&#34;</span>:<span style=color:#ae81ff>40</span>,<span style=color:#f92672>&#34;wires&#34;</span>:[]},{<span style=color:#f92672>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;52bb2344.cb92f4&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;api-call-service&#34;</span>,<span style=color:#f92672>&#34;z&#34;</span>:<span style=color:#e6db74>&#34;35de3eaf.51455a&#34;</span>,<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;Toggle Tradfri bulbs&#34;</span>,<span style=color:#f92672>&#34;server&#34;</span>:<span style=color:#e6db74>&#34;2ce15169.23b9de&#34;</span>,<span style=color:#f92672>&#34;version&#34;</span>:<span style=color:#ae81ff>1</span>,<span style=color:#f92672>&#34;debugenabled&#34;</span>:<span style=color:#66d9ef>false</span>,<span style=color:#f92672>&#34;service_domain&#34;</span>:<span style=color:#e6db74>&#34;light&#34;</span>,<span style=color:#f92672>&#34;service&#34;</span>:<span style=color:#e6db74>&#34;toggle&#34;</span>,<span style=color:#f92672>&#34;entityId&#34;</span>:<span style=color:#e6db74>&#34;light.tradfri_bulb&#34;</span>,<span style=color:#f92672>&#34;data&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;dataType&#34;</span>:<span style=color:#e6db74>&#34;json&#34;</span>,<span style=color:#f92672>&#34;mergecontext&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;output_location&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;output_location_type&#34;</span>:<span style=color:#e6db74>&#34;none&#34;</span>,<span style=color:#f92672>&#34;mustacheAltTags&#34;</span>:<span style=color:#66d9ef>false</span>,<span style=color:#f92672>&#34;x&#34;</span>:<span style=color:#ae81ff>660</span>,<span style=color:#f92672>&#34;y&#34;</span>:<span style=color:#ae81ff>100</span>,<span style=color:#f92672>&#34;wires&#34;</span>:[[]]},{<span style=color:#f92672>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;2114dd82.4a51c2&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;mqtt in&#34;</span>,<span style=color:#f92672>&#34;z&#34;</span>:<span style=color:#e6db74>&#34;35de3eaf.51455a&#34;</span>,<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;topic&#34;</span>:<span style=color:#e6db74>&#34;shellies/shellyswitch25-xxxx/input/0&#34;</span>,<span style=color:#f92672>&#34;qos&#34;</span>:<span style=color:#e6db74>&#34;0&#34;</span>,<span style=color:#f92672>&#34;datatype&#34;</span>:<span style=color:#e6db74>&#34;auto&#34;</span>,<span style=color:#f92672>&#34;broker&#34;</span>:<span style=color:#e6db74>&#34;6d8018f0.c514b&#34;</span>,<span style=color:#f92672>&#34;x&#34;</span>:<span style=color:#ae81ff>160</span>,<span style=color:#f92672>&#34;y&#34;</span>:<span style=color:#ae81ff>160</span>,<span style=color:#f92672>&#34;wires&#34;</span>:[[<span style=color:#e6db74>&#34;ddb41302.2e3a&#34;</span>]]},{<span style=color:#f92672>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;ddb41302.2e3a&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;rbe&#34;</span>,<span style=color:#f92672>&#34;z&#34;</span>:<span style=color:#e6db74>&#34;35de3eaf.51455a&#34;</span>,<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;Ignore repeats&#34;</span>,<span style=color:#f92672>&#34;func&#34;</span>:<span style=color:#e6db74>&#34;rbei&#34;</span>,<span style=color:#f92672>&#34;gap&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;start&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;inout&#34;</span>:<span style=color:#e6db74>&#34;out&#34;</span>,<span style=color:#f92672>&#34;property&#34;</span>:<span style=color:#e6db74>&#34;payload&#34;</span>,<span style=color:#f92672>&#34;x&#34;</span>:<span style=color:#ae81ff>420</span>,<span style=color:#f92672>&#34;y&#34;</span>:<span style=color:#ae81ff>160</span>,<span style=color:#f92672>&#34;wires&#34;</span>:[[<span style=color:#e6db74>&#34;52bb2344.cb92f4&#34;</span>]]},{<span style=color:#f92672>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;bec3321d.688e28&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;mqtt in&#34;</span>,<span style=color:#f92672>&#34;z&#34;</span>:<span style=color:#e6db74>&#34;35de3eaf.51455a&#34;</span>,<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;topic&#34;</span>:<span style=color:#e6db74>&#34;shellies/shellyix3-xxxx/input/0&#34;</span>,<span style=color:#f92672>&#34;qos&#34;</span>:<span style=color:#e6db74>&#34;0&#34;</span>,<span style=color:#f92672>&#34;datatype&#34;</span>:<span style=color:#e6db74>&#34;auto&#34;</span>,<span style=color:#f92672>&#34;broker&#34;</span>:<span style=color:#e6db74>&#34;6d8018f0.c514b&#34;</span>,<span style=color:#f92672>&#34;x&#34;</span>:<span style=color:#ae81ff>140</span>,<span style=color:#f92672>&#34;y&#34;</span>:<span style=color:#ae81ff>100</span>,<span style=color:#f92672>&#34;wires&#34;</span>:[[<span style=color:#e6db74>&#34;48c79dde.1cc034&#34;</span>]]},{<span style=color:#f92672>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;48c79dde.1cc034&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;rbe&#34;</span>,<span style=color:#f92672>&#34;z&#34;</span>:<span style=color:#e6db74>&#34;35de3eaf.51455a&#34;</span>,<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;Ignore repeats&#34;</span>,<span style=color:#f92672>&#34;func&#34;</span>:<span style=color:#e6db74>&#34;rbei&#34;</span>,<span style=color:#f92672>&#34;gap&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;start&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;inout&#34;</span>:<span style=color:#e6db74>&#34;out&#34;</span>,<span style=color:#f92672>&#34;property&#34;</span>:<span style=color:#e6db74>&#34;payload&#34;</span>,<span style=color:#f92672>&#34;x&#34;</span>:<span style=color:#ae81ff>420</span>,<span style=color:#f92672>&#34;y&#34;</span>:<span style=color:#ae81ff>100</span>,<span style=color:#f92672>&#34;wires&#34;</span>:[[<span style=color:#e6db74>&#34;52bb2344.cb92f4&#34;</span>]]},{<span style=color:#f92672>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;e8a3452c.cb2a6&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;comment&#34;</span>,<span style=color:#f92672>&#34;z&#34;</span>:<span style=color:#e6db74>&#34;35de3eaf.51455a&#34;</span>,<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;sequr.be&#34;</span>,<span style=color:#f92672>&#34;info&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;x&#34;</span>:<span style=color:#ae81ff>700</span>,<span style=color:#f92672>&#34;y&#34;</span>:<span style=color:#ae81ff>160</span>,<span style=color:#f92672>&#34;wires&#34;</span>:[]},{<span style=color:#f92672>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;2ce15169.23b9de&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;server&#34;</span>,<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;Home Assistant&#34;</span>,<span style=color:#f92672>&#34;legacy&#34;</span>:<span style=color:#66d9ef>false</span>,<span style=color:#f92672>&#34;addon&#34;</span>:<span style=color:#66d9ef>true</span>,<span style=color:#f92672>&#34;rejectUnauthorizedCerts&#34;</span>:<span style=color:#66d9ef>true</span>,<span style=color:#f92672>&#34;ha_boolean&#34;</span>:<span style=color:#e6db74>&#34;y|yes|true|on|home|open&#34;</span>,<span style=color:#f92672>&#34;connectionDelay&#34;</span>:<span style=color:#66d9ef>true</span>,<span style=color:#f92672>&#34;cacheJson&#34;</span>:<span style=color:#66d9ef>true</span>},{<span style=color:#f92672>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;6d8018f0.c514b&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;mqtt-broker&#34;</span>,<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;Mosquitto&#34;</span>,<span style=color:#f92672>&#34;broker&#34;</span>:<span style=color:#e6db74>&#34;localhost&#34;</span>,<span style=color:#f92672>&#34;port&#34;</span>:<span style=color:#e6db74>&#34;1883&#34;</span>,<span style=color:#f92672>&#34;clientid&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;usetls&#34;</span>:<span style=color:#66d9ef>false</span>,<span style=color:#f92672>&#34;compatmode&#34;</span>:<span style=color:#66d9ef>false</span>,<span style=color:#f92672>&#34;keepalive&#34;</span>:<span style=color:#e6db74>&#34;60&#34;</span>,<span style=color:#f92672>&#34;cleansession&#34;</span>:<span style=color:#66d9ef>true</span>,<span style=color:#f92672>&#34;birthTopic&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;birthQos&#34;</span>:<span style=color:#e6db74>&#34;0&#34;</span>,<span style=color:#f92672>&#34;birthPayload&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;closeTopic&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;closeQos&#34;</span>:<span style=color:#e6db74>&#34;0&#34;</span>,<span style=color:#f92672>&#34;closePayload&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;willTopic&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#f92672>&#34;willQos&#34;</span>:<span style=color:#e6db74>&#34;0&#34;</span>,<span style=color:#f92672>&#34;willPayload&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>}]
</span></span></code></pre></div><p>* You can turn this behaviour off but I decided not to.
Having the Shelly&rsquo;s resend their state every so often helps in making sure HA is in sync with the Shelly&rsquo;s and speeds up the syncing after a reboot of HA.<br>However, if you want to disable this behaviour, you can turn this off using the <a href=https://shelly-api-docs.shelly.cloud/#availability-and-announces title="Shelly API Reference" target=_blank rel=noopener>HTTP API</a> of the Shelly&rsquo;s.
Simply make a call to <code>http://&lt;IP of the Shelly>/settings?mqtt_update_period=0</code>.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/home-automation/>Home Automation</a></span>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/home-assistant/>Home Assistant</a></span>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/circadian-lighting/>circadian lighting</a></span>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/ikea-tradfri/>IKEA TRADFRI</a></span>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/shelly/>Shelly</a></span>
<span rel=tag class="tag p-category"><a href=https://sequr.be/tags/zigbee/>Zigbee</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a class=p-category href=https://sequr.be/categories/home-automation/>Home Automation</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
1628 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
<time class=dt-published datetime=2021-01-18T17:30:00+01:00>2021-01-18
</time>(Last updated: <time class=dt-updated datetime=2021-01-18T19:45:00+01:00>2021-01-18</time>)</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
<span rel=author class="p-author h-card">DezeStijn</span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
<span rel=bookmark class=u-url><a href=https://sequr.be/3885819963>https://sequr.be/3885819963</a></span></p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href=https://ko-fi.com/s4squatch target=_blank rel=noopener aria-label title="Buy me a coffee"><div class="resp-sharing-button resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsequr.be%2fblog%2f2021%2f01%2fcircadian-lighting-with-ikea-tradfri-lightbulbs-and-home-assistant%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fsequr.be%2fblog%2f2021%2f01%2fcircadian-lighting-with-ikea-tradfri-lightbulbs-and-home-assistant%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fsequr.be%2fblog%2f2021%2f01%2fcircadian-lighting-with-ikea-tradfri-lightbulbs-and-home-assistant%2f&amp;resubmit=true&amp;title=Circadian%20lighting%20with%20IKEA%20TRADFRI%20lightbulbs%20and%20Home%20Assistant" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Circadian%20lighting%20with%20IKEA%20TRADFRI%20lightbulbs%20and%20Home%20Assistant&amp;body=https%3a%2f%2fsequr.be%2fblog%2f2021%2f01%2fcircadian-lighting-with-ikea-tradfri-lightbulbs-and-home-assistant%2f" target=_self rel=noopener aria-label title="Share via email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div></div></a></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://sequr.be/blog/2021/01/shelly-web-ui-method/><span class=button__icon>←</span>
<span class=button__text>Shelly Web UI method</span>
</a></span><span class="button next"><a href=https://sequr.be/blog/2021/01/room-temperature-monitoring-using-xiaomi-temperature-sensor-esp32-and-esphome/><span class=button__text>Room temperature monitoring using Xiaomi temperature sensor, ESP32 and ESPHome</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class="footer h-card"><div class=footer__inner><div class=footer__content><span>&copy; 2019</span>
<span><a class="p-name u-url" rel=me href=https://sequr.be/>DezeStijn</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></span>
<span><a href=https://sequr.be/blog/index.xml target=_blank title=rss><svg width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div></footer></div><script type=text/javascript src=https://sequr.be/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>