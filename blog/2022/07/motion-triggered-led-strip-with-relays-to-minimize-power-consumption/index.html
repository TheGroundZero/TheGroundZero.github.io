<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="DezeStijn"><meta name=description content="We&rsquo;re controlling 2 LED strips with ESPHome on an ESP32, triggering them via motion sensors, and using 2 relays to minimize their power draw."><meta name=keywords content="Sequr,blog,writeup,CTF,challenge,machine,infosec,IT security,hacking,pentesting,cybersecurity,Home Automation,Home Assistant,ESPHome,ESP32,relays,LED,FastLED"><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://sequr.be/blog/2022/07/motion-triggered-led-strip-with-relays-to-minimize-power-consumption/><title>Motion-triggered LED strip with relays to minimize power consumption :: Sequr</title><link rel=stylesheet href=https://sequr.be/main.min.244183cde1a38e0b08f82c11791181288f9aac1cc9618cd6f4e9e7710c5768ba.css integrity="sha256-JEGDzeGjjgsI+CwReRGBKI+arBzJYYzW9OnncQxXaLo=" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://sequr.be/css/table.css><link rel=stylesheet type=text/css href=https://sequr.be/css/menu.css><link rel=apple-touch-icon sizes=180x180 href=https://sequr.be/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://sequr.be/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://sequr.be/favicon-16x16.png><link rel=manifest href=https://sequr.be/site.webmanifest><link rel=mask-icon href=https://sequr.be/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://sequr.be/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Motion-triggered LED strip with relays to minimize power consumption"><meta itemprop=description content="We’re controlling 2 LED strips with ESPHome on an ESP32, triggering them via motion sensors, and using 2 relays to minimize their power draw."><meta itemprop=datePublished content="2022-07-14T00:00:00+00:00"><meta itemprop=dateModified content="2022-07-14T00:00:00+00:00"><meta itemprop=wordCount content="986"><meta itemprop=image content="https://sequr.be/blog/2022/07/motion-triggered-led-strip-with-relays-to-minimize-power-consumption/cover.png"><meta itemprop=keywords content="Home Automation,Home Assistant,ESPHome,ESP32,Relays,LED,FastLED"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2022/07/motion-triggered-led-strip-with-relays-to-minimize-power-consumption/cover.png"><meta name=twitter:title content="Motion-triggered LED strip with relays to minimize power consumption"><meta name=twitter:description content="We’re controlling 2 LED strips with ESPHome on an ESP32, triggering them via motion sensors, and using 2 relays to minimize their power draw."><meta property="article:section" content="Home Automation"><meta property="article:published_time" content="2022-07-14 00:00:00 +0000 UTC"># Webmentions
<link rel=webmention href=https://webmention.io/sequr.be/webmention></head><body><div class=container><header class=header><span class=header__inner><a href=https://sequr.be/ style=text-decoration:none><div class=logo><span class=logo__mark>$</span>
<span class=logo__text>lynx sequr.be</span>
<span class=logo__cursor style=background-color:#e68101></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://sequr.be/about/>About</a></li><li><a href=https://sequr.be/blog/>Blog</a></li><li><a href=https://sequr.be/privacy/>Privacy</a></li><li><a href=https://sequr.be/shoppinglist/>Shopping</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class="post h-entry"><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
5 minutes</p></div><article><h1 class="post-title p-name"><a href=https://sequr.be/blog/2022/07/motion-triggered-led-strip-with-relays-to-minimize-power-consumption/ class=u-url>Motion-triggered LED strip with relays to minimize power consumption</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#parts-needed-shopping-list>Parts needed (shopping list)</a></li><li><a href=#wiring-it-all-together>Wiring it all together</a></li><li><a href=#coding>Coding</a><ul><li><a href=#esphome>ESPHome</a></li><li><a href=#home-assistant>Home Assistant</a></li></ul></li></ul></nav></aside><hr><div class="post-content e-content"><h2 id=intro>Intro <a href=#intro>¶</a></h2><p>If you&rsquo;ve been fiddling with ESPs, you&rsquo;ve probably been playing with LED strips as well.</p><p>If so, I can heavily recommend <a href=https://github.com/Aircoookie/WLED title="WLED by Aircookie" target=_blank rel=noopener>WLED</a> combined with <a href=https://quinled.info/pre-assembled-boards/ title="Buy QuinLED boards" target=_blank rel=noopener>Quindor&rsquo;s boards</a>.<br>WLED is an awesome piece of software which allows you to control a wide variety of LED strips, including a wide range of effects.<br>The QuinLED boards have everything you need to safely install your strips, like power protection for the ESP board, fuses and practical terminals.</p><p>You may also know that digitally adressable LED strips still consume some power while they&rsquo;re turned off (their colour set to black).</p><p>And while WLED gives you to option to control an external relays to cut the power to your strips,
I decided to go the DIY route and build something myself using the <a href=https://esphome.io/ title=ESPHome target=_blank rel=noopener>ESPHome</a> software and a relays board.</p><h2 id=parts-needed-shopping-list>Parts needed (shopping list) <a href=#parts-needed-shopping-list>¶</a></h2><p>Depending on how much you adapt this design to your needs, you&rsquo;ll need to following items:</p><p>Obviously an <a href=https://www.aliexpress.com/item/32807887667.html title="ESP32 30pin" target=_blank rel=noopener>ESP32</a> board, a <a href=https://s.click.aliexpress.com/e/_A5KG9P title="5V relay with photocoupler" target=_blank rel=noopener>relays board</a> (I&rsquo;m using a 2-channel 5V board), and <a href=https://s.click.aliexpress.com/e/_Af1n01 title="WS2812B LED strip" target=_blank rel=noopener>LED strips</a>.
The <a href=https://s.click.aliexpress.com/e/_ALbejF title="AM312 PIR motion sensor" target=_blank rel=noopener>motion sensors</a> are a nice-to-have feature.<br>I&rsquo;d also advise getting some <a href=https://s.click.aliexpress.com/e/_AeCWtP title="Aluminium LED strip channel" target=_blank rel=noopener>aluminium channel</a> to mount the strips in and to help cool the LEDs.</p><p>Optionally, you can add a <a href=https://s.click.aliexpress.com/e/_9hKMCd title="Aluminum electrolytic capacitor" target=_blank rel=noopener>capacitor</a> for smoothing any power spikes, some [terminals][terminal] to make connecting wires easier,
<a href=https://s.click.aliexpress.com/e/_AWUypr title="Female header pins" target=_blank rel=noopener>header pins</a> for mounting the ESP, and a <a href=https://www.aliexpress.com/item/1005002438981213.html title="Single-sided PCB perfboard" target=_blank rel=noopener>perfboard</a> to install everything together.<br>Also useful are <a href=https://s.click.aliexpress.com/e/_APRd0D title="Self-adhesive cable ties" target=_blank rel=noopener>adhesive cable ties</a> and these <a href=https://s.click.aliexpress.com/e/_AlAYhX title="Wire connectors, Wago style" target=_blank rel=noopener>Wago knockoffs</a> for cable management, and <a href=https://s.click.aliexpress.com/e/_9jtitX title="Double-sided transparant reusable tape" target=_blank rel=noopener>double-sided tape</a> to mount everything.<br>Finally, some lengths of nicely coloured <a href=https://s.click.aliexpress.com/e/_AnUt57 title="18AWG flexible silicone wire" target=_blank rel=noopener>18 AWG wire</a> or <a href=https://www.aliexpress.com/item/32821229368.html title="18 AWG electrical wire tinned copper insulated PVC" target=_blank rel=noopener>red-black wire</a>,
and a 5V <a href=https://www.aliexpress.com/item/4000557935321.html title="5V 3A power supply" target=_blank rel=noopener>power supply</a> sized according to your LED strip installation will be quite useful as well.</p><p>To put everything together, I also designed a small 3D printable box.
The design isn&rsquo;t perfect however, I&rsquo;ve had to enlarge some holes and the margins for the posts are quite tight.<br>The print consists of 3 parts: the <a href=https://www.tinkercad.com/things/jkIJ8GsHkwZ-leds-box title="3D print box" target=_blank rel=noopener>main chassis</a>, the mount for the <a href=https://www.tinkercad.com/things/6EUeUkkMWOB-leds-relay-platform title="3D print relay platform" target=_blank rel=noopener>relay board</a>, and the mount for the <a href=https://www.tinkercad.com/things/3EkucY8PzBs-leds-7x5-platform title="3D print perfboard platform" target=_blank rel=noopener>perfboard</a> with the ESP32.<br>I also have a 3D printed <a href=https://www.tinkercad.com/things/iVqFABKP8ah-am312-housing-with-cover title="3D printed holder for AM312" target=_blank rel=noopener>housing for the motion sensor</a>.</p><h2 id=wiring-it-all-together>Wiring it all together <a href=#wiring-it-all-together>¶</a></h2><p>For the wiring we need to take into account the following:</p><ul><li>Power<ul><li>The ESP32 needs 5V power</li><li>The relays board needs 5V power</li><li>The LEDs need 5V power</li><li>The motion sensors need 3.3V power</li><li>Power for the LEDs needs to go through the relays, so we can turn them on/off</li><li>We do not want to run the 5V/GND from the LED strip through the board, otherwise we&rsquo;ll fry it</li></ul></li><li>Connections<ul><li>The relays board needs a signal for each channel you want to control</li><li>Each motion sensor gives an input to the ESP32</li><li>The LED strip has a data input</li></ul></li></ul><figure class=center><img src=wiring_diagram.png alt="Wiring diagram"><figcaption class=center>Wiring diagram</figcaption></figure><h2 id=coding>Coding <a href=#coding>¶</a></h2><h3 id=esphome>ESPHome <a href=#esphome>¶</a></h3><p>Now the last thing we need is the ESPHome code to make this all function.</p><p>Note that I&rsquo;m using 2 motion sensors and am controlling 2 LED strips (+ respective relays channels).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>substitutions</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># These substitions combined with the &#39;common&#39; dir are based on Frenck&#39;s ESPHome setup</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># https://github.com/frenck/home-assistant-config/tree/master/esphome/common</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>slug</span>: <span style=color:#ae81ff>esp32-ledstrip-relays</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ESP32 LEDstrip with relays</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span>: <span style=color:#ae81ff>LEDstrips attached to relays to reducde power consumption</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>room</span>: <span style=color:#ae81ff>Bedroom</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>packages</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;&lt;</span>: !<span style=color:#ae81ff>include_dir_named common</span> <span style=color:#75715e># Contains WiFi settings, API, OTA, restart button, time settings</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>board: !include boards/esp32_doit-dev1.yaml # Note</span>: <span style=color:#ae81ff>the definition of boards has changed</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>status_led</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>switch</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>gpio</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${name} - Onboard LED&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inverted</span>: <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>gpio</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${room} Relay 1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO21</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inverted</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restore_mode</span>: <span style=color:#ae81ff>ALWAYS_OFF</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>mbr_relay_1</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>gpio</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${room} Relay 2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO22</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inverted</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restore_mode</span>: <span style=color:#ae81ff>ALWAYS_OFF</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>mbr_relay_2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>binary_sensor</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>gpio</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO32</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${room} PIR 1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>device_class</span>: <span style=color:#ae81ff>motion</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>mbr_pir_1</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>gpio</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO25</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${room} PIR 2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>device_class</span>: <span style=color:#ae81ff>motion</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>mbr_pir_2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>light</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>fastled_clockless</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>chipset</span>: <span style=color:#ae81ff>WS2812B</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO27</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>num_leds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rgb_order</span>: <span style=color:#ae81ff>GRB</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${room} LED 1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>mbr_led_1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;&lt;</span>: !<span style=color:#ae81ff>include components/light_effects.yaml</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>fastled_clockless</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>chipset</span>: <span style=color:#ae81ff>WS2812B</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO12</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>num_leds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rgb_order</span>: <span style=color:#ae81ff>GRB</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${room} LED 2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>mbr_led_2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;&lt;</span>: !<span style=color:#ae81ff>include components/light_effects.yaml</span>
</span></span></code></pre></div><p>You&rsquo;ll notice I grouped the light effects in a single file so I don&rsquo;t have to repeat this for every LEDstrip I setup.
Here&rsquo;s the contents of that file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># ESPHome Light Effects</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://esphome.io/components/light/index.html#light-effects</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#f92672>effects</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>addressable_color_wipe</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Police Wipe</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>colors</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>red</span>: <span style=color:#ae81ff>100</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>green</span>: <span style=color:#ae81ff>0</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>blue</span>: <span style=color:#ae81ff>0</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>num_leds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>red</span>: <span style=color:#ae81ff>0</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>green</span>: <span style=color:#ae81ff>0</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>blue</span>: <span style=color:#ae81ff>100</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>num_leds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>add_led_interval</span>: <span style=color:#ae81ff>100ms</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>reverse</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>strobe</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Police Strobe</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>colors</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>state</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>brightness</span>: <span style=color:#ae81ff>100</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>red</span>: <span style=color:#ae81ff>100</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>green</span>: <span style=color:#ae81ff>0</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>blue</span>: <span style=color:#ae81ff>0</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>duration</span>: <span style=color:#ae81ff>500ms</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>state</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>duration</span>: <span style=color:#ae81ff>100ms</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>state</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>brightness</span>: <span style=color:#ae81ff>100</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>red</span>: <span style=color:#ae81ff>0</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>green</span>: <span style=color:#ae81ff>0</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>blue</span>: <span style=color:#ae81ff>100</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>duration</span>: <span style=color:#ae81ff>500ms</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>state</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>duration</span>: <span style=color:#ae81ff>100ms</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>addressable_rainbow</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>addressable_fireworks</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>addressable_random_twinkle</span>:
</span></span></code></pre></div><h3 id=home-assistant>Home Assistant <a href=#home-assistant>¶</a></h3><p>I&rsquo;ve actually <em>programmed</em> my triggers for turning the LEDs on and off in Node-RED, but this is fairly easy to do with Home Assistant Automations as well.</p><p>We want to turn on the LED when motion is detected. To do this, we also need to turn on the relays.
As long as motion is detected, the LED stays on.
If no motion is detected, we wait a bit longer and then turn off the LED strip and the relays.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>alias</span>: <span style=color:#ae81ff>Motion automated lights (LED1)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Turn on LED1 when PIR1 is trigged. Turn off when there&#39;s been no motion for 10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  seconds.</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>mode</span>: <span style=color:#ae81ff>restart</span>
</span></span><span style=display:flex><span><span style=color:#f92672>trigger</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>state</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>entity_id</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>binary_sensor.mbr_pir_1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>to</span>: <span style=color:#e6db74>&#39;on&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>condition</span>: []
</span></span><span style=display:flex><span><span style=color:#f92672>action</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>service</span>: <span style=color:#ae81ff>switch.turn_on</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>data</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>target</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>switch.mbr_relay_1</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>service</span>: <span style=color:#ae81ff>light.turn_on</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>transition</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>color_name</span>: <span style=color:#ae81ff>blue</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>brightness_pct</span>: <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>target</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>light.mbr_led_1</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>wait_for_trigger</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>state</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>entity_id</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>binary_sensor.mbr_pir_1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>to</span>: <span style=color:#e6db74>&#39;off&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>for</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>hours</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>minutes</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>seconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>service</span>: <span style=color:#ae81ff>light.turn_off</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>transition</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>target</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>light.mbr_led_1</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>delay</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>hours</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>minutes</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>seconds</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>milliseconds</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>service</span>: <span style=color:#ae81ff>switch.turn_off</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>data</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>target</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>switch.mbr_relay_1</span>
</span></span></code></pre></div><p>Copy and modify this automation for each PIR-LED-relay combination you have.
You could probably turn this into a blueprint as well.</p><p>[TODO] Add pictures of my setup. I&rsquo;ll add these one day, promise!</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://sequr.be/tags/home-automation/>Home Automation</a></span>
<span class=tag><a href=https://sequr.be/tags/home-assistant/>Home Assistant</a></span>
<span class=tag><a href=https://sequr.be/tags/esphome/>ESPHome</a></span>
<span class=tag><a href=https://sequr.be/tags/esp32/>ESP32</a></span>
<span class=tag><a href=https://sequr.be/tags/relays/>relays</a></span>
<span class=tag><a href=https://sequr.be/tags/led/>LED</a></span>
<span class=tag><a href=https://sequr.be/tags/fastled/>FastLED</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a class=p-category href=https://sequr.be/categories/home-automation/>Home Automation</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
986 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
<time class=dt-published datetime=2022-07-14T00:00:00+00:00>2022-07-14</time></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
<span rel=author class="p-author h-card">DezeStijn</span></p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href=https://ko-fi.com/s4squatch target=_blank rel=noopener aria-label title="Buy me a coffee"><div class="resp-sharing-button resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsequr.be%2fblog%2f2022%2f07%2fmotion-triggered-led-strip-with-relays-to-minimize-power-consumption%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fsequr.be%2fblog%2f2022%2f07%2fmotion-triggered-led-strip-with-relays-to-minimize-power-consumption%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fsequr.be%2fblog%2f2022%2f07%2fmotion-triggered-led-strip-with-relays-to-minimize-power-consumption%2f&amp;resubmit=true&amp;title=Motion-triggered%20LED%20strip%20with%20relays%20to%20minimize%20power%20consumption" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Motion-triggered%20LED%20strip%20with%20relays%20to%20minimize%20power%20consumption&amp;body=https%3a%2f%2fsequr.be%2fblog%2f2022%2f07%2fmotion-triggered-led-strip-with-relays-to-minimize-power-consumption%2f" target=_self rel=noopener aria-label title="Share via email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div></div></a></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://sequr.be/blog/2022/08/home-assistant-container-part-1-install-debian-docker-and-portainer/><span class=button__icon>←</span>
<span class=button__text>Home Assistant Container Part 1: Install Debian, Docker and Portainer</span>
</a></span><span class="button next"><a href=https://sequr.be/blog/2022/07/disabling-quick-glance-discover-on-oneplus/><span class=button__text>Disabling Quick Glance (Discover) on OnePlus</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2019</span>
<span><a class=h-card rel=me href=https://sequr.be/>DezeStijn</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></span>
<span><a href=https://sequr.be/blog/index.xml target=_blank title=rss><svg width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div></footer></div><script type=text/javascript src=https://sequr.be/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>