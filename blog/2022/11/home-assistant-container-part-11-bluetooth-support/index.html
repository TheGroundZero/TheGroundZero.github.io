<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="DezeStijn"><meta name=description content="In this eleventh part of the Home Assistant Container series we&rsquo;ll add Bluetooth support to our Home Assistant system"><meta name=keywords content="Sequr,blog,writeup,CTF,challenge,machine,infosec,IT security,hacking,pentesting,cybersecurity,Home Automation,Home Assistant,Container,Docker,bluetooth,dongle"><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://sequr.be/blog/2022/11/home-assistant-container-part-11-bluetooth-support/><title>Home Assistant Container Part 11: Bluetooth support :: Sequr</title><link rel=stylesheet href=https://sequr.be/main.min.244183cde1a38e0b08f82c11791181288f9aac1cc9618cd6f4e9e7710c5768ba.css integrity="sha256-JEGDzeGjjgsI+CwReRGBKI+arBzJYYzW9OnncQxXaLo=" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://sequr.be/css/table.css><link rel=stylesheet type=text/css href=https://sequr.be/css/menu.css><link rel=apple-touch-icon sizes=180x180 href=https://sequr.be/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://sequr.be/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://sequr.be/favicon-16x16.png><link rel=manifest href=https://sequr.be/site.webmanifest><link rel=mask-icon href=https://sequr.be/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://sequr.be/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Home Assistant Container Part 11: Bluetooth support"><meta itemprop=description content="In this eleventh part of the Home Assistant Container series we’ll add Bluetooth support to our Home Assistant system"><meta itemprop=datePublished content="2022-11-25T00:00:00+00:00"><meta itemprop=dateModified content="2022-11-25T00:00:00+00:00"><meta itemprop=wordCount content="508"><meta itemprop=image content="https://sequr.be/blog/2022/11/home-assistant-container-part-11-bluetooth-support/cover.png"><meta itemprop=keywords content="Home Automation,Home Assistant,Container,Docker,Bluetooth,Dongle"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2022/11/home-assistant-container-part-11-bluetooth-support/cover.png"><meta name=twitter:title content="Home Assistant Container Part 11: Bluetooth support"><meta name=twitter:description content="In this eleventh part of the Home Assistant Container series we’ll add Bluetooth support to our Home Assistant system"><meta property="article:section" content="Home Automation"><meta property="article:section" content="HA Container"><meta property="article:published_time" content="2022-11-25 00:00:00 +0000 UTC"># Webmentions
<link rel=webmention href=https://webmention.io/sequr.be/webmention></head><body><div class=container><header class=header><span class=header__inner><a href=https://sequr.be/ style=text-decoration:none><div class=logo><span class=logo__mark>$</span>
<span class=logo__text>lynx sequr.be</span>
<span class=logo__cursor style=background-color:#e68101></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://sequr.be/about/>About</a></li><li><a href=https://sequr.be/blog/>Blog</a></li><li><a href=https://sequr.be/privacy/>Privacy</a></li><li><a href=https://sequr.be/shoppinglist/>Shopping</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class="post h-entry"><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3 minutes</p></div><article><h1 class="post-title p-name"><a href=https://sequr.be/blog/2022/11/home-assistant-container-part-11-bluetooth-support/ class=u-url>Home Assistant Container Part 11: Bluetooth support</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#the-esphome-method>The ESPHome method</a></li><li><a href=#the-built-in-bluetooth-method>The built-in Bluetooth method</a></li><li><a href=#bthome>BTHome</a></li></ul></nav></aside><hr><div class="post-content e-content"><h2 id=intro>Intro <a href=#intro>¶</a></h2><p>You may have purchases some <a href=https://s.click.aliexpress.com/e/_Ac9pCh title="Xiaomi Bluetooth Temperature Humidity Sensor LYWSD03MMC" target=_blank rel=noopener>Xiaomi temperature and humidity sensors</a> after reading <a href=https://sequr.be/blog/2021/01/room-temperature-monitoring-using-xiaomi-temperature-sensor-esp32-and-esphome/ title="Room temperature monitoring using Xiaomi temperature sensor, ESP32 and ESPHome">my blog post</a> from a while back.</p><p>Since then, Nabu Casa (the organisation behind Home Assistant) has somewhat taken over the ESPHome project and have been doing their best to incorporate the best of both worlds.
One feature that&rsquo;s of particular relevance is this story, is the native support for Bluetooth LE devices within HA and the addition of the <a href=https://esphome.io/components/bluetooth_proxy.html title="ESPHome Bluetooth Proxy component" target=_blank rel=noopener>Bluetooth Proxy component</a> to ESPHome.</p><p>So from now on, you no longer need to add keys etc. for your Xiaomi BLE sensors to your ESPHome config.
You can connect directly from your Home Assistant system, provided it has a bluetooth chip, or sprinkle some ESP32 (configured as BLE proxy) around.</p><h2 id=the-esphome-method>The ESPHome method <a href=#the-esphome-method>¶</a></h2><p>If you already have some ESP32 around the house, maybe because you were using the method of <a href=https://sequr.be/blog/2021/01/room-temperature-monitoring-using-xiaomi-temperature-sensor-esp32-and-esphome/ title="Room temperature monitoring using Xiaomi temperature sensor, ESP32 and ESPHome">my old blog post</a>, this is by far the easiest solution.</p><p>In your ESP32 you probably had a section looking like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>esp32_ble_tracker</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>sensor</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># LYWSD03MMC - Advertising Type: Mi Like</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>xiaomi_lywsd03mmc</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mac_address</span>: <span style=color:#e6db74>&#34;XX:XX:XX:XX:XX:XX&#34;</span> <span style=color:#75715e># Replace with MAC Address of sensor</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>bindkey</span>: <span style=color:#e6db74>&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span> <span style=color:#75715e># Replace with bind key, use a dummy value when flashed with custom firmware</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>temperature</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${sensor_name_lywsd03} - Temperature&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>humidity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${sensor_name_lywsd03} - Humidity&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>battery_level</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${sensor_name_lywsd03} - Battery Level&#34;</span>
</span></span></code></pre></div><p>All of this can be removed from the ESPHome config and be replaced by:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>esp32_ble_tracker</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>bluetooth_proxy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>active</span>: <span style=color:#66d9ef>false</span> <span style=color:#75715e># Default</span>
</span></span></code></pre></div><p>Bluetooth devices will now appear as new integrations in Home Assistant.
You may need to enter the bindkey from your old ESPHome config when adding the devices to HA, so Home Assistant can decrypt the bluetooth packages.</p><h2 id=the-built-in-bluetooth-method>The built-in Bluetooth method <a href=#the-built-in-bluetooth-method>¶</a></h2><p>This method is useful for when the system you&rsquo;re running Home Assistant on has a built-in Bluetooth chip or you&rsquo;re using a Bluetooth USB dongle.
If you want to use a Bluetooth dongle, make sure you check the <a href=https://www.home-assistant.io/integrations/bluetooth/ title="Bluetooth - Home Assistant" target=_blank rel=noopener>Bluetooth Integration</a> documentation for the list of known-working adapters.</p><p>To then get Home Assistant to recognize your Bluetooth chip/adapter, follow these steps:</p><ol><li>Install <a href=https://github.com/bus1/dbus-broker/wiki title="DBus broker" target=_blank rel=noopener>DBus-broker</a> package <code>sudo apt install dbus-broker</code></li><li>Enable system service <code>sudo systemctl enable dbus-broker.service</code></li><li>Install <a href=http://www.bluez.org/ title=BlueZ target=_blank rel=noopener>BlueZ</a> package <code>sudo apt install bluez</code></li><li>Forward the Dbus socket to HA container by mapping it as a volume in your <code>docker-compose.yaml</code>.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>/opt/homeassistant/config:/config</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>/run/dbus:/run/dbus:ro</span> <span style=color:#75715e># &lt;-- Bluetooth adapter</span>
</span></span></code></pre></div></li><li>Rebuild your Home Assistant container by running <code>docker-compose up -d homeassistant</code>.</li></ol><p>Once Home Assistant has rebooted, it&rsquo;ll show a new integration for your Bluetooth adapter.
After adding that integration, it&rsquo;ll start discovering BLE devices and showing them as discovered integrations.</p><figure class=center><img src=bluetooth_integration.png alt="New Bluetooth integration available"><figcaption class=center>New Bluetooth integration available</figcaption></figure><p>This update to ESPHome and Home Assistant has made it even easier to work with Bluetooth sensors.</p><h2 id=bthome>BTHome <a href=#bthome>¶</a></h2><p>Once final tip:</p><p>Ideally, you&rsquo;d also flash the sensors so they would communicate/advertise using the <a href=https://bthome.io/ title="BTHome open standard" target=_blank rel=noopener>BTHome</a> open standard.</p><blockquote><p>BTHome is an open standard for broadcasting sensor data and button presses over Bluetooth LE</p></blockquote><p>Home Assistant supports it out of the box, and the process for flashing your Xiaomi sensors is the same but it uses an updated <a href=https://pvvx.github.io/ATC_MiThermometer/TelinkMiFlasher.html title="Telink Flasher" target=_blank rel=noopener>Telink Flasher</a>.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://sequr.be/tags/home-automation/>Home Automation</a></span>
<span class=tag><a href=https://sequr.be/tags/home-assistant/>Home Assistant</a></span>
<span class=tag><a href=https://sequr.be/tags/container/>Container</a></span>
<span class=tag><a href=https://sequr.be/tags/docker/>Docker</a></span>
<span class=tag><a href=https://sequr.be/tags/bluetooth/>bluetooth</a></span>
<span class=tag><a href=https://sequr.be/tags/dongle/>dongle</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a class=p-category href=https://sequr.be/categories/home-automation/>Home Automation</a></span>
<span class=tag><a class=p-category href=https://sequr.be/categories/ha-container/>HA Container</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
508 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
<time class=dt-published datetime=2022-11-25T00:00:00+00:00>2022-11-25</time></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
<span rel=author class="p-author h-card">DezeStijn</span></p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href=https://ko-fi.com/s4squatch target=_blank rel=noopener aria-label title="Buy me a coffee"><div class="resp-sharing-button resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsequr.be%2fblog%2f2022%2f11%2fhome-assistant-container-part-11-bluetooth-support%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fsequr.be%2fblog%2f2022%2f11%2fhome-assistant-container-part-11-bluetooth-support%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fsequr.be%2fblog%2f2022%2f11%2fhome-assistant-container-part-11-bluetooth-support%2f&amp;resubmit=true&amp;title=Home%20Assistant%20Container%20Part%2011%3a%20Bluetooth%20support" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Home%20Assistant%20Container%20Part%2011%3a%20Bluetooth%20support&amp;body=https%3a%2f%2fsequr.be%2fblog%2f2022%2f11%2fhome-assistant-container-part-11-bluetooth-support%2f" target=_self rel=noopener aria-label title="Share via email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div></div></a></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://sequr.be/blog/2022/12/home-assistant-container-part-12-migrating-to-podman/><span class=button__icon>←</span>
<span class=button__text>Home Assistant Container Part 12: Migrating to Podman</span>
</a></span><span class="button next"><a href=https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/><span class=button__text>Home Assistant Container Part 10: Zigbee2MQTT</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2019</span>
<span><a class=h-card rel=me href=https://sequr.be/>DezeStijn</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></span>
<span><a href=https://sequr.be/blog/index.xml target=_blank title=rss><svg width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div></footer></div><script type=text/javascript src=https://sequr.be/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>