<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="DezeStijn"><meta name=description content="In this tenth part of the Home Assistant Container series we&amp;rsquo;ll set up a Zigbee network using Zigbee2MQTT"><meta name=keywords content="Sequr,blog,writeup,CTF,challenge,machine,infosec,IT security,hacking,pentesting,cybersecurity,Home Automation,Home Assistant,Container,Docker,zigbee,Zigbee2MQTT,MQTT,Z2M"><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/><title>Home Assistant Container Part 10: Zigbee2MQTT :: Sequr</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://sequr.be/main.031a8efc33f94f55a4071bf4e91596478a5809fc8c148fab113801189cfd2152.css><link rel=stylesheet type=text/css href=https://sequr.be/css/table.css><link rel=stylesheet type=text/css href=https://sequr.be/css/menu.css><link rel=apple-touch-icon sizes=180x180 href=https://sequr.be/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://sequr.be/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://sequr.be/favicon-16x16.png><link rel=manifest href=https://sequr.be/site.webmanifest><link rel=mask-icon href=https://sequr.be/safari-pinned-tab.svg color=#e68101><link rel="shortcut icon" href=https://sequr.be/favicon.ico><meta name=msapplication-TileColor content="#e68101"><meta name=theme-color content="#e68101"><meta itemprop=name content="Home Assistant Container Part 10: Zigbee2MQTT"><meta itemprop=description content="In this tenth part of the Home Assistant Container series we&rsquo;ll set up a Zigbee network using Zigbee2MQTT"><meta itemprop=datePublished content="2022-10-04T00:00:00+00:00"><meta itemprop=dateModified content="2022-10-04T00:00:00+00:00"><meta itemprop=wordCount content="1610"><meta itemprop=image content="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/cover.png"><meta itemprop=keywords content="Home Automation,Home Assistant,Container,Docker,zigbee,Zigbee2MQTT,MQTT,Z2M,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/cover.png"><meta name=twitter:title content="Home Assistant Container Part 10: Zigbee2MQTT"><meta name=twitter:description content="In this tenth part of the Home Assistant Container series we&rsquo;ll set up a Zigbee network using Zigbee2MQTT"><meta property="article:section" content="Home Automation"><meta property="article:section" content="HA Container"><meta property="article:published_time" content="2022-10-04 00:00:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=https://sequr.be/ style=text-decoration:none><div class=logo><span class=logo__mark>$</span>
<span class=logo__text>nc sequr.be 1337</span>
<span class=logo__cursor style=background-color:#e68101></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://sequr.be/blog/>Blog</a></li><li><a href=https://sequr.be/about/>About</a></li><li><a href=https://sequr.be/shoppinglist/>Shopping</a></li><li><a href=https://sequr.be/privacy/>Privacy</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>8 minutes</p></div><article><h1 class=post-title><a href=https://sequr.be/blog/2022/10/home-assistant-container-part-10-zigbee2mqtt/>Home Assistant Container Part 10: Zigbee2MQTT</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#install-zigbee2mqtt-container>Install Zigbee2MQTT container</a><ul><li><a href=#locate-zigbee-coordinator>Locate Zigbee coordinator</a></li><li><a href=#docker-compose>Docker-compose</a></li><li><a href=#create-mqtt-user>Create MQTT user</a></li><li><a href=#zigbee2mqtt-config>Zigbee2MQTT config</a></li></ul></li><li><a href=#home-assistant>Home Assistant</a><ul><li><a href=#sidebar>Sidebar</a></li><li><a href=#controlling-z2m>Controlling Z2M</a></li><li><a href=#network-map>Network map</a></li></ul></li></ul></nav></aside><hr><div class=post-content><h2 id=intro>Intro <a href=#intro>¶</a></h2><p>Zigbee is a wireless protocol, like WiFi, but developed specifically for (battery powered) Internet-of-Things devices.
Devices connect in a mesh network, where mains powered devices (e.g. light bulbs and smart plugs) act as repeaters to extend the range of the network.
The Zigbee coordinator is at the heart of the Zigbee network and allows interconnectivity with non-Zigbee devices.</p><p>Home Assistant offers 2 Zigbee integrations: the built-in <a href=https://www.home-assistant.io/integrations/zha/ title="Zigbee Home Automation - ZHA" target=_blank rel=noopener>ZHA</a>, and <a href=https://www.home-assistant.io/integrations/deconz/ title=deCONZ target=_blank rel=noopener>deCONZ</a> which works via an add-on.
Another popular alternative is <a href=https://www.zigbee2mqtt.io/guide/usage/integrations/home_assistant.html title=Zigbee2MQTT target=_blank rel=noopener>Zigbee2MQTT</a> which makes use of Home Assistant&rsquo;s <a href=https://www.home-assistant.io/docs/mqtt/discovery/ title="MQTT Discovery" target=_blank rel=noopener>MQTT Discovery</a> to create devices and entities in Home Assistant.</p><p>Which coordinator you use is up to you.
I advise to check the <a href=https://zigbee.blakadder.com/ title="Zigbee Device Compatibility Repository by Blakadder" target=_blank rel=noopener>Zigbee Device Compatibility Repository</a> by Blakadder to check which coordinator supports the device you plan to buy.</p><p>This post will discuss the installation of Zigbee2MQTT as it makes use off a Docker container for the coordinator (we already installed the <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/ title="Part 4: Mosquitto Docker Container">MQTT broker</a>).</p><p><strong>Note:</strong> This post got delayed somewhat because I had to wait for my <a href=https://s.click.aliexpress.com/e/_DDZbXfZ title="Robotsky USB Extension Cable USB 3.0" target=_blank rel=noopener>USB extension</a> cable to arrive.
Without it, my Zigbee controller was experiencing interference from my 2.4GHz WiFi on my miniPC.</p><h2 id=install-zigbee2mqtt-container>Install Zigbee2MQTT container <a href=#install-zigbee2mqtt-container>¶</a></h2><h3 id=locate-zigbee-coordinator>Locate Zigbee coordinator <a href=#locate-zigbee-coordinator>¶</a></h3><p>In our Docker compose config, we&rsquo;ll need to assign the Zigbee coordinator, which&rsquo;ll be connected via USB, to the Docker container.</p><p>Plug in your Zigbee coordinator (e.g. Conbee II, Sonof Zigbee 3.0 Plus, &mldr;) into your machine.
Then run the following command to get the unique path to the device.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ls -l /dev/serial/by-id/
</span></span><span class=line><span class=cl>usb-ITead_Sonoff_Zigbee_3.0_USB_Dongle_Plus_eexxxxxxxxxxxxxxxxxxxxxxxxxxxx52-if00-port0 -&gt; ../../ttyUSB0
</span></span></code></pre></div><p>We&rsquo;ll use this unique <code>by-id</code> path in our config later instead of the typical <code>/dev/ttyUSB0</code> bevause there&rsquo;s always a risk of the device getting a new TTY assigned after a reboot, espcially with other devices pluggin in as well.</p><h3 id=docker-compose>Docker-compose <a href=#docker-compose>¶</a></h3><p>We expand our <code>docker-compose.yaml</code> with the config for the Zigbee2MQTT container.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>[</span><span class=l>...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>koenkk/zigbee2mqtt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8099:8099/tcp&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>TZ=Europe/Brussels</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/opt/zigbee2mqtt/data:/app/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/run/udev:/run/udev:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>devices</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/dev/serial/by-id/usb-ITead_Sonoff_Zigbee_3.0_USB_Dongle_Plus_eexxxxxxxxxxxxxxxxxxxxxxxxxxxx52-if00-port0:/dev/ttyACM0</span><span class=w>
</span></span></span></code></pre></div><p>Note that I changed the port mapping for this container.
Port 8080 is already in use by <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-3-mariadb-and-influxdb/ title="Part 3: MariaDB and InfluxDB">adminer</a> so I changed the Zigbee2MQTT front-end port to 8099 (see below) and mapped that one in my Docker configuration.</p><p>We won&rsquo;t start our container just yet, as we first want to setup our configuration.</p><h3 id=create-mqtt-user>Create MQTT user <a href=#create-mqtt-user>¶</a></h3><p>When we set up the <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/ title="Part 4: Mosquitto Docker Container">Mosquitto MQTT broker</a>, I said I prefer to create a MQTT user per service.
So let&rsquo;s create a user for our Z2M container.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it mosquitto mosquitto_passwd /mosquitto/config/mqttuser z2m_mqtt
</span></span><span class=line><span class=cl>Password:          <span class=c1># Enter a password</span>
</span></span><span class=line><span class=cl>Reenter password:  <span class=c1># Repeat the password</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat mosquitto/config/mqttuser
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span><span class=line><span class=cl>z2m_mqtt:<span class=nv>$7$101$1</span>xcB1yrF********<span class=nv>$O$XR</span>******************2/N************************************************************g<span class=o>==</span>
</span></span></code></pre></div><h3 id=zigbee2mqtt-config>Zigbee2MQTT config <a href=#zigbee2mqtt-config>¶</a></h3><p>To get a copy of the default config, run <code>sudo wget https://raw.githubusercontent.com/Koenkk/zigbee2mqtt/master/data/configuration.yaml</code> in the folder where the config will be stored (<code>/opt/zigbee2mqtt/data</code>).
Then open and edit it using <code>sudo nano /opt/zigbee2mqtt/data/configuration.yaml</code>.</p><p>We&rsquo;ll tell Z2M to connect to our <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-4-mosquitto-docker-container/ title="Part 4: Mosquitto Docker Container">MQTT broker</a>, use the syntax Home Assistant device detection understands, set up the webserver, and let Z2M generate some keys used to setup the Zigbee network.</p><p>More info on what the settings in this config do, can be found in the <a href=https://www.zigbee2mqtt.io/guide/configuration/ title="Zigbee2MQTT documentation" target=_blank rel=noopener>Z2M docs</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Adapter settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>serial</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=l>/dev/ttyACM0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># MQTT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>mqtt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>base_topic</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;!secret server&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;!secret user&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;!secret password&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>client_id</span><span class=p>:</span><span class=w> </span><span class=l>zigbee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Zigbee network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>permit_join</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=c># Do not allow random devices to connect automatically</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Webserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>frontend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8099</span><span class=w> </span><span class=c># Custom port</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;http://&lt;ip.of.our.box&gt;:8099&#39;</span><span class=w> </span><span class=c># Update IP here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Devices and groups</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Extract config to separate files</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>devices</span><span class=p>:</span><span class=w> </span><span class=l>devices.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>groups</span><span class=p>:</span><span class=w> </span><span class=l>groups.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Home Assistant integration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>homeassistant</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>advanced</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Zigbee network - auto-generate new keys</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pan_id</span><span class=p>:</span><span class=w> </span><span class=l>GENERATE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>network_key</span><span class=p>:</span><span class=w> </span><span class=l>GENERATE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Zigbee network - set channel to avoid interference with 2.4GHz WiFi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>channel</span><span class=p>:</span><span class=w> </span><span class=m>24</span><span class=w>
</span></span></span></code></pre></div><p>With this configuration in place, we can start the container using <code>docker-compose up -d zigbee2mqtt</code>.</p><p>If you check the logs via Portainer or <code>docker-compose logs zigbee2mqtt</code>, you&rsquo;ll see our container start up nicely:</p><pre tabindex=0><code>Using &#39;/app/data&#39; as data directory
Zigbee2MQTT:info  2022-10-04 12:09:47: Logging to console and directory: &#39;/app/data/log/2022-10-04.12-09-47&#39; filename: log.txt
Zigbee2MQTT:info  2022-10-04 12:09:47: Starting Zigbee2MQTT version 1.28.0 (commit #03ba647)
Zigbee2MQTT:info  2022-10-04 12:09:47: Starting zigbee-herdsman (0.14.62)
Zigbee2MQTT:info  2022-10-04 12:09:48: zigbee-herdsman started (resumed)
Zigbee2MQTT:info  2022-10-04 12:09:48: Coordinator firmware version: &#39;{&#34;meta&#34;:{&#34;maintrel&#34;:1,&#34;majorrel&#34;:2,&#34;minorrel&#34;:7,&#34;product&#34;:1,&#34;revision&#34;:20220219,&#34;transportrev&#34;:2},&#34;type&#34;:&#34;zStack3x0&#34;}&#39;
Zigbee2MQTT:info  2022-10-04 12:09:48: Currently 0 devices are joined:
Zigbee2MQTT:info  2022-10-04 12:09:48: Zigbee: disabling joining new devices.
Zigbee2MQTT:info  2022-10-04 12:09:48: Connecting to MQTT server at mqtt://&lt;ip.of.our.box&gt;:1883
Zigbee2MQTT:info  2022-10-04 12:09:48: Connected to MQTT server
Zigbee2MQTT:info  2022-10-04 12:09:48: MQTT publish: topic &#39;zigbee2mqtt/bridge/state&#39;, payload &#39;{&#34;state&#34;:&#34;online&#34;}&#39;
Zigbee2MQTT:info  2022-10-04 12:09:48: Started frontend on port 0.0.0.0:8099
Zigbee2MQTT:info  2022-10-04 12:09:48: MQTT publish: topic &#39;zigbee2mqtt/bridge/state&#39;, payload &#39;{&#34;state&#34;:&#34;online&#34;}&#39;
</code></pre><h2 id=home-assistant>Home Assistant <a href=#home-assistant>¶</a></h2><h3 id=sidebar>Sidebar <a href=#sidebar>¶</a></h3><p>Repeating what we did in <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-3-mariadb-and-influxdb/ title="Part 3: MariaDB and InfluxDB">Part 3</a>, <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-5-node-red/ title="Part 5: Node-RED">Part 5</a>, <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/ title="Part 6: Editing configuration.yaml from within Home Assistant">Part 6</a>, <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-7-backing-up-home-assistant-container/ title="Part 7: Backing up Home Assistant Container">Part 7</a>, and <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/ title="Part 9: ESPHome">Part 9</a>, we add an entry for ESPHome to the sidebar of our Home Assistant dashboard using <code>panel-iframe</code>.</p><p>Add the following lines to <code>configuration.yaml</code> and restart Home Assistant.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>panel_iframe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>portainer</span><span class=p>:</span><span class=w>     </span><span class=c># part 3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=l>...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nodered</span><span class=p>:</span><span class=w>       </span><span class=c># part 5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=l>...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>configurator</span><span class=p>:</span><span class=w>  </span><span class=c># part 6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=l>...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>duplicati</span><span class=p>:</span><span class=w>     </span><span class=c># part 7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=l>...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>esphome</span><span class=p>:</span><span class=w>       </span><span class=c># part 9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=l>...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class=l>mdi:zigbee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://192.168.10.106:8099</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>require_admin</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><figure class=center><img src=z2mdashboard.png alt="Zigbee2MQTT dashboard"><figcaption class=center>Zigbee2MQTT dashboard without devices</figcaption></figure><p>Pressing the <code>Permit join</code> button on the top-right will temporarily allow any Zigbee device set to pairing mode to be picked up by our coordinator.</p><figure class=center><img src=z2mjoin.png alt="Permit Zigbee to join"><figcaption class=center>Permit Zigbee to join</figcaption></figure><h3 id=controlling-z2m>Controlling Z2M <a href=#controlling-z2m>¶</a></h3><p>Since Zigbee2MQTT&rsquo;s configuration can be adapted over MQTT, we can control Z2M not only from the Frontend we just exposed, but also from within our dashboard.
This is also explained in the <a href=https://www.zigbee2mqtt.io/guide/usage/integrations/home_assistant.html#controlling-zigbee2mqtt-via-home-assistant title="Controlling Z2M via Home Assistant" target=_blank rel=noopener>Z2M Home Assistant integration docs</a>.</p><p>First, we add some more YAML to our <code>configuration.yaml</code> via the <a href=https://sequr.be/blog/2022/09/home-assistant-container-part-6-editing-configuration.yaml-from-within-home-assistant/ title="Part 6: Editing configuration.yaml from within Home Assistant">Configurator</a>.
Copy and paste this code add the end of the file.
If you&rsquo;re used to splitting up your config and/or working with packages, you can put it in a <code>zigbee2mqtt.yaml</code> package file as well.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Input select for Zigbee2MQTT debug level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>input_select</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt_log_level</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Log Level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>options</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>warn</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>initial</span><span class=p>:</span><span class=w> </span><span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class=l>mdi:format-list-bulleted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Input number for joining time remaining (in minutes)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>input_number</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt_join_minutes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Zigbee2MQTT join minutes&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>initial</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>min</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>max</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>step</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>slider</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Input text to input Zigbee2MQTT friendly_name for scripts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>input_text</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt_old_name</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Old Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>initial</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt_new_name</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT New Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>initial</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt_remove</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Remove</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>initial</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Input boolean to set the force remove flag for devices</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>input_boolean</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt_force_remove</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Force Remove</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>initial</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class=l>mdi:alert-remove</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Scripts for renaming &amp; removing devices</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt_rename</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Rename</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sequence</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>mqtt.publish</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>data_template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>topic</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt/bridge/request/device/rename</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>payload_template</span><span class=p>:</span><span class=w> </span><span class=p>&gt;-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          {
</span></span></span><span class=line><span class=cl><span class=sd>            &#34;from&#34;: &#34;{{ states.input_text.zigbee2mqtt_old_name.state | string }}&#34;,
</span></span></span><span class=line><span class=cl><span class=sd>            &#34;to&#34;: &#34;{{ states.input_text.zigbee2mqtt_new_name.state | string }}&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          }</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee2mqtt_remove</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Remove</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sequence</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>mqtt.publish</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>data_template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>topic</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt/bridge/request/device/remove</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>payload_template</span><span class=p>:</span><span class=w> </span><span class=p>&gt;-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          {
</span></span></span><span class=line><span class=cl><span class=sd>            &#34;id&#34;: &#34;{{ states.input_text.zigbee2mqtt_remove.state | string }}&#34;,
</span></span></span><span class=line><span class=cl><span class=sd>            &#34;force&#34;: {% if states.input_boolean.zigbee2mqtt_force_remove.state == &#34;off&#34; %}false{% else %}true{% endif %}
</span></span></span><span class=line><span class=cl><span class=sd>          }</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Timer for joining time remaining (254 sec)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>timer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zigbee_permit_join</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Time remaining</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>duration</span><span class=p>:</span><span class=w> </span><span class=m>254</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>mqtt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sensor</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Sensor for monitoring the bridge state</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Bridge state</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unique_id</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt_bridge_state_sensor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>state_topic</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;zigbee2mqtt/bridge/state&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class=l>mdi:router-wireless</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Sensor for Showing the Zigbee2MQTT Version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unique_id</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt_version_sensor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>state_topic</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;zigbee2mqtt/bridge/info&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ value_json.version }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class=l>mdi:zigbee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Sensor for Showing the Coordinator Version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Coordinator Version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unique_id</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt_coordinator_version_sensor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>state_topic</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;zigbee2mqtt/bridge/info&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ value_json.coordinator.meta.revision }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class=l>mdi:chip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2mqtt Networkmap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unique_id</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt_networkmap_sensor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># if you change base_topic of Zigbee2mqtt, change state_topic accordingly</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>state_topic</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt/bridge/networkmap/raw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=p>&gt;-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        </span><span class=w>        </span>{{<span class=w> </span><span class=l>now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># again, if you change base_topic of Zigbee2mqtt, change json_attributes_topic accordingly</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>json_attributes_topic</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt/bridge/networkmap/raw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Switch for enabling joining</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>switch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Zigbee2MQTT Main join&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unique_id</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt_main_join_switch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>state_topic</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;zigbee2mqtt/bridge/info&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;{{ value_json.permit_join | lower }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command_topic</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;zigbee2mqtt/bridge/request/permit_join&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>payload_on</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>payload_off</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>automation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Automation for sending MQTT message on input select change</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT Log Level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>initial_state</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;on&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>state</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>input_select.zigbee2mqtt_log_level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>mqtt.publish</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>payload_template</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ states(&#39;input_select.zigbee2mqtt_log_level&#39;) }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>topic</span><span class=p>:</span><span class=w> </span><span class=l>zigbee2mqtt/bridge/request/config/log_level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Automation to start timer when enable join is turned on</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>zigbee_join_enabled</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee Join Enabled</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>state</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>switch.zigbee2mqtt_main_join</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;on&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>timer.start</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>timer.zigbee_permit_join</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>data_template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>duration</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ &#39;00:0%i:00&#39; % (states(&#39;input_number.zigbee2mqtt_join_minutes&#39;) | int ) }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Automation to stop timer when switch turned off and turn off switch when timer finished</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>zigbee_join_disabled</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee Join Disabled</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>event</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>event_type</span><span class=p>:</span><span class=w> </span><span class=l>timer.finished</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>event_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>timer.zigbee_permit_join</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>state</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>switch.zigbee2mqtt_main_join</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;off&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>timer.cancel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>timer.zigbee_permit_join</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>switch.turn_off</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>switch.zigbee2mqtt_main_join</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;zigbee2mqtt_create_notification_on_successful_interview&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee Device Joined Notification</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>mqtt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>topic</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;zigbee2mqtt/bridge/event&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>condition</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>template</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;{{trigger.payload_json.type == &#34;device_interview&#34; and trigger.payload_json.data.status == &#34;successful&#34; and trigger.payload_json.data.supported}}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>persistent_notification.create</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>data_template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class=l>Device joined the Zigbee2MQTT network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Name: {{trigger.payload_json.data.friendly_name}},
</span></span></span><span class=line><span class=cl><span class=s2>                    Vendor: {{trigger.payload_json.data.definition.vendor}},
</span></span></span><span class=line><span class=cl><span class=s2>                    Model: {{trigger.payload_json.data.definition.model}},
</span></span></span><span class=line><span class=cl><span class=s2>                    Description: {{trigger.payload_json.data.definition.description}}&#34;</span><span class=w>
</span></span></span></code></pre></div><p>Check your YAML config in the developer tools and restart Home Assistant.</p><p>Once that&rsquo;s done, you can add a custom card to your Dashboard containing the following entries:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class=l>Zigbee2MQTT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>entities</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>show_header_toggle</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>entities</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>sensor.zigbee2mqtt_bridge_state</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>sensor.zigbee2mqtt_version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>sensor.zigbee2mqtt_coordinator_version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>input_select.zigbee2mqtt_log_level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>divider</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>switch.zigbee2mqtt_main_join</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>input_number.zigbee2mqtt_join_minutes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>timer.zigbee_permit_join</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>divider</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>input_text.zigbee2mqtt_old_name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>input_text.zigbee2mqtt_new_name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>script.zigbee2mqtt_rename</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>divider</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>input_text.zigbee2mqtt_remove</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>input_boolean.zigbee2mqtt_force_remove</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=l>script.zigbee2mqtt_remove</span><span class=w>
</span></span></span></code></pre></div><figure class=center><img src=hacard.png alt="Manage Zigbee2MQTT from Home Assistant"><figcaption class=center>Manage Z2M from Home Assistant</figcaption></figure><h3 id=network-map>Network map <a href=#network-map>¶</a></h3><p>Another nice thing to add to Home Assistant is a map of your connect Zigbee devices.</p><p>Since we don&rsquo;t have any devices connected yet, this map will be fairly empty.
However, you&rsquo;ll enjoy seeing your network grow each time you add a new device :)</p><p>This will require you to add a <a href=https://github.com/azuwis/zigbee2mqtt-networkmap/ title="Z2M network map custom card" target=_blank rel=noopener>custom card</a>, either manually or using <a href=https://hacs.xyz/ title="Home Assistant Community Store (HACS)" target=_blank rel=noopener>HACS</a>.
I suggest you have a look at the documentation of both to decide which method you prefer.</p><figure class=center><img src=hamap.png alt="Zigbee2MQTT network map"><figcaption class=center>Zigbee2MQTT network map</figcaption></figure><p>Don&rsquo;t see the map or got an error about the custom card not existing?
Clear your cache and refresh the page before trying again.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://sequr.be/tags/home-automation/>Home Automation</a></span>
<span class=tag><a href=https://sequr.be/tags/home-assistant/>Home Assistant</a></span>
<span class=tag><a href=https://sequr.be/tags/container/>Container</a></span>
<span class=tag><a href=https://sequr.be/tags/docker/>Docker</a></span>
<span class=tag><a href=https://sequr.be/tags/zigbee/>zigbee</a></span>
<span class=tag><a href=https://sequr.be/tags/zigbee2mqtt/>Zigbee2MQTT</a></span>
<span class=tag><a href=https://sequr.be/tags/mqtt/>MQTT</a></span>
<span class=tag><a href=https://sequr.be/tags/z2m/>Z2M</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://sequr.be/categories/home-automation/>Home Automation</a></span>
<span class=tag><a href=https://sequr.be/categories/ha-container/>HA Container</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1610 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-10-04</p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href=https://ko-fi.com/s4squatch target=_blank rel=noopener aria-label title="Buy me a coffee"><div class="resp-sharing-button resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604.0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407.0.0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsequr.be%2fblog%2f2022%2f10%2fhome-assistant-container-part-10-zigbee2mqtt%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fsequr.be%2fblog%2f2022%2f10%2fhome-assistant-container-part-10-zigbee2mqtt%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fsequr.be%2fblog%2f2022%2f10%2fhome-assistant-container-part-10-zigbee2mqtt%2f&resubmit=true&title=Home%20Assistant%20Container%20Part%2010%3a%20Zigbee2MQTT" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=Home%20Assistant%20Container%20Part%2010%3a%20Zigbee2MQTT%20https%3a%2f%2fsequr.be%2fblog%2f2022%2f10%2fhome-assistant-container-part-10-zigbee2mqtt%2f" target=_blank rel=noopener aria-label title="Share on whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893a11.821 11.821.0 00-3.48-8.413z"/></svg></div></div></a></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://sequr.be/blog/2022/11/home-assistant-container-part-11-bluetooth-support/><span class=button__icon>←</span>
<span class=button__text>Home Assistant Container Part 11: Bluetooth support</span></a></span>
<span class="button next"><a href=https://sequr.be/blog/2022/09/home-assistant-container-part-9-esphome/><span class=button__text>Home Assistant Container Part 9: ESPHome</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2019-2023</span>
<span><a href=https://sequr.be>DezeStijn</a></span>
<span><a href=https://sequr.be/blog/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><small><span>Powered by <a href=http://gohugo.io>Hugo</a>.</span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span><br><span>Deployed using <a href=https://github.com/TheGroundZero/TheGroundZero.github.io/ title=TheGroundZero/TheGroundZero.github.io>GitHub Pages</a></span></small></div></div></footer></div><script type=text/javascript src=https://sequr.be/bundle.min.bb2c6bc3ed452ca4759660e4020811f248bc2320081559e8a32d8b0092773852941133639d35e8370d03d3ddaa750b1edd6b343c5bd22a55d5bdeae8f648f49b.js integrity="sha512-uyxrw+1FLKR1lmDkAggR8ki8IyAIFVnooy2LAJJ3OFKUETNjnTXoNw0D092qdQse3Ws0PFvSKlXVvero9kj0mw=="></script></body></html>